/*
 * Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
 *
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
// define(function(){

// "use strict";var Box2D={};(function(e,t){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){var r=e;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=r},e.generateCallback=function(t,n){return function(){n.apply(t,arguments)}},e.NVector=function(n){n===t&&(n=0);var r=new Array(n||0);for(var i=0;i<n;++i)r[i]=0;return r},e.is=function(n,r){return n===null?!1:r instanceof Function&&n instanceof r?!0:n.constructor.__implements!=t&&n.constructor.__implements[r]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D=="undefined"&&(Box2D={}),typeof Box2D.Collision=="undefined"&&(Box2D.Collision={}),typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={}),typeof Box2D.Common=="undefined"&&(Box2D.Common={}),typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={}),typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={}),typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={}),typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={}),typeof Box2D.Rope=="undefined"&&(Box2D.Rope={}),function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments),this.constructor===n&&this.b2ContactID.apply(this,arguments)}function r(){r.b2Distance.apply(this,arguments)}function i(){i.b2DistanceInput.apply(this,arguments)}function s(){s.b2DistanceOutput.apply(this,arguments)}function o(){o.b2DistanceProxy.apply(this,arguments)}function u(){u.b2DynamicTree.apply(this,arguments),this.constructor===u&&this.b2DynamicTree.apply(this,arguments)}function a(){a.b2BroadPhase.apply(this,arguments)}function f(){f.b2TreeNode.apply(this,arguments)}function l(){l.b2Pair.apply(this,arguments)}function c(){c.b2Manifold.apply(this,arguments),this.constructor===c&&this.b2Manifold.apply(this,arguments)}function h(){h.b2ManifoldPoint.apply(this,arguments),this.constructor===h&&this.b2ManifoldPoint.apply(this,arguments)}function p(){p.b2RayCastInput.apply(this,arguments)}function d(){d.b2RayCastOutput.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function m(){m.b2Simplex.apply(this,arguments),this.constructor===m&&this.b2Simplex.apply(this,arguments)}function g(){g.b2SimplexCache.apply(this,arguments)}function y(){y.b2SimplexVertex.apply(this,arguments)}function b(){b.b2TOIInput.apply(this,arguments)}function w(){w.b2TOIOutput.apply(this,arguments)}function E(){E.b2WorldManifold.apply(this,arguments),this.constructor===E&&this.b2WorldManifold.apply(this,arguments)}function S(){S.b2ClipVertex.apply(this,arguments)}function x(){x.b2ContactFeature.apply(this,arguments)}function T(){T.b2CircleShape.apply(this,arguments),this.constructor===T&&this.b2CircleShape.apply(this,arguments)}function N(){N.b2EdgeShape.apply(this,arguments),this.constructor===N&&this.b2EdgeShape.apply(this,arguments)}function C(){C.b2ChainShape.apply(this,arguments),this.constructor===C&&this.b2ChainShape.apply(this,arguments)}function k(){k.b2MassData.apply(this,arguments)}function L(){L.b2PolygonShape.apply(this,arguments),this.constructor===L&&this.b2PolygonShape.apply(this,arguments)}function A(){A.b2Shape.apply(this,arguments),this.constructor===A&&this.b2Shape.apply(this,arguments)}function O(){O.b2Color.apply(this,arguments),this.constructor===O&&this.b2Color.apply(this,arguments)}function M(){M.b2Settings.apply(this,arguments)}function _(){_.b2Timer.apply(this,arguments),this.constructor===_&&this.b2Timer.apply(this,arguments)}function D(){D.b2Mat22.apply(this,arguments),this.constructor===D&&this.b2Mat22.apply(this,arguments)}function P(){P.b2Mat33.apply(this,arguments),this.constructor===P&&this.b2Mat33.apply(this,arguments)}function H(){H.b2Rot.apply(this,arguments),this.constructor===H&&this.b2Rot.apply(this,arguments)}function B(){B.b2Math.apply(this,arguments)}function j(){j.b2Sweep.apply(this,arguments)}function F(){F.b2Transform.apply(this,arguments),this.constructor===F&&this.b2Transform.apply(this,arguments)}function I(){I.b2Vec2.apply(this,arguments),this.constructor===I&&this.b2Vec2.apply(this,arguments)}function q(){q.b2Vec3.apply(this,arguments),this.constructor===q&&this.b2Vec3.apply(this,arguments)}function R(){R.b2Body.apply(this,arguments),this.constructor===R&&this.b2Body.apply(this,arguments)}function U(){U.b2BodyDef.apply(this,arguments),this.constructor===U&&this.b2BodyDef.apply(this,arguments)}function z(){z.b2ContactFilter.apply(this,arguments)}function W(){W.b2ContactImpulse.apply(this,arguments)}function X(){X.b2ContactListener.apply(this,arguments)}function V(){V.b2ContactManager.apply(this,arguments),this.constructor===V&&this.b2ContactManager.apply(this,arguments)}function $(){$.b2Draw.apply(this,arguments),this.constructor===$&&this.b2Draw.apply(this,arguments)}function J(){J.b2DestructionListener.apply(this,arguments)}function K(){K.b2Filter.apply(this,arguments)}function Q(){Q.b2Fixture.apply(this,arguments),this.constructor===Q&&this.b2Fixture.apply(this,arguments)}function G(){G.b2FixtureDef.apply(this,arguments),this.constructor===G&&this.b2FixtureDef.apply(this,arguments)}function Y(){Y.b2FixtureProxy.apply(this,arguments),this.constructor===Y&&this.b2FixtureProxy.apply(this,arguments)}function Z(){Z.b2Island.apply(this,arguments),this.constructor===Z&&this.b2Island.apply(this,arguments)}function et(){et.b2Position.apply(this,arguments)}function tt(){tt.b2Profile.apply(this,arguments)}function nt(){nt.b2SolverData.apply(this,arguments)}function rt(){rt.b2TimeStep.apply(this,arguments)}function it(){it.b2Velocity.apply(this,arguments)}function st(){st.b2World.apply(this,arguments),this.constructor===st&&this.b2World.apply(this,arguments)}function ot(){ot.b2WorldQueryWrapper.apply(this,arguments)}function ut(){ut.b2WorldRayCastWrapper.apply(this,arguments)}function at(){at.b2ChainAndCircleContact.apply(this,arguments)}function ft(){ft.b2ChainAndPolygonContact.apply(this,arguments)}function lt(){lt.b2CircleContact.apply(this,arguments)}function ct(){ct.b2Contact.apply(this,arguments),this.constructor===ct&&this.b2Contact.apply(this,arguments)}function ht(){ht.b2ContactEdge.apply(this,arguments)}function pt(){pt.b2ContactPositionConstraint.apply(this,arguments),this.constructor===pt&&this.b2ContactPositionConstraint.apply(this,arguments)}function dt(){dt.b2ContactRegister.apply(this,arguments)}function vt(){vt.b2ContactSolver.apply(this,arguments),this.constructor===vt&&this.b2ContactSolver.apply(this,arguments)}function mt(){mt.b2ContactSolverDef.apply(this,arguments),this.constructor===mt&&this.b2ContactSolverDef.apply(this,arguments)}function gt(){gt.b2ContactVelocityConstraint.apply(this,arguments),this.constructor===gt&&this.b2ContactVelocityConstraint.apply(this,arguments)}function yt(){yt.b2EdgeAndCircleContact.apply(this,arguments)}function bt(){bt.b2PolygonAndCircleContact.apply(this,arguments)}function wt(){wt.b2EdgeAndPolygonContact.apply(this,arguments)}function Et(){Et.b2PolygonContact.apply(this,arguments)}function St(){St.b2PositionSolverManifold.apply(this,arguments),this.constructor===St&&this.b2PositionSolverManifold.apply(this,arguments)}function xt(){xt.b2VelocityConstraintPoint.apply(this,arguments)}function Tt(){Tt.b2DistanceJoint.apply(this,arguments),this.constructor===Tt&&this.b2DistanceJoint.apply(this,arguments)}function Nt(){Nt.b2DistanceJointDef.apply(this,arguments),this.constructor===Nt&&this.b2DistanceJointDef.apply(this,arguments)}function Ct(){Ct.b2FrictionJoint.apply(this,arguments),this.constructor===Ct&&this.b2FrictionJoint.apply(this,arguments)}function kt(){kt.b2FrictionJointDef.apply(this,arguments),this.constructor===kt&&this.b2FrictionJointDef.apply(this,arguments)}function Lt(){Lt.b2GearJoint.apply(this,arguments),this.constructor===Lt&&this.b2GearJoint.apply(this,arguments)}function At(){At.b2GearJointDef.apply(this,arguments),this.constructor===At&&this.b2GearJointDef.apply(this,arguments)}function Ot(){Ot.b2Jacobian.apply(this,arguments)}function Mt(){Mt.b2Joint.apply(this,arguments),this.constructor===Mt&&this.b2Joint.apply(this,arguments)}function _t(){_t.b2JointDef.apply(this,arguments),this.constructor===_t&&this.b2JointDef.apply(this,arguments)}function Dt(){Dt.b2JointEdge.apply(this,arguments)}function Pt(){Pt.b2MouseJoint.apply(this,arguments),this.constructor===Pt&&this.b2MouseJoint.apply(this,arguments)}function Ht(){Ht.b2MouseJointDef.apply(this,arguments),this.constructor===Ht&&this.b2MouseJointDef.apply(this,arguments)}function Bt(){Bt.b2PrismaticJoint.apply(this,arguments),this.constructor===Bt&&this.b2PrismaticJoint.apply(this,arguments)}function jt(){jt.b2PrismaticJointDef.apply(this,arguments),this.constructor===jt&&this.b2PrismaticJointDef.apply(this,arguments)}function Ft(){Ft.b2PulleyJoint.apply(this,arguments),this.constructor===Ft&&this.b2PulleyJoint.apply(this,arguments)}function It(){It.b2PulleyJointDef.apply(this,arguments),this.constructor===It&&this.b2PulleyJointDef.apply(this,arguments)}function qt(){qt.b2RevoluteJoint.apply(this,arguments),this.constructor===qt&&this.b2RevoluteJoint.apply(this,arguments)}function Rt(){Rt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Rt&&this.b2RevoluteJointDef.apply(this,arguments)}function Ut(){Ut.b2RopeJoint.apply(this,arguments),this.constructor===Ut&&this.b2RopeJoint.apply(this,arguments)}function zt(){zt.b2RopeJointDef.apply(this,arguments),this.constructor===zt&&this.b2RopeJointDef.apply(this,arguments)}function Wt(){Wt.b2WeldJoint.apply(this,arguments),this.constructor===Wt&&this.b2WeldJoint.apply(this,arguments)}function Xt(){Xt.b2WeldJointDef.apply(this,arguments),this.constructor===Xt&&this.b2WeldJointDef.apply(this,arguments)}function Vt(){Vt.b2WheelJoint.apply(this,arguments),this.constructor===Vt&&this.b2WheelJoint.apply(this,arguments)}function $t(){$t.b2WheelJointDef.apply(this,arguments),this.constructor===$t&&this.b2WheelJointDef.apply(this,arguments)}function Jt(){Jt.b2Rope.apply(this,arguments)}function Kt(){Kt.b2RopeDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=e,Box2D.Collision.b2Collision=t,Box2D.Collision.b2ContactID=n,Box2D.Collision.b2Distance=r,Box2D.Collision.b2DistanceInput=i,Box2D.Collision.b2DistanceOutput=s,Box2D.Collision.b2DistanceProxy=o,Box2D.Collision.b2DynamicTree=u,Box2D.Collision.b2BroadPhase=a,Box2D.Collision.b2TreeNode=f,Box2D.Collision.b2Pair=l,Box2D.Collision.b2Manifold=c,Box2D.Collision.b2ManifoldPoint=h,Box2D.Collision.b2RayCastInput=p,Box2D.Collision.b2RayCastOutput=d,Box2D.Collision.b2SeparationFunction=v,Box2D.Collision.b2Simplex=m,Box2D.Collision.b2SimplexCache=g,Box2D.Collision.b2SimplexVertex=y,Box2D.Collision.b2TOIInput=b,Box2D.Collision.b2TOIOutput=w,Box2D.Collision.b2WorldManifold=E,Box2D.Collision.b2ClipVertex=S,Box2D.Collision.b2ContactFeature=x,Box2D.Collision.Shapes.b2CircleShape=T,Box2D.Collision.Shapes.b2EdgeShape=N,Box2D.Collision.Shapes.b2ChainShape=C,Box2D.Collision.Shapes.b2MassData=k,Box2D.Collision.Shapes.b2PolygonShape=L,Box2D.Collision.Shapes.b2Shape=A,Box2D.Common.b2Color=O,Box2D.Common.b2Settings=M,Box2D.Common.b2Timer=_,Box2D.Common.Math.b2Mat22=D,Box2D.Common.Math.b2Mat33=P,Box2D.Common.Math.b2Rot=H,Box2D.Common.Math.b2Math=B,Box2D.Common.Math.b2Sweep=j,Box2D.Common.Math.b2Transform=F,Box2D.Common.Math.b2Vec2=I,Box2D.Common.Math.b2Vec3=q,Box2D.Dynamics.b2Body=R,Box2D.Dynamics.b2BodyDef=U,Box2D.Dynamics.b2ContactFilter=z,Box2D.Dynamics.b2ContactImpulse=W,Box2D.Dynamics.b2ContactListener=X,Box2D.Dynamics.b2ContactManager=V,Box2D.Dynamics.b2Draw=$,Box2D.Dynamics.b2DestructionListener=J,Box2D.Dynamics.b2Filter=K,Box2D.Dynamics.b2Fixture=Q,Box2D.Dynamics.b2FixtureDef=G,Box2D.Dynamics.b2FixtureProxy=Y,Box2D.Dynamics.b2Island=Z,Box2D.Dynamics.b2Position=et,Box2D.Dynamics.b2Profile=tt,Box2D.Dynamics.b2SolverData=nt,Box2D.Dynamics.b2TimeStep=rt,Box2D.Dynamics.b2Velocity=it,Box2D.Dynamics.b2World=st,Box2D.Dynamics.b2WorldQueryWrapper=ot,Box2D.Dynamics.b2WorldRayCastWrapper=ut,Box2D.Dynamics.Contacts.b2ChainAndCircleContact=at,Box2D.Dynamics.Contacts.b2ChainAndPolygonContact=ft,Box2D.Dynamics.Contacts.b2CircleContact=lt,Box2D.Dynamics.Contacts.b2Contact=ct,Box2D.Dynamics.Contacts.b2ContactEdge=ht,Box2D.Dynamics.Contacts.b2ContactPositionConstraint=pt,Box2D.Dynamics.Contacts.b2ContactRegister=dt,Box2D.Dynamics.Contacts.b2ContactSolver=vt,Box2D.Dynamics.Contacts.b2ContactSolverDef=mt,Box2D.Dynamics.Contacts.b2ContactVelocityConstraint=gt,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=yt,Box2D.Dynamics.Contacts.b2PolygonAndCircleContact=bt,Box2D.Dynamics.Contacts.b2EdgeAndPolygonContact=wt,Box2D.Dynamics.Contacts.b2PolygonContact=Et,Box2D.Dynamics.Contacts.b2PositionSolverManifold=St,Box2D.Dynamics.Contacts.b2VelocityConstraintPoint=xt,Box2D.Dynamics.Joints.b2DistanceJoint=Tt,Box2D.Dynamics.Joints.b2DistanceJointDef=Nt,Box2D.Dynamics.Joints.b2FrictionJoint=Ct,Box2D.Dynamics.Joints.b2FrictionJointDef=kt,Box2D.Dynamics.Joints.b2GearJoint=Lt,Box2D.Dynamics.Joints.b2GearJointDef=At,Box2D.Dynamics.Joints.b2Jacobian=Ot,Box2D.Dynamics.Joints.b2Joint=Mt,Box2D.Dynamics.Joints.b2JointDef=_t,Box2D.Dynamics.Joints.b2JointEdge=Dt,Box2D.Dynamics.Joints.b2MouseJoint=Pt,Box2D.Dynamics.Joints.b2MouseJointDef=Ht,Box2D.Dynamics.Joints.b2PrismaticJoint=Bt,Box2D.Dynamics.Joints.b2PrismaticJointDef=jt,Box2D.Dynamics.Joints.b2PulleyJoint=Ft,Box2D.Dynamics.Joints.b2PulleyJointDef=It,Box2D.Dynamics.Joints.b2RevoluteJoint=qt,Box2D.Dynamics.Joints.b2RevoluteJointDef=Rt,Box2D.Dynamics.Joints.b2RopeJoint=Ut,Box2D.Dynamics.Joints.b2RopeJointDef=zt,Box2D.Dynamics.Joints.b2WeldJoint=Wt,Box2D.Dynamics.Joints.b2WeldJointDef=Xt,Box2D.Dynamics.Joints.b2WheelJoint=Vt,Box2D.Dynamics.Joints.b2WheelJointDef=$t,Box2D.Rope.b2Rope=Jt,Box2D.Rope.b2RopeDef=Kt}(),Box2D.postDefs=[],function(){function X(){X.b2EPAxis.apply(this,arguments)}function V(){V.b2TempPolygon.apply(this,arguments)}function $(){$.b2ReferenceFace.apply(this,arguments)}function J(){J.b2EPCollider.apply(this,arguments)}var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2ChainShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,u=Box2D.Common.b2Color,a=Box2D.Common.b2Settings,f=Box2D.Common.b2Timer,l=Box2D.Common.Math.b2Mat22,c=Box2D.Common.Math.b2Mat33,h=Box2D.Common.Math.b2Rot,p=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,v=Box2D.Common.Math.b2Transform,m=Box2D.Common.Math.b2Vec2,g=Box2D.Common.Math.b2Vec3,y=Box2D.Collision.b2AABB,b=Box2D.Collision.b2Collision,w=Box2D.Collision.b2ContactID,E=Box2D.Collision.b2Distance,S=Box2D.Collision.b2DistanceInput,x=Box2D.Collision.b2DistanceOutput,T=Box2D.Collision.b2DistanceProxy,N=Box2D.Collision.b2DynamicTree,C=Box2D.Collision.b2BroadPhase,k=Box2D.Collision.b2TreeNode,L=Box2D.Collision.b2Pair,A=Box2D.Collision.b2Manifold,O=Box2D.Collision.b2ManifoldPoint,M=Box2D.Collision.b2RayCastInput,_=Box2D.Collision.b2RayCastOutput,D=Box2D.Collision.b2SeparationFunction,P=Box2D.Collision.b2Simplex,H=Box2D.Collision.b2SimplexCache,B=Box2D.Collision.b2SimplexVertex,j=Box2D.Collision.b2TOIInput,F=Box2D.Collision.b2TOIOutput,I=Box2D.Collision.b2WorldManifold,q=Box2D.Collision.b2ClipVertex,R=Box2D.Collision.b2ContactFeature,U=Box2D.Collision.IBroadPhase,z=Box2D.Rope.b2Rope,W=Box2D.Rope.b2RopeDef;y.b2AABB=function(){this.lowerBound=new m,this.upperBound=new m},y.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,n=e>=0&&t>=0;return n=n&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),n},y.prototype.GetCenter=function(){return new m((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},y.prototype.GetExtents=function(){return new m((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},y.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},y.prototype.Contains=function(e){var t=!0;return t=t&&this.lowerBound.x<=e.lowerBound.x,t=t&&this.lowerBound.y<=e.lowerBound.y,t=t&&e.upperBound.x<=this.upperBound.x,t=t&&e.upperBound.y<=this.upperBound.y,t},y.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(o),f=Math.abs(u),l=e.normal,c=0,h=0,p=0,d=0,v=0;if(a<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{c=1/o,h=(this.lowerBound.x-i)*c,p=(this.upperBound.x-i)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.x=v,l.y=0,n=h),r=Math.min(r,p);if(n>r)return!1}if(f<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{c=1/u,h=(this.lowerBound.y-s)*c,p=(this.upperBound.y-s)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.y=v,l.x=0,n=h),r=Math.min(r,p);if(n>r)return!1}return e.fraction=n,!0},y.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x,n=e.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-e.upperBound.x,i=this.lowerBound.y-e.upperBound.y;return t>0||n>0?!1:r>0||i>0?!1:!0},y.prototype.Combine=function(e){this.lowerBound.x=Math.min(e.lowerBound.x,this.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,this.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,this.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,this.upperBound.y)},y.prototype.Combine2=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},b.b2Collision=function(){},b.ClipSegmentToLine=function(e,t,n,r,i){var s,o=0;s=t[0];var u=s.v;s=t[1];var a=s.v,f=n.x*u.x+n.y*u.y-r,l=n.x*a.x+n.y*a.y-r;f<=0&&e[o++].Set(t[0]),l<=0&&e[o++].Set(t[1]);if(f*l<0){var c=f/(f-l);s=e[o];var h=s.v;h.x=u.x+c*(a.x-u.x),h.y=u.y+c*(a.y-u.y),s=e[o],s.id.cf.indexA=i,s.id.cf.indexB=t[0].id.cf.indexB,s.id.cf.typeA=R.e_vertex,s.id.cf.typeB=R.e_face,++o}return o},b.EdgeSeparation=function(e,t,n,r,i){var s=e.m_vertices,o=e.m_normals,u=parseInt(r.m_vertexCount),a=r.m_vertices,f,l;f=t.q,l=o[n];var c=f.c*l.x-f.s*l.y,h=f.s*l.x+f.c*l.y;f=i.q;var p=f.c*c+f.s*h,d=-f.s*c+f.c*h,v=0,m=Number.MAX_VALUE,g;for(var y=0;y<u;++y)l=a[y],g=l.x*p+l.y*d,g<m&&(m=g,v=y);l=s[n],f=t.q;var b=f.c*l.x-f.s*l.y+t.p.x,w=f.s*l.x+f.c*l.y+t.p.y;l=a[v],f=i.q;var E=f.c*l.x-f.s*l.y+i.p.x,S=f.s*l.x+f.c*l.y+i.p.y;E-=b,S-=w;var x=E*c+S*h;return x},b.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;u=r.m_centroid,a=i.q;var f=i.p.x+a.c*u.x-a.s*u.y,l=i.p.y+a.s*u.x+a.c*u.y;u=t.m_centroid,a=n.q,f-=n.p.x+a.c*u.x-a.s*u.y,l-=n.p.y+a.s*u.x+a.c*u.y;var c=a.c*f+a.s*l,h=-a.s*f+a.c*l,p=0,d=-Number.MAX_VALUE;for(var v=0;v<s;++v){u=o[v];var m=u.x*c+u.y*h;m>d&&(d=m,p=v)}var g=b.EdgeSeparation(t,n,p,r,i),y=parseInt(p-1>=0?p-1:s-1),w=b.EdgeSeparation(t,n,y,r,i),E=parseInt(p+1<s?p+1:0),S=b.EdgeSeparation(t,n,E,r,i),x=0,T=0,N=0;if(w>g&&w>S)N=-1,x=y,T=w;else{if(!(S>g))return e[0]=p,g;N=1,x=E,T=S}for(;;){N==-1?p=x-1>=0?x-1:s-1:p=x+1<s?x+1:0,g=b.EdgeSeparation(t,n,p,r,i);if(!(g>T))break;x=p,T=g}return e[0]=x,T},b.FindIncidentEdge=function(e,t,n,r,i,s){var o=t.m_normals,u=parseInt(i.m_vertexCount),a=i.m_vertices,f=i.m_normals,l,c;l=n.q,c=o[r];var h=l.c*c.x-l.s*c.y,d=l.s*c.x+l.c*c.y;l=s.q;var v=l.c*h+l.s*d,m=-l.s*h+l.c*d,g=0,y=Number.MAX_VALUE;for(var b=0;b<u;++b){c=f[b];var w=v*c.x+m*c.y;w<y&&(y=w,g=b)}var E=parseInt(g),S=parseInt(E+1<u?E+1:0),x=e[0];x.v=p.MulXV(s,a[E]),x.id.cf.indexA=r,x.id.cf.indexB=E,x.id.cf.typeA=R.e_face,x.id.cf.typeB=R.e_vertex,x=e[1],x.v=p.MulXV(s,a[S]),x.id.cf.indexA=r,x.id.cf.indexB=S,x.id.cf.typeA=R.e_face,x.id.cf.typeB=R.e_vertex},b.MakeClipPointVector=function(){var e=new Vector(2);return e[0]=new q,e[1]=new q,e},b.CollidePolygons=function(e,t,n,r,i){var s;e.pointCount=0;var o=t.m_radius+r.m_radius,u=0;b.s_edgeAO[0]=u;var f=b.FindMaxSeparation(b.s_edgeAO,t,n,r,i);u=b.s_edgeAO[0];if(f>o)return;var l=0;b.s_edgeBO[0]=l;var c=b.FindMaxSeparation(b.s_edgeBO,r,i,t,n);l=b.s_edgeBO[0];if(c>o)return;var h,d,v,m,g=0,y=0,w=.98,E=.001;c>w*f+E?(h=r,d=t,v=i,m=n,g=l,e.type=A.e_faceB,y=1):(h=t,d=r,v=n,m=i,g=u,e.type=A.e_faceA,y=0);var S=b.s_incidentEdge;b.FindIncidentEdge(S,h,v,g,d,m);var x=parseInt(h.m_vertexCount),T=h.m_vertices,N=g,C=g+1<x?parseInt(g+1):0,k=T[N],L=T[C],O=b.s_localTangent;O.Set(L.x-k.x,L.y-k.y),O.Normalize();var M=b.s_localNormal;M.x=O.y,M.y=-O.x;var _=b.s_planePoint;_.Set(.5*(k.x+L.x),.5*(k.y+L.y));var D=b.s_tangent,P=v.q;D.x=P.c*O.x-P.s*O.y,D.y=P.s*O.x+P.c*O.y;var H=b.s_tangent2;H.x=-D.x,H.y=-D.y;var B=b.s_normal;B.x=D.y,B.y=-D.x;var j=b.s_v11,F=b.s_v12;j.x=v.p.x+(P.c*k.x-P.s*k.y),j.y=v.p.y+(P.s*k.x+P.c*k.y),F.x=v.p.x+(P.c*L.x-P.s*L.y),F.y=v.p.y+(P.s*L.x+P.c*L.y);var I=B.x*j.x+B.y*j.y,q=-D.x*j.x-D.y*j.y+o,R=D.x*F.x+D.y*F.y+o,U=b.s_clipPoints1,z=b.s_clipPoints2,W=0;W=b.ClipSegmentToLine(U,S,H,q,N);if(W<2)return;W=b.ClipSegmentToLine(z,U,D,R,C);if(W<2)return;e.localNormal.SetV(M),e.localPoint.SetV(_);var X=0;for(var V=0;V<a.b2_maxManifoldPoints;++V){s=z[V];var $=B.x*s.v.x+B.y*s.v.y-I;if($<=o){var J=e.points[X];J.localPoint=p.MulTXV(m,s.v),J.id.Set(s.id);if(y){var K=J.id;J.id.cf.indexA=K.cf.indexB,J.id.cf.indexB=K.cf.indexA,J.id.cf.typeA=K.cf.typeB,J.id.cf.typeB=K.cf.typeA}++X}}e.pointCount=X},b.CollideCircles=function(e,t,n,r,i){e.pointCount=0;var s,o;s=n.q,o=t.m_p;var u=n.p.x+(s.c*o.x-s.s*o.y),a=n.p.y+(s.s*o.x+s.c*o.y);s=i.q,o=r.m_p;var f=i.p.x+(s.c*o.x-s.s*o.y),l=i.p.y+(s.s*o.x+s.c*o.y),c=f-u,h=l-a,p=c*c+h*h,d=t.m_radius+r.m_radius;if(p>d*d)return;e.type=A.e_circles,e.localPoint.SetV(t.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.SetV(r.m_p),e.points[0].id.key=0},b.CollidePolygonAndCircle=function(e,t,n,r,i){e.pointCount=0;var s=p.MulXV(i,r.m_p),o=p.MulTXV(n,s),u=0,f=-a.b2_maxFloat,l=t.m_radius+r.m_radius,c=t.m_vertexCount,h=t.m_vertices,d=t.m_normals;for(var v=0;v<c;++v){var m=p.DotVV(d[v],p.SubtractVV(o,h[v]));if(m>l)return;m>f&&(f=m,u=v)}var g=u,y=g+1<c?g+1:0,b=h[g],w=h[y];if(f<a.b2_epsilon){e.pointCount=1,e.type=A.e_faceA,e.localNormal.SetV(d[u]),e.localPoint=p.MulFV(.5,p.AddVV(b,w)),e.points[0].localPoint.SetV(r.m_p),e.points[0].id.key=0;return}var E=p.DotVV(p.SubtractVV(o,b),p.SubtractVV(w,b)),S=p.DotVV(p.SubtractVV(o,w),p.SubtractVV(b,w));if(E<=0){if(p.DistanceSquared(o,b)>l*l)return;e.pointCount=1,e.type=A.e_faceA,e.localNormal=p.SubtractVV(o,b),e.localNormal.Normalize(),e.localPoint.SetV(b),e.points[0].localPoint.SetV(r.m_p),e.points[0].id.key=0}else if(S<=0){if(p.DistanceSquared(o,w)>l*l)return;e.pointCount=1,e.type=A.e_faceA,e.localNormal=p.SubtractVV(o,w),e.localNormal.Normalize(),e.localPoint.SetV(w),e.points[0].localPoint.SetV(r.m_p),e.points[0].id.key=0}else{var x=p.MulFV(.5,p.AddVV(b,w)),f=p.DotVV(p.SubtractVV(o,x),d[g]);if(f>l)return;e.pointCount=1,e.type=A.e_faceA,e.localNormal.SetV(d[g]),e.localPoint.SetV(x),e.points[0].localPoint.SetV(r.m_p),e.points[0].id.key=0}},b.CollideEdgeAndCircle=function(e,t,n,r,i){e.pointCount=0;var s=p.MulTXV(n,p.MulXV(i,r.m_p)),o=t.m_vertex1,u=t.m_vertex2,f=p.SubtractVV(u,o),l=p.DotVV(f,p.SubtractVV(u,s)),c=p.DotVV(f,p.SubtractVV(s,o)),h=t.m_radius+r.m_radius,d=new w;d.cf.indexB=0,d.cf.typeB=R.e_vertex;if(c<=0){var v=o,g=p.SubtractVV(s,v),y=p.DotVV(g,g);if(y>h*h)return;if(t.m_hasVertex0){var b=t.m_vertex0,E=o,S=p.SubtractVV(E,b),x=p.DotVV(S,p.SubtractVV(E,s));if(x>0)return}d.cf.indexA=0,d.cf.typeA=R.e_vertex,e.pointCount=1,e.type=A.e_circles,e.localNormal.SetZero(),e.localPoint=v,e.points[0].id.key=d.key,e.points[0].localPoint.SetV(r.m_p);return}if(l<=0){var v=u,g=p.SubtractVV(s,v),y=p.DotVV(g,g);if(y>h*h)return;if(t.m_hasVertex3){var T=t.m_vertex3,N=u,C=p.SubtractVV(T,N),k=p.DotVV(C,p.SubtractVV(s,N));if(k>0)return}d.cf.indexA=1,d.cf.typeA=R.e_vertex,e.pointCount=1,e.type=A.e_circles,e.localNormal.SetZero(),e.localPoint=v,e.points[0].id.key=d.key,e.points[0].localPoint.SetV(r.m_p);return}var L=p.DotVV(f,f);a.b2Assert(L>0);var v=p.MulFV(1/L,p.AddVV(p.MulFV(l,o),p.MulFV(c,u))),g=p.SubtractVV(s,v),y=p.DotVV(g,g);if(y>h*h)return;var O=new m(-f.y,f.x);p.DotVV(O,p.SubtractVV(s,o))<0&&O.Set(-O.x,-O.y),O.Normalize(),d.cf.indexA=0,d.cf.typeA=R.e_face,e.pointCount=1,e.type=A.e_faceA,e.localNormal=O,e.localPoint=o,e.points[0].id.key=d.key,e.points[0].localPoint.SetV(r.m_p)},X.b2EPAxis=function(){},X.prototype.Copy=function(){var e=new X;return e.type=this.type,e.index=this.index,e.separation=this.separation,e},Box2D.postDefs.push(function(){X.e_unknown=0,X.e_edgeA=1,X.e_edgeB=2}),V.b2TempPolygon=function(){this.vertices=new Vector,this.normals=new Vector;for(var e=0;e<a.b2_maxPolygonVertices;++e)this.vertices[e]=new m,this.normals[e]=new m;this.count=0},$.b2ReferenceFace=function(){this.v1=new m,this.v2=new m,this.normal=new m,this.sideNormal1=new m,this.sideNormal2=new m},J.b2EPCollider=function(){this.m_polygonB=new V,this.m_xf=new v,this.m_centroidB=new m,this.m_v0=new m,this.m_v1=new m,this.m_v2=new m,this.m_v3=new m,this.m_normal0=new m,this.m_normal1=new m,this.m_normal2=new m,this.m_normal=new m,this.m_lowerLimit=new m,this.m_upperLimit=new m},J.prototype.Collide=function(e,t,n,r,i){this.m_xf=p.MulTXX(n,i),this.m_centroidB=p.MulXV(this.m_xf,r.m_centroid),this.m_v0=t.m_vertex0.Copy(),this.m_v1=t.m_vertex1.Copy(),this.m_v2=t.m_vertex2.Copy(),this.m_v3=t.m_vertex3.Copy();var s=t.m_hasVertex0,o=t.m_hasVertex3,u=p.SubtractVV(this.m_v2,this.m_v1);u.Normalize(),this.m_normal1.Set(u.y,-u.x);var f=p.DotVV(this.m_normal1,p.SubtractVV(this.m_centroidB,this.m_v1)),l=0,c=0,h=!1,d=!1;if(s){var v=p.SubtractVV(this.m_v1,this.m_v0);v.Normalize(),this.m_normal0.Set(v.y,-v.x),h=p.CrossVV(v,u)>=0,l=p.DotVV(this.m_normal0,p.SubtractVV(this.m_centroidB,this.m_v0))}if(o){var m=p.SubtractVV(this.m_v3,this.m_v2);m.Normalize(),this.m_normal2.Set(m.y,-m.x),d=p.CrossVV(u,m)>0,c=p.DotVV(this.m_normal2,p.SubtractVV(this.m_centroidB,this.m_v2))}s&&o?h&&d?(this.m_front=l>=0||f>=0||c>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal0.Copy(),this.m_upperLimit=this.m_normal2.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal1.GetNegative())):h?(this.m_front=l>=0||f>=0&&c>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal0.Copy(),this.m_upperLimit=this.m_normal1.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal2.GetNegative(),this.m_upperLimit=this.m_normal1.GetNegative())):d?(this.m_front=c>=0||l>=0&&f>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal2.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal0.GetNegative())):(this.m_front=l>=0&&f>=0&&c>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal1.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal2.GetNegative(),this.m_upperLimit=this.m_normal0.GetNegative())):s?h?(this.m_front=l>=0||f>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal0.Copy(),this.m_upperLimit=this.m_normal1.GetNegative()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal1.GetNegative())):(this.m_front=l>=0&&f>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal1.GetNegative()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal0.GetNegative())):o?d?(this.m_front=f>=0||c>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal2.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal1.Copy())):(this.m_front=f>=0&&c>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal1.Copy()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal2.GetNegative(),this.m_upperLimit=this.m_normal1.Copy())):(this.m_front=f>=0,this.m_front?(this.m_normal=this.m_normal1.Copy(),this.m_lowerLimit=this.m_normal1.GetNegative(),this.m_upperLimit=this.m_normal1.GetNegative()):(this.m_normal=this.m_normal1.GetNegative(),this.m_lowerLimit=this.m_normal1.Copy(),this.m_upperLimit=this.m_normal1.Copy())),this.m_polygonB.count=r.m_vertexCount;for(var g=0;g<r.m_vertexCount;++g)this.m_polygonB.vertices[g]=p.MulXV(this.m_xf,r.m_vertices[g]),this.m_polygonB.normals[g]=p.MulRV(this.m_xf.q,r.m_normals[g]);this.m_radius=2*a.b2_polygonRadius,e.pointCount=0;var y=this.ComputeEdgeSeparation();if(y.type==X.e_unknown)return;if(y.separation>this.m_radius)return;var w=this.ComputePolygonSeparation();if(w.type!=X.e_unknown&&w.separation>this.m_radius)return;var E=.98,S=.001,x=new X;w.type==X.e_unknown?x=y.Copy():w.separation>E*y.separation+S?x=w.Copy():x=y.Copy();var T=new Vector;T[0]=new q,T[1]=new q;var N=new $;if(x.type==X.e_edgeA){e.type=A.e_faceA;var C=0,k=p.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(var g=1;g<this.m_polygonB.count;++g){var L=p.DotVV(this.m_normal,this.m_polygonB.normals[g]);L<k&&(k=L,C=g)}var O=C,M=O+1<this.m_polygonB.count?O+1:0;T[0].v=this.m_polygonB.vertices[O].Copy(),T[0].id.cf.indexA=0,T[0].id.cf.indexB=O,T[0].id.cf.typeA=R.e_face,T[0].id.cf.typeB=R.e_vertex,T[1].v=this.m_polygonB.vertices[M].Copy(),T[1].id.cf.indexA=0,T[1].id.cf.indexB=M,T[1].id.cf.typeA=R.e_face,T[1].id.cf.typeB=R.e_vertex,this.m_front?(N.i1=0,N.i2=1,N.v1=this.m_v1.Copy(),N.v2=this.m_v2.Copy(),N.normal=this.m_normal1.Copy()):(N.i1=1,N.i2=0,N.v1=this.m_v2.Copy(),N.v2=this.m_v1.Copy(),N.normal=this.m_normal1.GetNegative())}else e.type=A.e_faceB,T[0].v=this.m_v1.Copy(),T[0].id.cf.indexA=0,T[0].id.cf.indexB=x.index,T[0].id.cf.typeA=R.e_vertex,T[0].id.cf.typeB=R.e_face,T[1].v=this.m_v2.Copy(),T[1].id.cf.indexA=0,T[1].id.cf.indexB=x.index,T[1].id.cf.typeA=R.e_vertex,T[1].id.cf.typeB=R.e_face,N.i1=x.index,N.i2=N.i1+1<this.m_polygonB.count?N.i1+1:0,N.v1=this.m_polygonB.vertices[N.i1].Copy(),N.v2=this.m_polygonB.vertices[N.i2].Copy(),N.normal=this.m_polygonB.normals[N.i1].Copy();N.sideNormal1.Set(N.normal.y,-N.normal.x),N.sideNormal2=N.sideNormal1.GetNegative(),N.sideOffset1=p.DotVV(N.sideNormal1,N.v1),N.sideOffset2=p.DotVV(N.sideNormal2,N.v2);var _=new Vector;_[0]=new q,_[1]=new q;var D=new Vector;D[0]=new q,D[1]=new q;var P;P=b.ClipSegmentToLine(_,T,N.sideNormal1,N.sideOffset1,N.i1);if(P<a.b2_maxManifoldPoints)return;P=b.ClipSegmentToLine(D,_,N.sideNormal2,N.sideOffset2,N.i2);if(P<a.b2_maxManifoldPoints)return;x.type==X.e_edgeA?(e.localNormal=N.normal.Copy(),e.localPoint=N.v1.Copy()):(e.localNormal=r.m_normals[N.i1].Copy(),e.localPoint=r.m_vertices[N.i1].Copy());var H=0;for(var g=0;g<a.b2_maxManifoldPoints;++g){var B;B=p.DotVV(N.normal,p.SubtractVV(D[g].v,N.v1));if(B<=this.m_radius){var j=e.points[H];x.type==X.e_edgeA?(j.localPoint=p.MulTXV(this.m_xf,D[g].v),j.id=D[g].id.Copy()):(j.localPoint=D[g].v.Copy(),j.id.cf.typeA=D[g].id.cf.typeB,j.id.cf.typeB=D[g].id.cf.typeA,j.id.cf.indexA=D[g].id.cf.indexB,j.id.cf.indexB=D[g].id.cf.indexA),++H}}e.pointCount=H},J.prototype.ComputeEdgeSeparation=function(){var e=new X;e.type=X.e_edgeA,e.index=this.m_front?0:1,e.separation=
// a.b2_maxFloat;for(var t=0;t<this.m_polygonB.count;++t){var n=p.DotVV(this.m_normal,p.SubtractVV(this.m_polygonB.vertices[t],this.m_v1));n<e.separation&&(e.separation=n)}return e},J.prototype.ComputePolygonSeparation=function(){var e=new X;e.type=X.e_unknown,e.index=-1,e.separation=-a.b2_maxFloat;var t=new m(-this.m_normal.y,this.m_normal.x);for(var n=0;n<this.m_polygonB.count;++n){var r=this.m_polygonB.normals[n].GetNegative(),i=p.DotVV(r,p.SubtractVV(this.m_polygonB.vertices[n],this.m_v1)),s=p.DotVV(r,p.SubtractVV(this.m_polygonB.vertices[n],this.m_v2)),o=p.Min(i,s);if(o>this.m_radius)return e.type=X.e_edgeB,e.index=n,e.separation=o,e;if(p.DotVV(r,t)>=0){if(p.DotVV(p.SubtractVV(r,this.m_upperLimit),this.m_normal)<-a.b2_angularSlop)continue}else if(p.DotVV(p.SubtractVV(r,this.m_lowerLimit),this.m_normal)<-a.b2_angularSlop)continue;o>e.separation&&(e.type=X.e_edgeB,e.index=n,e.separation=o)}return e},Box2D.postDefs.push(function(){J.e_isolated=0,J.e_concave=1,J.e_convex=2}),b.CollideEdgeAndPolygon=function(e,t,n,r,i){var s=new J;s.Collide(e,t,n,r,i)},b.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.x-r.x,u=n.y-r.y;return i>0||s>0?!1:o>0||u>0?!1:!0},b.TestOverlap2=function(e,t,n,r,i,s){var o=new S;o.proxyA.Set(e,t),o.proxyB.Set(n,r),o.transformA=i.Copy(),o.transformB=s.Copy(),o.useRadii=!0;var u=new H;u.count=0;var f=new x;return E.Distance(f,u,o),f.distance<10*a.b2_epsilon},b.b2TimeOfImpact=function(e,t){++b.b2_toiCalls,e.state=F.e_unknown,e.t=t.tMax;var n=t.proxyA,r=t.proxyB,i=t.sweepA.Copy(),s=t.sweepB.Copy();i.Normalize(),s.Normalize();var o=t.tMax,u=n.m_radius+r.m_radius,f=p.Max(a.b2_linearSlop,u-3*a.b2_linearSlop),l=.25*a.b2_linearSlop;a.b2Assert(f>l);var c=0,h=20,d=0,v=b.s_cache;v.count=0;var m=b.s_distanceInput;m.proxyA=t.proxyA,m.proxyB=t.proxyB,m.useRadii=!1;for(;;){var g=b.s_xfA,y=b.s_xfB;i.GetTransform(g,c),s.GetTransform(y,c),m.transformA=g,m.transformB=y;var w=b.s_distanceOutput;E(w,v,m);if(w.distance<=0){e.state=F.e_overlapped,e.t=0;break}if(w.distance<f+l){e.state=F.e_touching,e.t=c;break}var S=b.s_fcn;S.Initialize(v,n,i,r,s,c);var x=!1,T=o,N=0;for(;;){var C=new Vector_a2j_Number(1),k=new Vector_a2j_Number(1),L=S.FindMinSeparation(C,k,T);if(L>f+l){e.state=F.e_separated,e.t=o,x=!0;break}if(L>f-l){c=T;break}var A=S.Evaluate(C[0],k[0],c);if(A<f-l){e.state=F.e_failed,e.t=c,x=!0;break}if(A<=f+l){e.state=F.e_touching,e.t=c,x=!0;break}var O=0,M=c,_=T;for(;;){var D;O&1?D=M+(f-A)*(_-M)/(L-A):D=.5*(M+_);var P=S.Evaluate(C[0],k[0],D);if(p.Abs(P-f)<l){T=D;break}P>f?(M=D,A=P):(_=D,L=P),++O,++b.b2_toiRootIters;if(O==50)break}b.b2_toiMaxRootIters=p.Max(b.b2_toiMaxRootIters,O),++N;if(N==a.b2_maxPolygonVertices)break}++d,++b.b2_toiIters;if(x)break;if(d==h){e.state=F.e_failed,e.t=c;break}}b.b2_toiMaxIters=p.Max(b.b2_toiMaxIters,d)},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new m,Box2D.Collision.b2Collision.s_localNormal=new m,Box2D.Collision.b2Collision.s_planePoint=new m,Box2D.Collision.b2Collision.s_normal=new m,Box2D.Collision.b2Collision.s_tangent=new m,Box2D.Collision.b2Collision.s_tangent2=new m,Box2D.Collision.b2Collision.s_v11=new m,Box2D.Collision.b2Collision.s_v12=new m,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new m,Box2D.Collision.b2Collision.b2_nullFeature=255,Box2D.Collision.b2Collision.b2_toiCalls=0,Box2D.Collision.b2Collision.b2_toiIters=0,Box2D.Collision.b2Collision.b2_toiMaxIters=0,Box2D.Collision.b2Collision.b2_toiRootIters=0,Box2D.Collision.b2Collision.b2_toiMaxRootIters=0,Box2D.Collision.b2Collision.s_cache=new H,Box2D.Collision.b2Collision.s_distanceInput=new S,Box2D.Collision.b2Collision.s_xfA=new v,Box2D.Collision.b2Collision.s_xfB=new v,Box2D.Collision.b2Collision.s_fcn=new D,Box2D.Collision.b2Collision.s_distanceOutput=new x}),w.b2ContactID=function(){this.cf=new R},w.prototype.b2ContactID=function(){this.cf._m_id=this,this._key=0},w.prototype.Set=function(e){this.key=e._key},w.prototype.Copy=function(){var e=new w;return e.key=this.key,e},Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.cf._indexA=e&255,this.cf._indexB=(e&65280)>>8&255,this.cf._typeA=(e&16711680)>>16&255,this.cf._typeB=(e&4278190080)>>24&255}}),E.b2Distance=function(){},E.Distance=function(e,t,n){++E.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA.Copy(),o=n.transformB.Copy(),u=E.s_simplex;u.ReadCache(t,r,s,i,o);var f=u.m_vertices,l=20,c=E.s_saveA,h=E.s_saveB,d=0,v=u.GetClosestPoint(),g=v.LengthSquared(),y=g,b=0,w,S=0;while(S<l){d=u.m_count;for(b=0;b<d;b++)c[b]=f[b].indexA,h[b]=f[b].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:a.b2Assert(!1)}if(u.m_count==3)break;w=u.GetClosestPoint(),y=w.LengthSquared(),y>g,g=y;var x=u.GetSearchDirection();if(x.LengthSquared()<a.b2_epsilon*a.b2_epsilon)break;var T=f[u.m_count];T.indexA=r.GetSupport(p.MulTRV(s.q,x.GetNegative())),T.wA=p.MulXV(s,r.GetVertex(T.indexA)),T.indexB=i.GetSupport(p.MulTRV(o.q,x)),T.wB=p.MulXV(o,i.GetVertex(T.indexB)),T.w=p.SubtractVV(T.wB,T.wA),++S,++E.b2_gjkIters;var N=!1;for(b=0;b<d;b++)if(T.indexA==c[b]&&T.indexB==h[b]){N=!0;break}if(N)break;++u.m_count}E.b2_gjkMaxIters=p.Max(E.b2_gjkMaxIters,S),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=p.Distance(e.pointA,e.pointB),e.iterations=S,u.WriteCache(t);if(n.useRadii){var C=r.m_radius,k=i.m_radius;if(e.distance>C+k&&e.distance>a.b2_epsilon){e.distance-=C+k;var L=p.SubtractVV(e.pointB,e.pointA);L.Normalize(),e.pointA.x+=C*L.x,e.pointA.y+=C*L.y,e.pointB.x-=k*L.x,e.pointB.y-=k*L.y}else w=new m,w.x=.5*(e.pointA.x+e.pointB.x),w.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=w.x,e.pointA.y=e.pointB.y=w.y,e.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new P,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),S.b2DistanceInput=function(){this.proxyA=new T,this.proxyB=new T,this.transformA=new v,this.transformB=new v,this.useRadii=!1},x.b2DistanceOutput=function(){this.distance=0,this.iterations=0,this.pointA=new m,this.pointB=new m},T.b2DistanceProxy=function(){this.m_buffer=new Vector(2),this.m_buffer[0]=new m,this.m_buffer[1]=new m,this.m_vertices=new Vector,this.m_count=0,this.m_radius=0},T.prototype.Copy=function(){var e=new T;return e.m_buffer[0]=this.m_buffer[0].Copy(),e.m_buffer[1]=this.m_buffer[1].Copy(),e.m_vertices=this.m_vertices,e.m_count=this.m_count,e.m_radius=this.m_radius,e},T.prototype.Set=function(r,s){switch(r.GetType()){case o.e_circle:var u=r instanceof e?r:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=u.m_p,this.m_count=1,this.m_radius=u.m_radius;break;case o.e_polygon:var f=r instanceof i?r:null;this.m_vertices=f.m_vertices,this.m_count=f.m_vertexCount,this.m_radius=f.m_radius;break;case o.e_chain:var l=r instanceof n?r:null;a.b2Assert(s>=0&&s<l.m_count),this.m_buffer[0].SetV(l.m_vertices[s]),s+1<l.m_count?this.m_buffer[1].SetV(l.m_vertices[s+1]):m_buffer[1].SetV(l.m_vertices[0]),this.m_vertices=this.m_buffer,this.m_count=2,this.m_radius=l.m_radius;break;case o.e_edge:var c=r instanceof t?r:null;this.m_vertices[0]=c.m_vertex1,this.m_vertices[1]=c.m_vertex2,this.m_count=2,this.m_radius=c.m_radius;break;default:a.b2Assert(!1)}},T.prototype.GetSupport=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},T.prototype.GetSupportVertex=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},T.prototype.GetVertexCount=function(){return this.m_count},T.prototype.GetVertex=function(e){return a.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},N.b2DynamicTree=function(){},N.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},N.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=a.b2_aabbExtension,i=a.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,n.height=0,this.InsertLeaf(n),n},N.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},N.prototype.MoveProxy=function(e,t,n){a.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.x>0?n.x:-n.x),i=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.y>0?n.y:-n.y);return e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-i,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+i,this.InsertLeaf(e),!0},N.prototype.GetFatAABB=function(e){return e.aabb},N.prototype.GetHeight=function(){return this.m_root==null?0:this.m_root.height},N.prototype.GetMaxBalance=function(){var e=0,t=new Vector,n=0;t[n++]=this.m_root;while(n>0){var r=t[--n];if(!r.IsLeaf()){var i=p.Abs(r.child1.height-r.child2.height);e=p.Max(e,i),t[n++]=r.child1,t[n++]=r.child2}}return e},N.prototype.GetAreaRatio=function(){if(this.m_root==null)return 0;var e=this.m_root.aabb.GetPerimeter(),t=0,n=new Vector,r=0;n[r++]=this.m_root;while(r>0){var i=n[--r];t+=i.aabb.GetPerimeter(),i.IsLeaf()||(n[r++]=i.child1,n[r++]=i.child2)}return t/e},N.prototype.GetUserData=function(e){return e.userData},N.prototype.Query=function(e,t){if(this.m_root==null)return;var n=new Vector,r=0;n[r++]=this.m_root;while(r>0){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){var s=e.QueryCallback(i);if(!s)return}else n[r++]=i.child1,n[r++]=i.child2}},N.prototype.RayCast=function(e,t){if(this.m_root==null)return;var n=t.p1,r=t.p2,i=p.SubtractVV(n,r);i.Normalize();var s=p.CrossFV(1,i),o=p.AbsV(s),u=t.maxFraction,a=new y,f=0,l=0;f=n.x+u*(r.x-n.x),l=n.y+u*(r.y-n.y),a.lowerBound.x=Math.min(n.x,f),a.lowerBound.y=Math.min(n.y,l),a.upperBound.x=Math.max(n.x,f),a.upperBound.y=Math.max(n.y,l);var c=new Vector,h=0;c[h++]=this.m_root;while(h>0){var d=c[--h];if(d.aabb.TestOverlap(a)==0)continue;var v=d.aabb.GetCenter(),m=d.aabb.GetExtents(),g=Math.abs(s.x*(n.x-v.x)+s.y*(n.y-v.y))-o.x*m.x-o.y*m.y;if(g>0)continue;if(d.IsLeaf()){var b=new M;b.p1=t.p1,b.p2=t.p2,b.maxFraction=t.maxFraction,u=e(b,d);if(u==0)return;u>0&&(f=n.x+u*(r.x-n.x),l=n.y+u*(r.y-n.y),a.lowerBound.x=Math.min(n.x,f),a.lowerBound.y=Math.min(n.y,l),a.upperBound.x=Math.max(n.x,f),a.upperBound.y=Math.max(n.y,l))}else c[h++]=d.child1,c[h++]=d.child2}},N.prototype.AllocateNode=function(){var e;return this.m_freeList?(e=this.m_freeList,this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e):(e=new k,e.height=0,e)},N.prototype.FreeNode=function(e){e.parent=this.m_freeList,e.height=-1,this.m_freeList=e},N.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null){this.m_root=e,this.m_root.parent=null;return}var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1,i=n.child2,s=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y),o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y);s<o?n=r:n=i}while(n.IsLeaf()==0);var u=n.parent,a=this.AllocateNode();a.parent=u,a.userData=null,a.aabb.Combine2(e.aabb,n.aabb),a.height=n.height+1;if(u){n.parent.child1==n?u.child1=a:u.child2=a,a.child1=n,a.child2=e,n.parent=a,e.parent=a;do{if(u.aabb.Contains(a.aabb))break;u.height=1+p.Max(u.child1.height,u.child2.height),u.aabb.Combine2(u.child1.aabb,u.child2.aabb),a=u,u=u.parent}while(u)}else a.child1=n,a.child2=e,n.parent=a,e.parent=a,this.m_root=a},N.prototype.RemoveLeaf=function(e){if(e==this.m_root){this.m_root=null;return}var t=e.parent,n=t.parent,r;t.child1==e?r=t.child2:r=t.child1;if(n){n.child1==t?n.child1=r:n.child2=r,r.parent=n,this.FreeNode(t);while(n){var i=n.aabb;n.aabb.Combine2(n.child1.aabb,n.child2.aabb),n.height=1+p.Max(n.child1.height,n.child2.height);if(i.Contains(n.aabb))break;n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(t)},N.prototype.Validate=function(){},C.b2BroadPhase=function(){this.m_tree=new N,this.m_proxyCount=0,this.m_pairCount=0,this.m_pairBuffer=new Vector,this.m_moveCount=0,this.m_moveBuffer=new Vector},C.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},C.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},C.prototype.MoveProxy=function(e,t,n){var r=this.m_tree.MoveProxy(e,t,n);r&&this.BufferMove(e)},C.prototype.TouchProxy=function(e){this.BufferMove(e)},C.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},C.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},C.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},C.prototype.GetProxyCount=function(){return this.m_proxyCount},C.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},C.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},C.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},C.prototype.QueryCallback=function(e){var t=this;if(e==t.m_queryProxyId)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new L);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyIdA=e<t.m_queryProxyId?e:t.m_queryProxyId,n.proxyIdB=e>=t.m_queryProxyId?e:t.m_queryProxyId,++t.m_pairCount,!0},C.prototype.UpdatePairs=function(e){var t=this;t.m_pairCount=0;for(var n=0;n<t.m_moveCount;++n){t.m_queryProxyId=t.m_moveBuffer[n];if(!t.m_queryProxyId)continue;var r=t.m_tree.GetFatAABB(t.m_queryProxyId);t.m_tree.Query(t,r)}t.m_moveCount=0;for(var n=0;n<t.m_pairCount;){var i=t.m_pairBuffer[n],s=t.m_tree.GetUserData(i.proxyIdA),o=t.m_tree.GetUserData(i.proxyIdB);e.AddPair(s,o),++n;while(n<t.m_pairCount){var u=t.m_pairBuffer[n];if(u.proxyIdA!=i.proxyIdA||u.proxyIdB!=i.proxyIdB)break;++n}}},C.prototype.Query=function(e,t){this.m_tree.Query(e,t)},C.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},C.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveCount]=e,++this.m_moveCount},C.prototype.UnBufferMove=function(e){var t=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(t,1),--this.m_moveCount},C.prototype.PairLessThan=function(e,t){return e.proxyIdA<t.proxyIdA?!0:e.proxyIdA==t.proxyIdA?e.proxyIdB<t.proxyIdB:!1},C.__implements={},C.__implements[U]=!0,k.b2TreeNode=function(){this.aabb=new y,this.height=-1},k.prototype.IsLeaf=function(){return this.child1==null},L.b2Pair=function(){this.proxyIdA=null,this.proxyIdB=null,this.next=null},A.b2Manifold=function(){this.pointCount=0},A.prototype.b2Manifold=function(){this.points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++)this.points[e]=new O;this.localNormal=new m,this.localPoint=new m},A.prototype.Reset=function(){for(var e=0;e<a.b2_maxManifoldPoints;e++)(this.points[e]instanceof O?this.points[e]:null).Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=0,this.pointCount=0},A.prototype.Set=function(e){this.pointCount=e.pointCount;for(var t=0;t<a.b2_maxManifoldPoints;t++)this.points[t].Set(e.points[t]);this.localNormal.SetV(e.localNormal),this.localPoint.SetV(e.localPoint),this.type=e.type},A.prototype.Copy=function(){var e=new A;return e.Set(this),e},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=0,Box2D.Collision.b2Manifold.e_faceA=1,Box2D.Collision.b2Manifold.e_faceB=2}),O.b2ManifoldPoint=function(){this.localPoint=new m,this.id=new w},O.prototype.b2ManifoldPoint=function(){this.Reset()},O.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},O.prototype.Set=function(e){this.localPoint.SetV(e.localPoint),this.normalImpulse=e.normalImpulse,this.tangentImpulse=e.tangentImpulse,this.id.Set(e.id)},M.b2RayCastInput=function(){this.p1=new m,this.p2=new m,this.maxFraction=0},_.b2RayCastOutput=function(){this.normal=new m,this.fraction=0},z.b2Rope=function(){this.m_gravity=new m},z.prototype.Initialize=function(e){a.b2Assert(e.count>=3),this.m_count=e.count,this.m_ps=new Vector(this.m_count),this.m_p0s=new Vector(this.m_count),this.m_vs=new Vector(this.m_count),this.m_ims=new Vector(this.m_count);for(var t=0;t<this.m_count;t++){this.m_ps[t]=new m,this.m_ps[t].SetV(e.vertices[t]),this.m_p0s[t]=new m,this.m_p0s[t].SetV(e.vertices[t]),this.m_vs[t]=new m,this.m_vs[t].SetZero();var n=e.masses[t];n>0?this.m_ims[t]=1/n:this.m_ims[t]=0}var r=this.m_count-1,i=this.m_count-2;this.m_Ls=new Vector(r),this.m_as=new Vector(i);for(var t=0;t<r;t++){var s=this.m_ps[t],o=this.m_ps[t+1];this.m_Ls[t]=p.Distance(s,o)}for(var t=0;t<i;t++){var s=this.m_ps[t],o=this.m_ps[t+1],u=this.m_ps[t+2],f=new m(o.x-s.x,o.y-s.y),l=new m(u.x-o.x,u.y-o.y),c=p.CrossVV(f,l),h=p.DotVV(f,l);this.m_as[t]=Math.atan2(c,h)}this.m_gravity.SetV(e.gravity),this.m_damping=e.damping,this.m_k2=e.k2,this.m_k3=e.k3},z.prototype.Step=function(e,t){if(e==0)return;var n=Math.exp(-e*this.m_damping);for(var r=0;r<this.m_count;r++)this.m_p0s[r].SetV(this.m_ps[r]),this.m_ims[r]>0&&(this.m_vs[r].x+=e*this.m_gravity.x,this.m_vs[r].y+=e*this.m_gravity.y),this.m_vs[r].Multiply(n),this.m_ps[r].x+=e*this.m_vs[r].x,this.m_ps[r].y+=e*this.m_vs[r].y;for(var r=0;r<t;r++)this.SolveC2(),this.SolveC3(),this.SolveC2();var i=1/e;for(var r=0;r<this.m_count;r++)this.m_vs[r].x=i*(this.m_ps[r].x-this.m_p0s[r].x),this.m_vs[r].y=i*(this.m_ps[r].y-this.m_p0s[r].y)},z.prototype.SolveC2=function(){var e=this.m_count-1;for(var t=0;t<e;++t){var n=this.m_ps[t].Copy(),r=this.m_ps[t+1].Copy(),i=new m(r.x-n.x,r.y-n.y),s=i.Normalize(),o=this.m_ims[t],u=this.m_ims[t+1];if(o+u==0)continue;var a=o/(o+u),f=u/(o+u);n.x-=this.m_k2*a*(this.m_Ls[t]-s)*i.x,n.y-=this.m_k2*a*(this.m_Ls[t]-s)*i.y,r.x+=this.m_k2*f*(this.m_Ls[t]-s)*i.x,r.y+=this.m_k2*f*(this.m_Ls[t]-s)*i.y,this.m_ps[t].SetV(n),this.m_ps[t+1].SetV(r)}},z.prototype.SolveC3=function(){var e=this.m_count-2;for(var t=0;t<e;++t){var n=this.m_ps[t].Copy(),r=this.m_ps[t+1].Copy(),i=this.m_ps[t+2].Copy(),s=this.m_ims[t],o=this.m_ims[t+1],u=this.m_ims[t+2],f=new m(r.x-n.x,r.y-n.y),l=new m(i.x-r.x,i.y-r.y),c=f.LengthSquared(),h=l.LengthSquared();if(c*h==0)continue;var d=p.CrossVV(f,l),v=p.DotVV(f,l),g=Math.atan2(d,v),y=f.Skew();y.Multiply(-1/c);var b=l.Skew();b.Multiply(1/h);var w=y.GetNegative(),E=new m(y.x-b.x,y.y-b.y),S=new m(b.x,b.y),x=s*p.DotVV(w,w)+o*p.DotVV(E,E)+u*p.DotVV(S,S);if(x==0)continue;x=1/x;var T=g-this.m_as[t];while(T>a.b2_pi)g-=2*b2_pi,T=g-this.m_as[t];while(T<-a.b2_pi)g+=2*b2_pi,T=g-this.m_as[t];var N=-this.m_k3*x*T;n.x+=s*N*w.x,n.y+=s*N*w.y,r.x+=o*N*E.x,r.y+=o*N*E.y,i.x+=u*N*S.x,i.y+=u*N*S.y,this.m_ps[t].SetV(n),this.m_ps[t+1].SetV(r),this.m_ps[t+2].SetV(i)}},z.prototype.GetVertexCount=function(){return this.m_count},z.prototype.GetVertices=function(){return this.m_ps},z.prototype.Draw=function(){},z.prototype.SetAngle=function(e){var t=this.m_count-2;for(var n=0;n<t;++n)this.m_as[n]=e},z.prototype.b2Rope=function(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_gravity.SetZero(),this.m_k2=1,this.m_k3=.1},W.b2RopeDef=function(){this.masses=null,this.vertices=null,this.count=0,this.gravity=new m,this.damping=.1,this.k2=.9,this.k3=.1},D.b2SeparationFunction=function(){this.m_sweepA=new d,this.m_sweepB=new d,this.m_localPoint=new m,this.m_axis=new m},D.prototype.Initialize=function(e,t,n,r,i,o){this.m_proxyA=t,this.m_proxyB=r;var u=parseInt(e.count);a.b2Assert(0<u&&u<3),this.m_sweepA=n.Copy(),this.m_sweepB=i.Copy();var f=new v,l=new v;this.m_sweepA.GetTransform(f,o),this.m_sweepB.GetTransform(l,o);if(u==1){this.m_type=D.e_points;var c=this.m_proxyA.GetVertex(e.indexA[0]),h=this.m_proxyB.GetVertex(e.indexB[0]),d=f.p.x+f.q.c*c.x-f.q.s*c.y,m=f.p.y+f.q.s*c.x+f.q.c*c.y,g=l.p.x+l.q.c*h.x-l.q.s*h.y,y=l.p.y+l.q.s*h.x+l.q.c*h.y;return this.m_axis.x=g-d,this.m_axis.y=y-m,s=this.m_axis.Normalize(),s}if(e.indexA[0]==e.indexA[1]){this.m_type=D.e_faceB;var b=this.m_proxyB.GetVertex(e.indexB[0]),w=this.m_proxyB.GetVertex(e.indexB[1]);this.m_axis=p.CrossVF(p.SubtractVV(w,b),1),this.m_axis.Normalize();var E=p.MulRV(l.q,this.m_axis);this.m_localPoint.x=.5*(b.x+w.x),this.m_localPoint.y=.5*(b.y+w.y);var S=p.MulXV(l,this.m_localPoint),x=t.GetVertex(e.indexA[0]),T=p.MulXV(f,c);return s=p.DotVV(p.SubtractVV(T,S),E),s<0&&(this.m_axis.SetV(this.m_axis.GetNegative()),s=-s),s}this.m_type=D.e_faceA;var N=this.m_proxyB.GetVertex(e.indexA[0]),C=this.m_proxyB.GetVertex(e.indexA[1]);this.m_axis=p.CrossVF(p.SubtractVV(C,N),1),this.m_axis.Normalize();var E=p.MulRV(f.q,this.m_axis);this.m_localPoint.x=.5*(N.x+C.x),this.m_localPoint.y=.5*(N.y+C.y);var T=p.MulXV(f,this.m_localPoint),k=this.m_proxyB.GetVertex(e.indexB[0]),S=p.MulXV(l,h);return s=p.DotVV(p.SubtractVV(S,T),E),s<0&&(this.m_axis.SetV(this.m_axis.GetNegative()),s=-s),s},D.prototype.FindMinSeparation=function(e,t,n){var r=new v,i=new v;this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(i,n);switch(this.m_type){case D.e_points:var s=p.MulTRV(r.q,this.m_axis),o=p.MulTRV(i.q,this.m_axis.GetNegative());e[0]=this.m_proxyA.GetSupport(s),t[0]=this.m_proxyB.GetSupport(o);var u=this.m_proxyA.GetVertex(e[0]),a=this.m_proxyB.GetVertex(t[0]),f=p.MulXV(r,u),l=p.MulXV(i,a),c=(l.x-f.x)*this.m_axis.x+(l.y-f.y)*this.m_axis.y;return c;case D.e_faceA:var h=p.MulRV(r.q,this.m_axis),f=p.MulXV(r,this.m_localPoint),o=p.MulTRV(i.q,h.GetNegative());e[0]=-1,t[0]=this.m_proxyB.GetSupport(o);var a=this.m_proxyB.GetVertex(t[0]),l=p.MulXV(i,a),c=(l.x-f.x)*h.x+(l.y-f.y)*h.y;return c;case D.e_faceB:var h=p.MulRV(i.q,this.m_axis),f=p.MulXV(i,this.m_localPoint),s=p.MulTRV(r.q,h.GetNegative());t[0]=-1,e[0]=this.m_proxyB.GetSupport(s);var u=this.m_proxyA.GetVertex(e[0]),f=p.MulXV(r,u),c=(l.x-f.x)*h.x+(l.y-f.y)*h.y;return c;default:return b2Assert(!1),e[0]=-1,t[0]=-1,0}},D.prototype.Evaluate=function(e,t,n){var r=new v,i=new v;this.m_sweepA.GetTransform(r,n),this.m_sweepB.GetTransform(i,n);switch(this.m_type){case D.e_points:var s=p.MulTRV(r.q,this.m_axis),o=p.MulTRV(i.q,this.m_axis.GetNegative()),u=this.m_proxyA.GetSupportVertex(e),f=this.m_proxyB.GetSupportVertex(t),l=p.MulXV(r,u),c=p.MulXV(i,f),h=p.DotVV(p.SubtractVV(c,l),this.m_axis);return h;case D.e_faceA:var d=p.MulRV(r.q,this.m_axis),l=p.MulXV(r,this.m_localPoint),o=p.MulTRV(i.q,d.GetNegative()),f=this.m_proxyB.GetSupportVertex(t),c=p.MulXV(i,f),h=p.DotVV(p.SubtractVV(c,l),d);return h;case D.e_faceB:var d=p.MulRV(i.q,this.m_axis),c=p.MulXV(i,this.m_localPoint),s=p.MulTRV(r.q,d.GetNegative()),u=this.m_proxyA.GetSupportVertex(e),l=p.MulXV(r,u),h=p.DotVV(p.SubtractVV(l,c),d);return h;default:return a.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=0,Box2D.Collision.b2SeparationFunction.e_faceA=1,Box2D.Collision.b2SeparationFunction.e_faceB=2}),P.b2Simplex=function(){this.m_v1=new B,this.m_v2=new B,this.m_v3=new B,this.m_vertices=new Vector(3)},P.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},P.prototype.ReadCache=function(e,t,n,r,i){a.b2Assert(0<=e.count&&e.count<=3);var s,o;this.m_count=e.count;var u=this.m_vertices;for(var f=0;f<this.m_count;f++){var l=u[f];l.indexA=e.indexA[f],l.indexB=e.indexB[f],s=t.GetVertex(l.indexA),o=r.GetVertex(l.indexB),l.wA=p.MulXV(n,s),l.wB=p.MulXV(i,o),l.w=p.SubtractVV(l.wB,l.wA),l.a=0}if(this.m_count>1){var c=e.metric,h=this.GetMetric();if(h<.5*c||2*c<h||h<a.b2_epsilon)this.m_count=0}this.m_count==0&&(l=u[0],l.indexA=0,l.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),l.wA=p.MulXV(n,s),l.wB=p.MulXV(i,o),l.w=p.SubtractVV(l.wB,l.wA),this.m_count=1)},P.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=Box2D.parseUInt(this.m_count);var t=this.m_vertices;for(var n=0;n<this.m_count;n++)e.indexA[n]=Box2D.parseUInt(t[n].indexA),e.indexB[n]=Box2D.parseUInt(t[n].indexB)},P.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=p.SubtractVV(this.m_v2.w,this.m_v1.w),t=p.CrossVV(e,this.m_v1.w.GetNegative());return t>0?p.CrossFV(1,e):p.CrossVF(e,1);default:return a.b2Assert(!1),new m}},P.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return new m;case 1:return this.m_v1.w;case 2:return new m(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return new m}},P.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:}},P.prototype.GetMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return p.Distance(this.m_v1.w,this.m_v2.w);case 3:return p.CrossVV(p.SubtractVV(this.m_v2.w,this.m_v1.w),p.SubtractVV(this.m_v3.w,this.m_v1.w));default:return 0}},P.prototype.Solve2=function(){var e=this.m_v1.w.Copy(),t=this.m_v2.w.Copy(),n=p.SubtractVV(t,e),r=-(e.x*n.x+e.y*n.y);if(r<=0){this.m_v1.a=1,this.m_count=1;return}var i=t.x*n.x+t.y*n.y;if(i<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}var s=1/(i+r);this.m_v1.a=i*s,this.m_v2.a=r*s,this.m_count=2},P.prototype.Solve3=function(){var e=this.m_v1.w.Copy(),t=this.m_v2.w.Copy(),n=this.m_v3.w.Copy(),r=p.SubtractVV(t,e),i=p.DotVV(e,r),s=p.DotVV(t,r),o=s,u=-i,a=p.SubtractVV(n,e),f=p.DotVV(e,a),l=p.DotVV(n,a),c=l,h=-f,d=p.SubtractVV(n,t),v=p.DotVV(t,d),m=p.DotVV(n,d),g=m,y=-v,b=p.CrossVV(r,a),w=b*p.CrossVV(t,n),E=b*p.CrossVV(n,e),S=b*p.CrossVV(e,t);if(u<=0&&h<=0){this.m_v1.a=1,this.m_count=1;return}if(o>0&&u>0&&S<=0){var x=1/(o+u);this.m_v1.a=o*x,this.m_v2.a=u*x,this.m_count=2;return}if(c>0&&h>0&&E<=0){var T=1/(c+h);this.m_v1.a=c*T,this.m_v3.a=h*T,this.m_count=2,this.m_v2.Set(this.m_v3);return}if(o<=0&&y<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}if(c<=0&&g<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3);return}if(g>0&&y>0&&w<=0){var N=1/(g+y);this.m_v2.a=g*N,this.m_v3.a=y*N,this.m_count=2,this.m_v1.Set(this.m_v3);return}var C=1/(w+E+S);this.m_v1.a=w*C,this.m_v2.a=E*C,this.m_v3.a=S*C,this.m_count=3},H.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},B.b2SimplexVertex=function(){},B.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},B.prototype.Copy=function(){var e=new B;return e.Set(this),e},j.b2TOIInput=function(){this.proxyA=new T,this.proxyB=new T,this.sweepA=new d,this.sweepB=new d,this.tMax=0},F.b2TOIOutput=function(){},Box2D.postDefs.push(function(){Box2D.Collision.b2TOIOutput.e_unknown=0,Box2D.Collision.b2TOIOutput.e_failed=1,Box2D.Collision.b2TOIOutput.e_overlapped=2,Box2D.Collision.b2TOIOutput.e_touching=3,Box2D.Collision.b2TOIOutput.e_separated=4}),I.b2WorldManifold=function(){this.normal=new m},I.prototype.b2WorldManifold=function(){this.points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++)this.points[e]=new m},I.prototype.Initialize=function(e,t,n,r,i){if(e.pointCount==0)return;var s,o;switch(e.type){case A.e_circles:this.normal.Set(1,0);var u=p.MulXV(t,e.localPoint),f=p.MulXV(r,e.points[0].localPoint);p.DistanceSquared(u,f)>a.b2_epsilon*a.b2_epsilon&&(this.normal=p.SubtractVV(f,u),this.normal.Normalize());var l=p.AddVV(u,p.MulFV(n,this.normal)),c=p.SubtractVV(f,p.MulFV(i,this.normal));this.points[0].x=.5*(l.x+c.x),this.points[0].y=.5*(l.y+c.y);break;case A.e_faceA:s=t.q,o=e.localNormal,this.normal.x=s.c*o.x-s.s*o.y,this.normal.y=s.s*o.x+s.c*o.y,o=e.localPoint;var h=s.c*o.x-s.s*o.y+t.p.x,d=s.s*o.x+s.c*o.y+t.p.y;s=r.q;for(var v=0;v<e.pointCount;++v){o=e.points[v].localPoint;var m=s.c*o.x-s.s*o.y+r.p.x,g=s.s*o.x+s.c*o.y+r.p.y,y=(m-h)*this.normal.x+(g-d)*this.normal.y,b=m+(n-y)*this.normal.x,w=g+(n-y)*this.normal.y,E=m-i*this.normal.x,S=g-i*this.normal.y;this.points[v].Set(.5*(b+E),.5*(w+S))}break;case A.e_faceB:s=r.q,o=e.localNormal,this.normal.x=s.c*o.x-s.s*o.y,this.normal.y=s.s*o.x+s.c*o.y,o=e.localPoint;var h=s.c*o.x-s.s*o.y+r.p.x,d=s.s*o.x+s.c*o.y+r.p.y;s=t.q;for(var v=0;v<e.pointCount;++v){o=e.points[v].localPoint;var m=s.c*o.x-s.s*o.y+t.p.x,g=s.s*o.x+s.c*o.y+t.p.y,y=(m-h)*this.normal.x+(g-d)*this.normal.y,E=m+(i-y)*this.normal.x,S=g+(i-y)*this.normal.y,b=m-n*this.normal.x,w=g-n*this.normal.y;this.points[v].Set(.5*(b+E),.5*(w+S))}this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}},q.b2ClipVertex=function(){this.v=new m,this.id=new w},q.prototype.Copy=function(){var e=new q;return e.Set(this),e},q.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},R.b2ContactFeature=function(){},Object.defineProperty(R.prototype,"indexA",{enumerable:!1,configurable:!0,get:function(){return this._indexA}}),Object.defineProperty(R.prototype,"indexA",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._indexA=e,this._m_id._key=this._m_id._key&4294967040|this._indexA&255}}),Object.defineProperty(R.prototype,"indexB",{enumerable:!1,configurable:!0,get:function(){return this._indexB}}),Object.defineProperty(R.prototype,"indexB",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._indexB=e,this._m_id._key=this._m_id._key&4294902015|this._indexB<<8&65280}}),Object.defineProperty(R.prototype,"typeA",{enumerable:!1,configurable:!0,get:function(){return this._typeA}}),Object.defineProperty(R.prototype,"typeA",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._typeA=e,this._m_id._key=this._m_id._key&4278255615|this._typeA<<16&16711680}}),Object.defineProperty(R.prototype,"typeB",{enumerable:!1,configurable:!0,get:function(){return this._typeB}}),Object.defineProperty(R.prototype,"typeB",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._typeB=e,this._m_id._key=this._m_id._key&16777215|this._typeB<<24&4278190080}}),Box2D.postDefs.push(function(){Box2D.Collision.b2ContactFeature.e_vertex=0,Box2D.Collision.b2ContactFeature.e_face=1})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,n=Box2D.Common.b2Timer,r=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeShape,s=Box2D.Collision.Shapes.b2ChainShape,o=Box2D.Collision.Shapes.b2MassData,u=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,f=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Rot,h=Box2D.Common.Math.b2Math,p=Box2D.Common.Math.b2Sweep,d=Box2D.Common.Math.b2Transform,v=Box2D.Common.Math.b2Vec2,m=Box2D.Common.Math.b2Vec3,g=Box2D.Dynamics.b2Body,y=Box2D.Dynamics.b2BodyDef,b=Box2D.Dynamics.b2ContactFilter,w=Box2D.Dynamics.b2ContactImpulse,E=Box2D.Dynamics.b2ContactListener,S=Box2D.Dynamics.b2ContactManager,x=Box2D.Dynamics.b2Draw,T=Box2D.Dynamics.b2DestructionListener,N=Box2D.Dynamics.b2Filter,C=Box2D.Dynamics.b2Fixture,k=Box2D.Dynamics.b2FixtureDef,L=Box2D.Dynamics.b2FixtureProxy,A=Box2D.Dynamics.b2Island,O=Box2D.Dynamics.b2Position,M=Box2D.Dynamics.b2Profile,_=Box2D.Dynamics.b2SolverData,D=Box2D.Dynamics.b2TimeStep,P=Box2D.Dynamics.b2Velocity,H=Box2D.Dynamics.b2World,B=Box2D.Collision.b2AABB,j=Box2D.Collision.b2Collision,F=Box2D.Collision.b2ContactID,I=Box2D.Collision.b2Distance,q=Box2D.Collision.b2DistanceInput,R=Box2D.Collision.b2DistanceOutput,U=Box2D.Collision.b2DistanceProxy,z=Box2D.Collision.b2DynamicTree,W=Box2D.Collision.b2BroadPhase,X=Box2D.Collision.b2TreeNode,V=Box2D.Collision.b2Pair,$=Box2D.Collision.b2Manifold,J=Box2D.Collision.b2ManifoldPoint,K=Box2D.Collision.b2RayCastInput,Q=Box2D.Collision.b2RayCastOutput,G=Box2D.Collision.b2SeparationFunction,Y=Box2D.Collision.b2Simplex,Z=Box2D.Collision.b2SimplexCache,et=Box2D.Collision.b2SimplexVertex,tt=Box2D.Collision
// .b2TOIInput,nt=Box2D.Collision.b2TOIOutput,rt=Box2D.Collision.b2WorldManifold,it=Box2D.Collision.b2ClipVertex,st=Box2D.Collision.b2ContactFeature,ot=Box2D.Collision.IBroadPhase,ut=Box2D.Rope.b2Rope,at=Box2D.Rope.b2RopeDef;Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new v},r.prototype.Copy=function(){var e=new r;return e.SetByOther(this),e},r.prototype.SetByOther=function(e){this.__super.SetByOther.call(this,e),Box2D.is(e,r)&&this.m_p.SetV(e.m_p)},r.prototype.TestPoint=function(e,t){var n=h.AddVV(e.p,h.MulRV(e.q,this.m_p)),r=h.SubtractVV(t,n);return r.x*r.x+r.y*r.y<=this.m_radius*this.m_radius},r.prototype.RayCast=function(e,t,n,r){var i=n.q,s=n.p.x+(i.c*this.m_p.x-i.s*this.m_p.y),o=n.p.y+(i.s*this.m_p.x+i.c*this.m_p.y),u=t.p1.x-s,a=t.p1.y-o,f=u*u+a*a-this.m_radius*this.m_radius,l=t.p2.x-t.p1.x,c=t.p2.y-t.p1.y,h=u*l+a*c,p=l*l+c*c,d=h*h-p*f;if(d<0||p<Number.MIN_VALUE)return!1;var v=-(h+Math.sqrt(d));return 0<=v&&v<=t.maxFraction*p?(v/=p,e.fraction=v,e.normal.x=u+v*l,e.normal.y=a+v*c,e.normal.Normalize(),!0):!1},r.prototype.ComputeAABB=function(e,t,n){var r=t.q,i=t.p.x+(r.c*this.m_p.x-r.s*this.m_p.y),s=t.p.y+(r.s*this.m_p.x+r.c*this.m_p.y);e.lowerBound.Set(i-this.m_radius,s-this.m_radius),e.upperBound.Set(i+this.m_radius,s+this.m_radius)},r.prototype.ComputeMass=function(e,n){e.mass=n*t.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},r.prototype.b2CircleShape=function(e){this.__super.b2Shape.call(this),this.m_type=a.e_circle,this.m_radius=e,this.m_p.SetZero()},r.prototype.GetChildCount=function(){return 1},r.prototype.GetSupport=function(e){return 0},r.prototype.GetSupportVertex=function(e){return this.m_p},r.prototype.GetVertex=function(e){return this.m_p},r.prototype.GetVertexCount=function(){return 1},Box2D.inherit(i,Box2D.Collision.Shapes.b2Shape),i.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,i.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_vertex1=new v,this.m_vertex2=new v,this.m_vertex0=new v,this.m_vertex3=new v,this.m_hasVertex0=!1,this.m_hasVertex3=!1},i.prototype.Copy=function(){var e=new i;return e.SetByOther(this),e},i.prototype.SetByOther=function(e){this.__super.SetByOther.call(this,e),Box2D.is(e,i)&&(this.m_vertex1.SetV(e.m_vertex1),this.m_vertex2.SetV(e.m_vertex2),this.m_vertex0.SetV(e.m_vertex0),this.m_vertex3.SetV(e.m_vertex3),this.m_hasVertex0=e.m_hasVertex0,this.m_hasVertex3=e.m_hasVertex3)},i.prototype.TestPoint=function(e,t){return!1},i.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.q;var o=n.p.x+(r.c*this.m_vertex1.x-r.s*this.m_vertex1.y),u=n.p.y+(r.s*this.m_vertex1.x+r.c*this.m_vertex1.y),a=n.p.y+(r.s*this.m_vertex2.x+r.c*this.m_vertex2.y)-u,f=-(n.p.x+(r.c*this.m_vertex2.x-r.s*this.m_vertex2.y)-o),l=100*Number.MIN_VALUE,c=-(i*a+s*f);if(c>l){var h=t.p1.x-o,p=t.p1.y-u,d=h*a+p*f;if(0<=d&&d<=t.maxFraction*c){var v=-i*p+s*h;if(-l*c<=v&&v<=c*(1+l)){d/=c,e.fraction=d;var m=Math.sqrt(a*a+f*f);return e.normal.x=a/m,e.normal.y=f/m,!0}}}return!1},i.prototype.ComputeAABB=function(e,t,n){var r=h.MulXV(t,this.m_vertex1),i=h.MulXV(t,this.m_vertex2),s=h.MinV(r,i),o=h.MaxV(r,i),u=new v(this.m_radius,this.m_radius);s.Subtract(u),o.Add(u),e.lowerBound=s,e.upperBound=o},i.prototype.ComputeMass=function(e,t){e.mass=0;var n=(this.m_vertex1.x+this.m_vertex2.x)/2,r=(this.m_vertex1.y+this.m_vertex2.y)/2;e.center.Set(n,r),e.I=0},i.prototype.GetChildCount=function(){return 1},i.prototype.Set=function(e,t){this.m_vertex1.SetV(e),this.m_vertex2.SetV(t),this.m_hasVertex0=!1,this.m_hasVertex3=!1},i.prototype.b2EdgeShape=function(e,n){this.__super.b2Shape.call(this),this.m_type=a.e_edge,this.m_radius=t.b2_polygonRadius,e!=undefined&&n!=undefined&&this.Set(e,n)},Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape),s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,s.b2ChainShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_vertices=null,this.m_prevVertex=new v,this.m_nextVertex=new v,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1},s.prototype.Copy=function(){var e=new s;return e.SetByOther(this),e},s.prototype.SetByOther=function(e){this.__super.SetByOther.call(this,e);if(Box2D.is(e,s)){this.m_count=e.m_count,this.m_vertices=new Vector(e.m_vertices.length);for(var t=0;t<e.m_vertices.length;t++)this.m_vertices[t]=new v,this.m_vertices[t].SetV(e.m_vertices[t]);this.m_prevVertex.SetV(e.m_prevVertex),this.m_nextVertex.SetV(e.m_nextVertex),this.m_hasPrevVertex=e.m_hasPrevVertex,this.m_hasNextVertex=e.m_hasNextVertex}},s.prototype.CreateLoop=function(e){t.b2Assert(this.m_count===0&&this.m_vertices===null),t.b2Assert(e.length>=3),this.m_count=e.length+1,this.m_vertices=new Vector(this.m_count);for(var n=0;n<e.length;n++)this.m_vertices[n]=e[n].Copy();this.m_vertices[e.length]=this.m_vertices[0].Copy(),this.m_prevVertex.SetV(this.m_vertices[this.m_count-2]),this.m_nextVertex.SetV(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0},s.prototype.CreateChain=function(e){t.b2Assert(this.m_count===0&&this.m_vertices===null),t.b2Assert(e.length>=2),this.m_count=e.length,this.m_vertices=new Vector(this.m_count);for(var n=0;n<e.length;n++)this.m_vertices[n]=e[n].Copy();this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1},s.prototype.SetPrevVertex=function(e){this.m_prevVertex.SetV(e),this.m_hasPrevVertex=!0},s.prototype.SetNextVertex=function(e){this.m_nextVertex.SetV(e),this.m_hasNextVertex=!0},s.prototype.GetChildEdge=function(e,n){t.b2Assert(0<=n&&n<this.m_count-1),e.m_type=a.e_edge,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[n],e.m_vertex2=this.m_vertices[n+1],n>0?(e.m_vertex0=this.m_vertices[n-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),n<this.m_count-2?(e.m_vertex3=this.m_vertices[n+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},s.prototype.TestPoint=function(e,t){return!1},s.prototype.RayCast=function(e,n,r,s){t.b2Assert(s<this.m_count);var o=new i,u=s,a=s+1;return a==this.m_count&&(a=0),o.m_vertex1=m_vertices[u].Copy(),o.m_vertex2=m_vertices[a].Copy(),o.RayCast(e,n,r,0)},s.prototype.ComputeAABB=function(e,n,r){t.b2Assert(0<=r&&r<this.m_count);var i=r,s=r+1;s==this.m_count&&(s=0);var o=h.MulXV(n,this.m_vertices[i]),u=h.MulXV(n,this.m_vertices[s]);e.lowerBound=h.MinV(o,u),e.upperBound=h.MaxV(o,u)},s.prototype.ComputeMass=function(e,t){t===undefined&&(t=0),e.mass=0,e.center.SetZero(),e.I=0},s.prototype.GetChildCount=function(){return this.m_count-1},s.prototype.b2ChainShape=function(){this.__super.b2Shape.call(this),this.m_type=a.e_chain,this.m_radius=t.b2_polygonRadius,this.m_vertices=null,this.m_count=0,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1},o.b2MassData=function(){this.mass=0,this.center=new v(0,0),this.I=0},o.prototype.Set=function(e){this.mass=e.mass,this.center.SetV(e.center),this.I=e.I},o.prototype.Copy=function(){var e=new o;return e.Set(this),e},Box2D.inherit(u,Box2D.Collision.Shapes.b2Shape),u.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,u.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},u.prototype.Copy=function(){var e=new u;return e.SetByOther(this),e},u.prototype.GetChildCount=function(){return 1},u.prototype.SetByOther=function(e){this.__super.SetByOther.call(this,e);if(Box2D.is(e,u)){this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},u.prototype.Set=function(e){this.m_vertexCount=e.length,this.Reserve(this.m_vertexCount);for(var n=0;n<e.length;++n)this.m_vertices[n].SetV(e[n]);for(var n=0;n<this.m_vertexCount;++n){var r=n,i=n+1<this.m_vertexCount?n+1:0,s=h.SubtractVV(this.m_vertices[i],this.m_vertices[r]);t.b2Assert(s.LengthSquared()>t.b2_epsilon*t.b2_epsilon),this.m_normals[n]=h.CrossVF(s,1),this.m_normals[n].Normalize()}this.m_centroid=u.ComputeCentroid(this.m_vertices,this.m_vertexCount)},u.prototype.SetAsVector=function(e,n){n===undefined&&(n=0),n==0&&(n=e.length),t.b2Assert(2<=n),this.m_vertexCount=n,this.Reserve(n);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(e[r]);for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r),s=parseInt(r+1<this.m_vertexCount?r+1:0),o=h.SubtractVV(this.m_vertices[s],this.m_vertices[i]);t.b2Assert(o.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(h.CrossVF(o,1)),this.m_normals[r].Normalize()}this.m_centroid=u.ComputeCentroid(this.m_vertices,this.m_vertexCount)},u.prototype.SetAsBox=function(e,t,n,r){if(n!=undefined&&r!=undefined){this.SetAsOrientedBox(e,t,n,r);return}this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},u.prototype.SetAsOrientedBox=function(e,t,n,r){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetV(n);var i=new d;i.Set(n,r);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=h.MulXV(i,this.m_vertices[s]),this.m_normals[s]=h.MulRV(i.q,this.m_normals[s])},u.prototype.TestPoint=function(e,t){var n,r=e.q,i=t.x-e.p.x,s=t.y-e.p.y,o=i*r.c+s*r.s,u=-i*r.s+s*r.c;for(var a=0;a<this.m_vertexCount;++a){n=this.m_vertices[a],i=o-n.x,s=u-n.y,n=this.m_normals[a];var f=n.x*i+n.y*s;if(f>0)return!1}return!0},u.prototype.RayCast=function(e,t,n,r){var i=0,s=t.maxFraction,o=0,u=0,a,f;o=t.p1.x-n.p.x,u=t.p1.y-n.p.y,a=n.q;var l=o*a.c+u*a.s,c=-o*a.s+u*a.c;o=t.p2.x-n.p.x,u=t.p2.y-n.p.y,a=n.q;var h=o*a.c+u*a.s,p=-o*a.s+u*a.c,d=h-l,v=p-c,m=parseInt(-1);for(var g=0;g<this.m_vertexCount;++g){f=this.m_vertices[g],o=f.x-l,u=f.y-c,f=this.m_normals[g];var y=f.x*o+f.y*u,b=f.x*d+f.y*v;if(b==0){if(y<0)return!1}else b<0&&y<i*b?(i=y/b,m=g):b>0&&y<s*b&&(s=y/b);if(s<i-Number.MIN_VALUE)return!1}return m>=0?(e.fraction=i,a=n.q,f=this.m_normals[m],e.normal.x=a.c*f.x-a.s*f.y,e.normal.y=a.s*f.x+a.c*f.y,!0):!1},u.prototype.ComputeAABB=function(e,t,n){var r=t.q,i=this.m_vertices[0],s=r.c*i.x-r.s*i.y+t.p.x,o=r.s*i.x+r.c*i.y+t.p.y,u=s,a=o;for(var f=1;f<this.m_vertexCount;++f){i=this.m_vertices[f];var l=r.c*i.x-r.s*i.y+t.p.x,c=r.s*i.x+r.c*i.y+t.p.y;s=s<l?s:l,o=o<c?o:c,u=u>l?u:l,a=a>c?a:c}e.lowerBound.x=s-this.m_radius,e.lowerBound.y=o-this.m_radius,e.upperBound.x=u+this.m_radius,e.upperBound.y=a+this.m_radius},u.prototype.ComputeMass=function(e,n){t.b2Assert(this.m_vertexCount>=3);var r=0,i=0,s=0,o=0,u=0,a=0;for(var f=0;f<this.m_vertexCount;++f)u+=this.m_vertices[f].x,a+=this.m_vertices[f].y;u*=1/this.m_vertexCount,a*=1/this.m_vertexCount;var l=1/3;for(var f=0;f<this.m_vertexCount;++f){var c=this.m_vertices[f].x-u,p=this.m_vertices[f].y-a,d=f+1<this.m_vertexCount?this.m_vertices[parseInt(f+1)]:this.m_vertices[0],v=d.x-u,m=d.y-a,g=c*m-p*v,y=.5*g;s+=y,r+=y*l*(c+v),i+=y*l*(p+m);var b=c*c+v*c+v*v,w=p*p+m*p+m*m;o+=.25*l*g*(b+w)}e.mass=n*s,r*=1/s,i*=1/s,e.center.Set(r+u,i+a),e.I=n*o,e.I+=e.mass*(h.DotVV(e.center,e.center)-(r*r+i*i))},u.prototype.GetVertexCount=function(){return this.m_vertexCount},u.prototype.GetVertex=function(e){return t.b2Assert(0<=e&&e<this.m_vertexCount),this.m_vertices[e]},u.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=a.e_polygon,this.m_radius=t.b2_polygonRadius,this.m_centroid=new v,this.m_vertices=new Vector,this.m_normals=new Vector},u.prototype.Reserve=function(e){for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new v,this.m_normals[t]=new v},u.ComputeCentroid=function(e,n){t.b2Assert(n>=3);var r=new v,i=0,s=0,o=0,u=1/3;for(var a=0;a<n;++a){var f=e[a],l=a+1<n?e[parseInt(a+1)]:e[0],c=f.x-s,h=f.y-o,p=l.x-s,d=l.y-o,m=c*d-h*p,g=.5*m;i+=g,r.x+=g*u*(s+f.x+l.x),r.y+=g*u*(o+f.y+l.y)}return r.x*=1/i,r.y*=1/i,r},a.b2Shape=function(){},a.prototype.Copy=function(){return null},a.prototype.SetByOther=function(e){this.m_type=e.m_type,this.m_radius=e.m_radius},a.prototype.GetType=function(){return this.m_type},a.prototype.GetChildCount=function(){return 0},a.prototype.TestPoint=function(e,t){return!1},a.prototype.RayCast=function(e,t,n){return!1},a.prototype.ComputeAABB=function(e,t){},a.prototype.ComputeMass=function(e,t){},a.prototype.b2Shape=function(){this.m_type=a.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circle=0,Box2D.Collision.Shapes.b2Shape.e_edge=1,Box2D.Collision.Shapes.b2Shape.e_polygon=2,Box2D.Collision.Shapes.b2Shape.e_chain=3,Box2D.Collision.Shapes.b2Shape.e_typeCount=4})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,n=Box2D.Common.b2Timer,r=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Rot,o=Box2D.Common.Math.b2Math,u=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3;e.b2Color=function(){this.r=0,this.g=0,this.b=0},e.prototype.b2Color=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.r=o.Clamp(e,0,1),this.g=o.Clamp(t,0,1),this.b=o.Clamp(n,0,1)},e.prototype.Set=function(e,t,n){this.r=o.Clamp(e,0,1),this.g=o.Clamp(t,0,1),this.b=o.Clamp(n,0,1)},Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return Box2D.parseUInt(this.r*255)<<16|Box2D.parseUInt(this.g*255)<<8|Box2D.parseUInt(this.b*255)}}),t.b2Settings=function(){},t.b2MixFriction=function(e,t){return Math.sqrt(e*t)},t.b2MixRestitution=function(e,t){return e>t?e:t},t.b2Assert=function(e){if(!e)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.2.1",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxFloat=Number.MAX_VALUE,Box2D.Common.b2Settings.b2_epsilon=Number.MIN_VALUE,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_maxPolygonVertices=8,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,Box2D.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,Box2D.Common.b2Settings.b2_maxSubSteps=8,Box2D.Common.b2Settings.b2_maxTOIContacts=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,Box2D.Common.b2Settings.b2_baumgarte=.2,Box2D.Common.b2Settings.b2_toiBaugarte=.75,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi}),n.b2Timer=function(){},n.prototype.b2Timer=function(){this.Reset()},n.prototype.Reset=function(){var e=new Date;this.m_start_msec=e.getTime()},n.prototype.GetMilliseconds=function(){var e=new Date,t=e.getTime();return t-this.m_start_msec}}(),function(){var e=Box2D.Collision.b2AABB,t=Box2D.Common.b2Color,n=Box2D.Common.b2Settings,r=Box2D.Common.b2Timer,i=Box2D.Common.Math.b2Mat22,s=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Rot,u=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,f=Box2D.Common.Math.b2Transform,l=Box2D.Common.Math.b2Vec2,c=Box2D.Common.Math.b2Vec3;i.b2Mat22=function(){this.ex=new l,this.ey=new l},i.prototype.b2Mat22=function(e,t,n,r){typeof e=="number"?(this.ex.x=e,this.ex.y=n,this.ey.x=t,this.ey.y=r):e instanceof l&&this.Set(e,t)},i.prototype.Set=function(e,t){this.ex.SetV(e),this.ey.SetV(t)},i.prototype.Copy=function(){var e=new i;return e.SetM(this),e},i.prototype.SetM=function(e){this.ex.SetV(e.ex),this.ey.SetV(e.ey)},i.prototype.SetIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},i.prototype.SetZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},i.prototype.GetInverse=function(){var e=this.ex.x,t=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-t*n;s!=0&&(s=1/s);var o=new i;return o.ex.x=s*r,o.ey.x=-s*t,o.ex.y=-s*n,o.ey.y=s*e,o},i.prototype.Solve=function(e){var t=this.ex.x,n=this.ey.x,r=this.ex.y,i=this.ey.y,s=t*i-n*r;s!=0&&(s=1/s);var o=new l;return o.x=s*(i*e.x-n*e.y),o.y=s*(t*e.y-r*e.x),o},s.b2Mat33=function(){this.ex=new c,this.ey=new c,this.ez=new c},s.prototype.b2Mat33=function(e,t,n){e!=undefined&&t!=undefined&&n!=undefined&&(this.ex.SetV(e),this.ey.SetV(t),this.ez.SetV(n))},s.prototype.Copy=function(){return new s(this.ex,this.ey,this.ez)},s.prototype.SetM=function(e){this.ex.SetV(e.ex),this.ey.SetV(e.ey),this.ez.SetV(e.ez)},s.prototype.SetZero=function(){this.ex.x=0,this.ey.x=0,this.ez.x=0,this.ex.y=0,this.ey.y=0,this.ez.y=0,this.ex.z=0,this.ey.z=0,this.ez.z=0},s.prototype.Solve22=function(e){var t=this.ex.x,n=this.ey.x,r=this.ex.y,i=this.ey.y,s=t*i-n*r;s!=0&&(s=1/s);var o=new l;return o.x=s*(i*e.x-n*e.y),o.y=s*(t*e.y-r*e.x),o},s.prototype.Solve33=function(e){var t=u.DotVV3(this.ex,u.CrossVV3(this.ey,this.ez));t!=0&&(t=1/t);var n=new c;return n.x=t*u.DotVV3(e,u.CrossVV3(this.ey,this.ez)),n.y=t*u.DotVV3(this.ex,u.CrossVV3(e,this.ez)),n.z=t*u.DotVV3(this.ex,u.CrossVV3(this.ey,e)),n},s.prototype.GetInverse22=function(e){var t=this.ex.x,n=this.ey.x,r=this.ex.y,i=this.ey.y,s=t*i-n*r;s!=0&&(s=1/s),e.ex.x=s*i,e.ey.x=-s*n,e.ex.z=0,e.ex.y=-s*r,e.ey.y=s*t,e.ey.z=0,e.ez.x=0,e.ez.y=0,e.ez.z=0},s.prototype.GetSymInverse33=function(e){var t=u.DotVV3(this.ex,u.CrossVV3(this.ey,this.ez));t!=0&&(t=1/t);var n=this.ex.x,r=this.ey.x,i=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;e.ex.x=t*(s*a-o*o),e.ex.y=t*(i*o-r*a),e.ex.z=t*(r*o-i*s),e.ey.x=e.ex.y,e.ey.y=t*(n*a-i*i),e.ey.z=t*(i*r-n*o),e.ez.x=e.ex.z,e.ez.y=e.ey.z,e.ez.z=t*(n*s-r*r)},o.b2Rot=function(){},o.prototype.b2Rot=function(e){this.s=Math.sin(e),this.c=Math.cos(e)},o.prototype.Set=function(e){this.s=Math.sin(e),this.c=Math.cos(e)},o.prototype.SetIdentity=function(){this.s=0,this.c=1},o.prototype.GetAngle=function(){return Math.atan2(this.s,this.c)},o.prototype.GetXAxis=function(){return new l(this.c,this.s)},o.prototype.GetYAxis=function(){return new l(-this.s,this.c)},u.b2Math=function(){},u.IsValid=function(e){return e===undefined?!1:isNaN(e)?!1:isFinite(e)},u.Dot=function(e,t){return e.z!=undefined&&t.z!=undefined?u.DotVV3(e,t):u.DotVV(e,t)},u.DotVV=function(e,t){return e.x*t.x+e.y*t.y},u.DotVV3=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},u.Cross=function(e,t){if(e instanceof l&&t instanceof l)return u.CrossVV(e,t);if(e instanceof l&&typeof t=="number")return u.CrossVF(e,t);if(t instanceof l&&typeof e=="number")return u.CrossFV(e,t);if(e instanceof c&&t instanceof c)return u.CrossVV3(e,t);n.b2Assert(0)},u.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},u.CrossVF=function(e,t){var n=new l(t*e.y,-t*e.x);return n},u.CrossFV=function(e,t){var n=new l(-e*t.y,e*t.x);return n},u.CrossVV3=function(e,t){return new c(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},u.Mul=function(e,t){if(typeof e=="number"&&t instanceof l)return u.MulFV(e,t);if(typeof e=="number"&&t instanceof c)return u.MulFV3(e,t);if(e instanceof i&&t instanceof l)return u.MulMV(e,t);if(e instanceof i&&t instanceof i)return u.MulMM(e,t);if(e instanceof s&&t instanceof c)return u.MulMV3(e,t);if(e instanceof s&&t instanceof c)return u.MulMV3(e,t);if(e instanceof o&&t instanceof o)return u.MulRR(e,t);if(e instanceof o&&t instanceof l)return u.MulRV(e,t);if(e instanceof f&&t instanceof l)return u.MulXV(e,t);if(e instanceof f&&t instanceof f)return u.MulXX(e,t);n.b2Assert(0)},u.MulFV=function(e,t){return new l(e*t.x,e*t.y)},u.MulFV3=function(e,t){return new c(e*t.x,e*t.y,e*t.z)},u.MulMV=function(e,t){return new l(e.ex.x*t.x+e.ey.x*t.y,e.ex.y*t.x+e.ey.y*t.y)},u.MulMM=function(e,t){var n=new i(u.MulMV(e,t.ex),u.MulMV(e,t.ey));return n},u.MulMV3=function(e,t){return new c(e.ex.x*t.x+e.ey.x*t.y+e.ez.x*t.z,e.ex.y*t.x+e.ey.y*t.y+e.ez.y*t.z,e.ex.z*t.x+e.ey.z*t.y+e.ez.z*t.z)},u.MulRV=function(e,t){var n=new l(e.c*t.x-e.s*t.y,e.s*t.x+e.c*t.y);return n},u.MulRR=function(e,t){var n=new o;return n.s=e.s*t.c+e.c*t.s,n.c=e.c*t.c-e.s*t.s,n},u.MulT=function(e,t){if(e instanceof i&&t instanceof l)return u.MulTMV(e,t);if(e instanceof i&&t instanceof i)return u.MulTMM(e,t);if(e instanceof o&&t instanceof o)return u.MulTRR(e,t);if(e instanceof o&&t instanceof l)return u.MulTRV(e,t);if(e instanceof f&&t instanceof l)return u.MulTXV(e,t);if(e instanceof f&&t instanceof f)return u.MulTXX(e,t);n.b2Assert(0)},u.MulTMV=function(e,t){var n=new l(u.DotVV(t,e.ex),u.DotVV(t,e.ey));return n},u.MulTRV=function(e,t){return new l(e.c*t.x+e.s*t.y,-e.s*t.x+e.c*t.y)},u.MulTRR=function(e,t){var n=new o;return n.s=e.c*t.s-e.s*t.c,n.c=e.c*t.c+e.s*t.s,n},u.MulTMM=function(e,t){var n=new l(u.DotVV(e.ex,t.ex),u.DotVV(e.ey,t.ex)),r=new l(u.DotVV(e.ex,t.ey),u.DotVV(e.ey,t.ey)),s=new i(n,r);return s},u.MulXV=function(e,t){var n=e.q.c*t.x-e.q.s*t.y+e.p.x,r=e.q.s*t.x+e.q.c*t.y+e.p.y;return new l(n,r)},u.MulXX=function(e,t){var n=new f;return n.q=u.MulRR(e.q,t.q),n.p=u.AddVV(u.MulRV(e.q,t.p),e.p),n},u.MulTXV=function(e,t){var n=t.x-e.p.x,r=t.y-e.p.y,i=e.q.c*n+e.q.s*r,s=-e.q.s*n+e.q.c*r;return new l(i,s)},u.MulTXX=function(e,t){var n=new f;return n.q=u.MulTRR(e.q,t.q),n.p=u.MulTRV(e.q,u.SubtractVV(t.p,e.p)),n},u.AddVV=function(e,t){var n=new l(e.x+t.x,e.y+t.y);return n},u.AddVV3=function(e,t){var n=new c(e.x+t.x,e.y+t.y,e.z+t.z);return n},u.SubtractVV=function(e,t){var n=new l(e.x-t.x,e.y-t.y);return n},u.SubtractVV3=function(e,t){var n=new c(e.x-t.x,e.y-t.y,e.z-t.z);return n},u.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},u.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},u.AddMM=function(e,t){var n=new i(u.AddVV(e.ex,t.ex),u.AddVV(e.ey,t.ey));return n},u.Abs=function(e){return e>0?e:-e},u.AbsV=function(e){var t=new l(u.Abs(e.x),u.Abs(e.y));return t},u.AbsM=function(e){var t=new i(u.AbsV(e.ex),u.AbsV(e.ey));return t},u.Min=function(e,t){return e<t?e:t},u.MinV=function(e,t){var n=new l(u.Min(e.x,t.x),u.Min(e.y,t.y));return n},u.Max=function(e,t){return e>t?e:t},u.MaxV=function(e,t){var n=new l(u.Max(e.x,t.x),u.Max(e.y,t.y));return n},u.Clamp=function(e,t,n){return e<t?t:e>n?n:e},u.ClampV=function(e,t,n){return u.MaxV(t,u.MinV(e,n))},u.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},u.Random=function(){return Math.random()*2-1},u.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e,n},u.NextPowerOfTwo=function(e){return e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},u.IsPowerOfTwo=function(e){var t=e>0&&(e&e-1)==0;return t},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new l(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=new i(new l(1,0),new l(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new f(u.b2Vec2_zero,u.b2Mat22_identity)}),a.b2Sweep=function(){this.localCenter=new l,this.c0=new l,this.c=new l,this.a=0,this.a0=0,this.alpha0=0},a.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.alpha0=e.alpha0},a.prototype.Copy=function(){var e=new a;return e.Set(this),e},a.prototype.GetTransform=function(e,t){e.p.x=(1-t)*this.c0.x+t*this.c.x,e.p.y=(1-t)*this.c0.y+t*this.c.y;var n=(1-t)*this.a0+t*this.a;e.q.Set(n);var r=e.q;e.p.x-=r.c*this.localCenter.x-r.s*this.localCenter.y,e.p.y-=r.s*this.localCenter.x+r.c*this.localCenter.y},a.prototype.Advance=function(e){if(this.alpha0<e&&1-this.alpha0>Number.MIN_VALUE){var t=(e-this.alpha0)/(1-this.alpha0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.alpha0=e}},a.prototype.Normalize=function(e){var t=2*n.b2_pi,r=t*parseInt(this.a0/t);this.a0-=r,this.a-=r},f.b2Transform=function(){this.p=new l,this.q=new o},f.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.p.Set(e.x,e.y),this.q.s=t.s,this.q.c=t.c)},f.prototype.Copy=function(){var e=new f;return e.p.SetV(this.p),e.q.s=this.q.s,e.q.c=this.q.c,e},f.prototype.SetIdentity=function(){this.p.SetZero(),this.q.SetIdentity()},f.prototype.Set=function(e,t){this.p.Set(e.x,e.y),this.q.Set(t)},l.b2Vec2=function(){this.x=0,this.y=0},l.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},l.prototype.SetZero=function(){this.x=0,this.y=0},l.prototype.Set=function(e,t){this.x=e,this.y=t},l.prototype.SetV=function(e){this.x=e.x,this.y=e.y},l.prototype.GetNegative=function(){return new l(-this.x,-this.y)},l.prototype.Copy=function(){return new l(this.x,this.y)},l.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},l.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},l.prototype.Multiply=function(e){this.x*=e,this.y*=e},l.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},l.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},l.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},l.prototype.IsValid=function(){return u.IsValid(this.x)&&u.IsValid(this.y)},l.prototype.Skew=function(){return new l(-this.y,this.x)},c.b2Vec3=function(){},c.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},c.prototype.SetZero=function(){this.x=this.y=this.z=0},c.prototype.Set=function(e,t,n){this.x=e,this.y=t,this.z=n},c.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},c.prototype.GetNegative=function(){return new c(-this.x,-this.y,-this.z)},c.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},c.prototype.Copy=function(){return new c(this.x,this.y,this.z)},c.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},c.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},c.prototype.Multiply=function(e){this.x*=e,this.y*=e,this.z*=e}}(),function(){var e=Box2D.Common.Math.b2Mat22,t=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Rot,r=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3,a=Box2D.Common.b2Color,f=Box2D.Common.b2Settings,l=Box2D.Common.b2Timer,c=Box2D.Collision.b2AABB,h=Box2D.Collision.b2Collision,p=Box2D.Collision.b2ContactID,d=Box2D.Collision.b2Distance,v=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,g=Box2D.Collision.b2DistanceProxy,y=Box2D.Collision.b2DynamicTree,b=Box2D.Collision.b2BroadPhase,w=Box2D.Collision.b2TreeNode,E=Box2D.Collision.b2Pair,S=Box2D.Collision.b2Manifold,x=Box2D.Collision.b2ManifoldPoint,T=Box2D.Collision.b2RayCastInput,N=Box2D.Collision.b2RayCastOutput,C=Box2D.Collision.b2SeparationFunction,k=Box2D.Collision.b2Simplex,L=Box2D.Collision.b2SimplexCache,A=Box2D.Collision.b2SimplexVertex,O=Box2D.Collision.b2TOIInput,M=Box2D.Collision.b2TOIOutput,_=Box2D.Collision.b2WorldManifold,D=Box2D.Collision.b2ClipVertex,P=Box2D.Collision.b2ContactFeature,H=Box2D.Collision.IBroadPhase,B=Box2D.Collision.Shapes.b2CircleShape,j=Box2D.Collision.Shapes.b2EdgeShape,F=Box2D.Collision.Shapes.b2ChainShape,I=Box2D.Collision.Shapes.b2MassData,q=Box2D.Collision.Shapes.b2PolygonShape,R=Box2D.Collision.Shapes.b2Shape,U=Box2D.Dynamics.b2Body,z=Box2D.Dynamics.b2BodyDef,W=Box2D.Dynamics.b2ContactFilter,X=Box2D.Dynamics.b2ContactImpulse,V=Box2D.Dynamics.b2ContactListener,$=Box2D.Dynamics.b2ContactManager,J=Box2D.Dynamics.b2Draw,K=Box2D.Dynamics.b2DestructionListener,Q=Box2D.Dynamics.b2Filter,G=Box2D.Dynamics.b2Fixture,Y=Box2D.Dynamics.b2FixtureDef,Z=Box2D.Dynamics.b2FixtureProxy,et=Box2D.Dynamics.b2Island,tt=Box2D.Dynamics.b2Position,nt=Box2D.Dynamics.b2Profile,rt=Box2D.Dynamics.b2SolverData,it=Box2D.Dynamics.b2TimeStep,st=Box2D.Dynamics.b2Velocity,ot=Box2D.Dynamics.b2World,ut=Box2D.Dynamics.b2WorldQueryWrapper,at=Box2D.Dynamics.b2WorldRayCastWrapper,ft=Box2D.Dynamics.Contacts.b2ChainAndCircleContact,lt=Box2D.Dynamics.Contacts.b2ChainAndPolygonContact,ct=Box2D.Dynamics.Contacts.b2CircleContact,ht=Box2D.Dynamics.Contacts.b2Contact,pt=Box2D.Dynamics.Contacts.b2ContactEdge,dt=Box2D.Dynamics.Contacts.b2ContactPositionConstraint,vt=Box2D.Dynamics.Contacts.b2ContactRegister,mt=Box2D.Dynamics.Contacts.b2ContactSolver,gt=Box2D.Dynamics.Contacts.b2ContactSolverDef,yt=Box2D.Dynamics.Contacts.b2ContactVelocityConstraint,bt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,wt=Box2D.Dynamics.Contacts.b2PolygonAndCircleContact,Et=Box2D.Dynamics.Contacts.b2EdgeAndPolygonContact,St=Box2D.Dynamics.Contacts.b2PolygonContact,xt=Box2D.Dynamics.Contacts.b2PositionSolverManifold,Tt=Box2D.Dynamics.Contacts.b2VelocityConstraintPoint,Nt=Box2D.Dynamics.Joints.b2DistanceJoint,Ct=Box2D.Dynamics.Joints.b2DistanceJointDef,kt=Box2D.Dynamics.Joints.b2FrictionJoint,Lt=Box2D.Dynamics.Joints.b2FrictionJointDef,At=Box2D.Dynamics.Joints.b2GearJoint,Ot=Box2D.Dynamics.Joints.b2GearJointDef,Mt=Box2D.Dynamics.Joints.b2Jacobian,_t=Box2D.Dynamics.Joints.b2Joint,Dt=Box2D.Dynamics.Joints.b2JointDef,Pt=Box2D.Dynamics.Joints.b2JointEdge,Ht=Box2D.Dynamics.Joints.b2MouseJoint,Bt=Box2D.Dynamics.Joints.b2MouseJointDef,jt=Box2D.Dynamics.Joints.b2PrismaticJoint,Ft=Box2D.Dynamics.Joints.b2PrismaticJointDef,It=Box2D.Dynamics.Joints.b2PulleyJoint,qt=Box2D.Dynamics.Joints.b2PulleyJointDef,Rt=Box2D.Dynamics.Joints.b2RevoluteJoint,Ut=Box2D.Dynamics.Joints.b2RevoluteJointDef,zt=Box2D.Dynamics.Joints.b2RopeJoint,Wt=Box2D.Dynamics.Joints.b2RopeJointDef,Xt=Box2D.Dynamics.Joints.b2WeldJoint,Vt=Box2D.Dynamics.Joints.b2WeldJointDef,$t=Box2D.Dynamics.Joints.b2WheelJoint,Jt=Box2D.Dynamics.Joints.b2WheelJointDef,Kt=Box2D.Rope.b2Rope,Qt=Box2D.Rope.b2RopeDef;U.b2Body=function(){this.m_xf=new s,this.m_sweep=new i,this.m_linearVelocity=new o,this.m_force=new o},U.prototype.CreateFixture=function(e,t){if(e instanceof R)return this.CreateFixture2(e,t);var n=e;f.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()==1)return null;var r=new G;r.Create(this.m_world.m_blockAllocator,this,n);if(this.m_flags&U.e_activeFlag){var i=this.m_world.m_contactManager.m_broadPhase;r.CreateProxies(i,this.m_xf)}return r.m_next=this.m_fixtureList,this.m_fixtureList=r,++this.m_fixtureCount,r.m_body=this,r.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=ot.e_newFixture,r},U.prototype.CreateFixture2=function(e,t){var n=new Y;return n.shape=e,n.density=t,this.CreateFixture(n)},U.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()==1)return;f.b2Assert(e.m_body==this),f.b2Assert(this.m_fixtureCount>0);var t=this.m_fixtureList,n=null,r=!1;while(t!=null){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next,r=!0;break}n=t,t=t.m_next}var i=this.m_contactList;while(i){var s=i.contact;i=i.next;var o=s.GetFixtureA(),u=s.GetFixtureB();(e==o||e==u)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&U.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxies(a)}e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()},U.prototype.SetTransform=function(e,t){if(this.m_world.IsLocked()==1)return;this.m_xf.Set(e,t),this.m_sweep.c=r.MulXV(this.m_xf,this.m_sweep.localCenter),this.m_sweep.a0=this.m_sweep.a=t,this.m_sweep.c0.SetV(this.m_sweep.c);var n=this.m_world.m_contactManager.m_broadPhase;for(var i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},U.prototype.GetTransform=function(){return this.m_xf},U.prototype.GetPosition=function(){return this.m_xf.p},U.prototype.GetAngle=function(){return this.m_sweep.a},U.prototype.GetWorldCenter=function(){return this.m_sweep.c},U.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},U.prototype.SetLinearVelocity=function(e){if(this.m_type==U.b2_staticBody)return;r.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.SetV(e)},U.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},U.prototype.SetAngularVelocity=function(e){if(this.m_type==U.b2_staticBody)return;e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e},U.prototype.GetAngularVelocity=
// function(){return this.m_angularVelocity},U.prototype.ApplyForce=function(e,t){if(this.m_type!=U.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=r.CrossVV(r.SubtractVV(t,this.m_sweep.c),e)},U.prototype.ApplyForceToCenter=function(e){if(this.m_type!=U.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y},U.prototype.ApplyTorque=function(e){if(this.m_type!=U.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e},U.prototype.ApplyLinearImpulse=function(e,t){if(this.m_type!=U.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},U.prototype.ApplyAngularImpulse=function(e){if(this.m_type!=U.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_angularVelocity+=this.m_invI*e},U.prototype.GetMass=function(){return this.m_mass},U.prototype.GetGravityScale=function(){return this.m_gravityScale},U.prototype.SetGravityScale=function(e){this.m_gravityScale=e},U.prototype.GetInertia=function(){return this.m_I+this.m_mass*r.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},U.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I+this.m_mass*r.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),e.center.SetV(this.m_sweep.localCenter)},U.prototype.SetMassData=function(e){f.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()==1)return;if(this.m_type!=U.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&U.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*r.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(r.MulXV(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.Add(r.CrossFV(this.m_angularVelocity,r.SubtractVV(this.m_sweep.c,t)))},U.prototype.ResetMassData=function(){this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero();if(this.m_type==U.b2_staticBody||this.m_type==U.b2_kinematicBody){this.m_sweep.c0.SetV(this.m_xf.p),this.m_sweep.c.SetV(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}f.b2Assert(this.m_type===U.b2_dynamicBody);var e=new o(0,0);for(var t=this.m_fixtureList;t;t=t.m_next){if(t.m_density==0)continue;var n=new I;t.GetMassData(n),this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&U.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*r.DotVV(e,e),f.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(r.MulXV(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.Add(r.CrossFV(this.m_angularVelocity,r.SubtractVV(this.m_sweep.c,i)))},U.prototype.GetWorldPoint=function(e){return r.MulXV(this.m_xf,e)},U.prototype.GetWorldVector=function(e){return r.MulRV(this.m_xf.q,e)},U.prototype.GetLocalPoint=function(e){return r.MulTXV(this.m_xf,e)},U.prototype.GetLocalVector=function(e){return r.MulTRV(this.m_xf.q,e)},U.prototype.GetLinearVelocityFromWorldPoint=function(e){return r.AddVV(this.m_linearVelocity,r.CrossFV(this.m_angularVelocity,r.SubtractVV(e,this.m_sweep.c)))},U.prototype.GetLinearVelocityFromLocalPoint=function(e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(e))},U.prototype.GetLinearDamping=function(){return this.m_linearDamping},U.prototype.SetLinearDamping=function(e){this.m_linearDamping=e},U.prototype.GetAngularDamping=function(){return this.m_angularDamping},U.prototype.SetAngularDamping=function(e){this.m_angularDamping=e},U.prototype.SetType=function(e){f.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()==1)return;if(this.m_type==e)return;this.m_type=e,this.ResetMassData(),this.m_type==U.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0=this.m_sweep.c.Copy(),SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var t=this.m_fixtureList;t;t=t.m_next)t.Refilter()},U.prototype.GetType=function(){return this.m_type},U.prototype.SetBullet=function(e){e?this.m_flags|=U.e_bulletFlag:this.m_flags&=~U.e_bulletFlag},U.prototype.IsBullet=function(){return(this.m_flags&U.e_bulletFlag)==U.e_bulletFlag},U.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=U.e_autoSleepFlag:(this.m_flags&=~U.e_autoSleepFlag,this.SetAwake(!0))},U.prototype.SetAwake=function(e){e?(this.m_flags&U.e_awakeFlag)==0&&(this.m_flags|=U.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~U.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},U.prototype.IsAwake=function(){return(this.m_flags&U.e_awakeFlag)==U.e_awakeFlag},U.prototype.SetFixedRotation=function(e){e?this.m_flags|=U.e_fixedRotationFlag:this.m_flags&=~U.e_fixedRotationFlag,this.ResetMassData()},U.prototype.IsFixedRotation=function(){return(this.m_flags&U.e_fixedRotationFlag)==U.e_fixedRotationFlag},U.prototype.SetActive=function(e){if(e==this.IsActive())return;if(e){this.m_flags|=U.e_activeFlag;var t=this.m_world.m_contactManager.m_broadPhase;for(var n=this.m_fixtureList;n;n=n.m_next)n.CreateProxies(t,this.m_xf)}else{this.m_flags&=~U.e_activeFlag;var t=this.m_world.m_contactManager.m_broadPhase;for(var n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxies(t);var r=this.m_contactList;while(r){var i=r;r=r.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null}},U.prototype.IsActive=function(){return(this.m_flags&U.e_activeFlag)==U.e_activeFlag},U.prototype.IsSleepingAllowed=function(){return(this.m_flags&U.e_autoSleepFlag)==U.e_autoSleepFlag},U.prototype.GetFixtureList=function(){return this.m_fixtureList},U.prototype.GetJointList=function(){return this.m_jointList},U.prototype.GetContactList=function(){return this.m_contactList},U.prototype.GetNext=function(){return this.m_next},U.prototype.GetUserData=function(){return this.m_userData},U.prototype.SetUserData=function(e){this.m_userData=e},U.prototype.GetWorld=function(){return this.m_world},U.prototype.b2Body=function(e,t){f.b2Assert(e.position.IsValid()),f.b2Assert(e.linearVelocity.IsValid()),f.b2Assert(r.IsValid(e.angle)),f.b2Assert(r.IsValid(e.angularVelocity)),f.b2Assert(r.IsValid(e.angularDamping)&&e.angularDamping>=0),f.b2Assert(r.IsValid(e.linearDamping)&&e.linearDamping>=0),this.m_flags=0,e.bullet&&(this.m_flags|=U.e_bulletFlag),e.fixedRotation&&(this.m_flags|=U.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=U.e_autoSleepFlag),e.awake&&(this.m_flags|=U.e_awakeFlag),e.active&&(this.m_flags|=U.e_activeFlag),this.m_world=t,this.m_xf.Set(e.position,e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.SetV(this.m_xf.p),this.m_sweep.c.SetV(this.m_xf.p),this.m_sweep.a0=e.angle,this.m_sweep.a=e.angle,this.m_sweep.alpha0=0,this.m_jointList=null,this.m_contactList=null,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,this.m_type==U.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},U.prototype.SynchronizeFixtures=function(){var e=U.s_xf1,t=e.q;t.Set(this.m_sweep.a0);var n=this.m_sweep.localCenter;e.p.x=this.m_sweep.c0.x-(t.c*n.x-t.s*n.y),e.p.y=this.m_sweep.c0.y-(t.s*n.x+t.c*n.y);var r=this.m_world.m_contactManager.m_broadPhase;for(var i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(r,e,this.m_xf)},U.prototype.SynchronizeTransform=function(){this.m_xf.q.Set(this.m_sweep.a),this.m_xf.p=r.SubtractVV(this.m_sweep.c,r.MulRV(this.m_xf.q,this.m_sweep.localCenter))},U.prototype.ShouldCollide=function(e){if(this.m_type!=U.b2_dynamicBody&&e.m_type!=U.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},U.prototype.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new s,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_autoSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.e_toiFlag=64,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),z.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},z.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=U.b2_staticBody,this.active=!0,this.gravityScale=1},W.b2ContactFilter=function(){},W.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();if(n.groupIndex==r.groupIndex&&n.groupIndex!=0)return n.groupIndex>0;var i=(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0;return i},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new W}),X.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(f.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(f.b2_maxManifoldPoints),this.count=0},V.b2ContactListener=function(){},V.prototype.BeginContact=function(e){},V.prototype.EndContact=function(e){},V.prototype.PreSolve=function(e,t){},V.prototype.PostSolve=function(e,t){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new V}),$.b2ContactManager=function(){this.m_broadPhase=new b},$.prototype.b2ContactManager=function(){this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=W.b2_defaultFilter,this.m_contactListener=V.b2_defaultListener,this.m_allocator=null},$.prototype.AddPair=function(e,t){var n=e instanceof Z?e:null,r=t instanceof Z?t:null,i=n.fixture,s=r.fixture,o=n.childIndex,u=r.childIndex,a=i.GetBody(),f=s.GetBody();if(a==f)return;var l=f.GetContactList();while(l){if(l.other==a){var c=l.contact.GetFixtureA(),h=l.contact.GetFixtureB(),p=l.contact.GetChildIndexA(),d=l.contact.GetChildIndexB();if(c==i&&h==s&&p==o&&d==u)return;if(c==s&&h==i&&p==u&&d==o)return}l=l.next}if(f.ShouldCollide(a)==0)return;if(this.m_contactFilter&&this.m_contactFilter.ShouldCollide(i,s)==0)return;var v=ht.Create(i,o,s,u,this.m_allocator);if(v==null)return;i=v.GetFixtureA(),s=v.GetFixtureB(),o=v.GetChildIndexA(),u=v.GetChildIndexB(),a=i.m_body,f=s.m_body,v.m_prev=null,v.m_next=this.m_contactList,this.m_contactList!=null&&(this.m_contactList.m_prev=v),this.m_contactList=v,v.m_nodeA.contact=v,v.m_nodeA.other=f,v.m_nodeA.prev=null,v.m_nodeA.next=a.m_contactList,a.m_contactList!=null&&(a.m_contactList.prev=v.m_nodeA),a.m_contactList=v.m_nodeA,v.m_nodeB.contact=v,v.m_nodeB.other=a,v.m_nodeB.prev=null,v.m_nodeB.next=f.m_contactList,f.m_contactList!=null&&(f.m_contactList.prev=v.m_nodeB),f.m_contactList=v.m_nodeB,a.SetAwake(!0),f.SetAwake(!0),++this.m_contactCount;return},$.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)},$.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();this.m_contactListener&&e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_contactList&&(this.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==r.m_contactList&&(r.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==i.m_contactList&&(i.m_contactList=e.m_nodeB.next),ht.Destroy(e,this.m_allocator),--this.m_contactCount},$.prototype.Collide=function(){var e=this.m_contactList;while(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=e.GetChildIndexA(),i=e.GetChildIndexB(),s=t.GetBody(),o=n.GetBody();if(e.m_flags&ht.e_filterFlag){if(o.ShouldCollide(s)==0){var u=e;e=u.GetNext(),this.Destroy(u);continue}if(this.m_contactFilter&&this.m_contactFilter.ShouldCollide(t,n)==0){u=e,e=u.GetNext(),this.Destroy(u);continue}e.m_flags&=~ht.e_filterFlag}var a=s.IsAwake()&&s.m_type!=U.b2_staticBody,f=o.IsAwake()&&o.m_type!=U.b2_staticBody;if(a==0&&f==0){e=e.GetNext();continue}var l=t.m_proxies[r].proxyId,c=n.m_proxies[i].proxyId,h=this.m_broadPhase.TestOverlap(l,c);if(h==0){u=e,e=u.GetNext(),this.Destroy(u);continue}e.Update(this.m_contactListener),e=e.GetNext()}},J.b2Draw=function(){},J.prototype.b2Draw=function(){},J.prototype.SetFlags=function(e){e===undefined&&(e=0)},J.prototype.GetFlags=function(){},J.prototype.AppendFlags=function(e){e===undefined&&(e=0)},J.prototype.ClearFlags=function(e){e===undefined&&(e=0)},J.prototype.SetSprite=function(e){},J.prototype.GetSprite=function(){},J.prototype.SetDrawScale=function(e){e===undefined&&(e=0)},J.prototype.GetDrawScale=function(){},J.prototype.SetLineThickness=function(e){e===undefined&&(e=0)},J.prototype.GetLineThickness=function(){},J.prototype.SetAlpha=function(e){e===undefined&&(e=0)},J.prototype.GetAlpha=function(){},J.prototype.SetFillAlpha=function(e){e===undefined&&(e=0)},J.prototype.GetFillAlpha=function(){},J.prototype.SetXFormScale=function(e){e===undefined&&(e=0)},J.prototype.GetXFormScale=function(){},J.prototype.DrawPolygon=function(e,t,n){t===undefined&&(t=0)},J.prototype.DrawSolidPolygon=function(e,t,n){t===undefined&&(t=0)},J.prototype.DrawCircle=function(e,t,n){t===undefined&&(t=0)},J.prototype.DrawSolidCircle=function(e,t,n,r){t===undefined&&(t=0)},J.prototype.DrawSegment=function(e,t,n){},J.prototype.DrawTransform=function(e){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Draw.e_shapeBit=1,Box2D.Dynamics.b2Draw.e_jointBit=2,Box2D.Dynamics.b2Draw.e_aabbBit=4,Box2D.Dynamics.b2Draw.e_pairBit=8,Box2D.Dynamics.b2Draw.e_centerOfMassBit=16,Box2D.Dynamics.b2Draw.e_controllerBit=32}),K.b2DestructionListener=function(){},K.prototype.SayGoodbyeJoint=function(e){},K.prototype.SayGoodbyeFixture=function(e){},Q.b2Filter=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Q.prototype.Copy=function(){var e=new Q;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},G.b2Fixture=function(){this.m_filter=new Q},G.prototype.GetType=function(){return this.m_shape.GetType()},G.prototype.GetShape=function(){return this.m_shape},G.prototype.SetSensor=function(e){if(this.m_isSensor==e)return;this.m_body.SetAwake(!0),this.m_isSensor=e},G.prototype.IsSensor=function(){return this.m_isSensor},G.prototype.SetFilterData=function(e){this.m_filter=e.Copy(),this.Refilter()},G.prototype.Refilter=function(){if(!this.m_body)return;var e=this.m_body.GetContactList();while(e){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}var i=this.m_body.GetWorld();if(!i)return;var s=i.m_contactManager.m_broadPhase;for(var o=0;o<this.m_proxyCount;++o)s.TouchProxy(this.m_proxies[o].proxyId)},G.prototype.GetFilterData=function(){return this.m_filter},G.prototype.GetBody=function(){return this.m_body},G.prototype.GetNext=function(){return this.m_next},G.prototype.GetUserData=function(){return this.m_userData},G.prototype.SetUserData=function(e){this.m_userData=e},G.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},G.prototype.RayCast=function(e,t,n){return this.m_shape.RayCast(e,t,this.m_body.GetTransform(),n)},G.prototype.GetMassData=function(e){this.m_shape.ComputeMass(e,this.m_density)},G.prototype.SetDensity=function(e){f.b2Assert(r.IsValid(e)&&e>=0),this.m_density=e},G.prototype.GetDensity=function(){return this.m_density},G.prototype.GetFriction=function(){return this.m_friction},G.prototype.SetFriction=function(e){this.m_friction=e},G.prototype.GetRestitution=function(){return this.m_restitution},G.prototype.SetRestitution=function(e){this.m_restitution=e},G.prototype.GetAABB=function(e){return f.b2Assert(0<=e&&e<this.m_proxyCount),this.m_proxies[e].aabb},G.prototype.b2Fixture=function(){this.m_proxies=null,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},G.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=t,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy();var r=this.m_shape.GetChildCount();this.m_proxies=new Vector(r);for(var i=0;i<r;++i)this.m_proxies[i]=new Z,this.m_proxies[i].fixture=null,this.m_proxies[i].proxyId=null;this.m_proxyCount=0,this.m_density=n.density},G.prototype.Destroy=function(){f.b2Assert(this.m_proxyCount==0),this.m_shape=null},G.prototype.CreateProxies=function(e,t){f.b2Assert(this.m_proxyCount==0),this.m_proxyCount=this.m_shape.GetChildCount();for(var n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n];this.m_shape.ComputeAABB(r.aabb,t,n),r.proxyId=e.CreateProxy(r.aabb,r),r.fixture=this,r.childIndex=n}},G.prototype.DestroyProxies=function(e){for(var t=0;t<this.m_proxyCount;++t)e.DestroyProxy(this.m_proxies[t].proxyId),this.m_proxies[t].proxyId=null;this.m_proxyCount=0},G.prototype.Synchronize=function(e,t,n){for(var i=0;i<this.m_proxyCount;++i){var s=this.m_proxies[i],o=G.s_aabb1,u=G.s_aabb2;this.m_shape.ComputeAABB(o,t,s.childIndex),this.m_shape.ComputeAABB(u,n,s.childIndex),s.aabb.Combine2(o,u);var a=r.SubtractVV(n.p,t.p);e.MoveProxy(s.proxyId,s.aabb,a)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Fixture.s_aabb1=new c,Box2D.Dynamics.b2Fixture.s_aabb2=new c}),Y.b2FixtureDef=function(){this.filter=new Q},Y.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1},Z.b2FixtureProxy=function(){this.aabb=new c},Z.prototype.b2FixtureProxy=function(){this.fixture=null,this.childIndex=0,this.proxyId=null},et.b2Island=function(){},et.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector,this.m_velocities=new Vector,this.m_positions=new Vector},et.prototype.Initialize=function(e,t,n,r,i,s){var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null;for(o=this.m_velocities.length;o<e;o++)this.m_velocities[o]=new st;for(o=this.m_positions.length;o<e;o++)this.m_positions[o]=new tt},et.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},et.prototype.Solve=function(e,t,n,i){var s=t.dt,u=0,a=0,l,c,h=new o,p=new o;for(u=0;u<this.m_bodyCount;++u){l=this.m_bodies[u],h.SetV(l.m_sweep.c);var d=l.m_sweep.a;p.SetV(l.m_linearVelocity);var v=l.m_angularVelocity;l.m_sweep.c0.SetV(l.m_sweep.c),l.m_sweep.a0=l.m_sweep.a,l.m_type==U.b2_dynamicBody&&(p.x+=s*(l.m_gravityScale*n.x+l.m_invMass*l.m_force.x),p.y+=s*(l.m_gravityScale*n.y+l.m_invMass*l.m_force.y),v+=s*l.m_invI*l.m_torque,p.Multiply(r.Clamp(1-s*l.m_linearDamping,0,1)),v*=r.Clamp(1-s*l.m_angularDamping,0,1)),this.m_positions[u].c.SetV(h),this.m_positions[u].a=d,this.m_velocities[u].v.SetV(p),this.m_velocities[u].w=v}var m=new rt;m.step=t,m.positions=this.m_positions,m.velocities=this.m_velocities;var g=et.s_b2ContactSolverDef;g.step=t,g.contacts=this.m_contacts,g.count=this.m_contactCount,g.positions=this.m_positions,g.velocities=this.m_velocities,g.allocator=this.m_allocator,this.m_contactSolver.Initialize(g);var y=this.m_contactSolver;y.InitializeVelocityConstraints(),t.warmStarting&&y.WarmStart();for(u=0;u<this.m_jointCount;++u)this.m_joints[u].InitVelocityConstraints(m);for(u=0;u<t.velocityIterations;++u){for(a=0;a<this.m_jointCount;++a)this.m_joints[a].SolveVelocityConstraints(m);y.SolveVelocityConstraints()}y.StoreImpulses();for(u=0;u<this.m_bodyCount;++u){h=this.m_positions[u].c;var d=this.m_positions[u].a;p=this.m_velocities[u].v;var v=this.m_velocities[u].w,b=s*p.x,w=s*p.y,E=b*b+w*w;if(E>f.b2_maxTranslationSquared){var S=f.b2_maxTranslation/Math.sqrt(E);p.Multiply(S)}var x=s*v;if(x*x>f.b2_maxRotationSquared){var S=f.b2_maxRotation/r.Abs(x);v*=S}b=s*p.x,w=s*p.y,h.x+=b,h.y+=w,d+=s*v,this.m_positions[u].a=d,this.m_velocities[u].w=v}var T=!1;for(u=0;u<t.positionIterations;++u){var N=y.SolvePositionConstraints(),C=!0;for(a=0;a<this.m_jointCount;++a){var k=this.m_joints[a].SolvePositionConstraints(m);C=C&&k}if(N&&C){T=!0;break}}for(u=0;u<this.m_bodyCount;++u)l=this.m_bodies[u],l.m_sweep.c.SetV(this.m_positions[u].c),l.m_sweep.a=this.m_positions[u].a,l.m_linearVelocity.SetV(this.m_velocities[u].v),l.m_angularVelocity=this.m_velocities[u].w,l.SynchronizeTransform();this.Report(y.m_velocityConstraints);if(i){var L=f.b2_maxFloat,A=f.b2_linearSleepTolerance*f.b2_linearSleepTolerance,O=f.b2_angularSleepTolerance*f.b2_angularSleepTolerance;for(u=0;u<this.m_bodyCount;++u){l=this.m_bodies[u];if(l.GetType()==f.b2_staticBody)continue;(l.m_flags&U.e_autoSleepFlag)==0||l.m_angularVelocity*l.m_angularVelocity>O||r.DotVV(l.m_linearVelocity,l.m_linearVelocity)>A?(l.m_sleepTime=0,L=0):(l.m_sleepTime+=s,L=r.Min(L,l.m_sleepTime))}if(L>=f.b2_timeToSleep&&T)for(var u=0;u<this.m_bodyCount;++u)l=this.m_bodies[u],l.SetAwake(!1)}},et.prototype.SolveTOI=function(e,t,n){f.b2Assert(t<this.m_bodyCount),f.b2Assert(n<this.m_bodyCount);for(var i=0;i<this.m_bodyCount;++i){var s=this.m_bodies[i];this.m_positions[i].c=s.m_sweep.c.Copy(),this.m_positions[i].a=s.m_sweep.a,this.m_velocities[i].v=s.m_linearVelocity.Copy(),this.m_velocities[i].w=s.m_angularVelocity}var o=new gt;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.allocator=this.m_allocator,o.step=e,o.positions=this.m_positions,o.velocities=this.m_velocites;var u=this.m_b2ContactSolver;u.Initialize(o);for(var i=0;i<e.positionIterations;++i){var a=u.SolveTOIPositionConstraints(t,n);if(a)break}this.m_bodies[t].m_sweep.c0=this.m_positions[t].c.Copy(),this.m_bodies[t].m_sweep.a0=this.m_positions[t].a,this.m_bodies[n].m_sweep.c0=this.m_positions[n].c.Copy(),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,u.InitializeVelocityConstraints();for(var i=0;i<e.velocityIterations;++i)u.SolveVelocityConstraints();var l=e.dt;for(var i=0;i<this.m_bodyCount;++i){var c=this.m_positions[i].c,h=this.m_positions[i].a,p=this.m_velocities[i].v,d=this.m_velocities[i].w,v=r.MulFV(l,p);if(r.DotVV(v,v)>f.b2_maxTranslationSquared){var m=f.b2_maxTranslation/v.Length();p.Multiply(m)}var g=l*d;if(g*g>f.b2_maxRotationSquared){var m=f.b2_maxRotation/r.Abs(g);d*=m}c.Add(r.MulFV(l,p)),h+=l*d,this.m_positions[i].c=c.Copy(),this.m_positions[i].a=h,this.m_velocities[i].v=p.Copy(),this.m_velocities[i].w=d;var y=this.m_bodies[i];y.m_sweep.c=c.Copy(),y.m_sweep.a=h,y.m_linearVelocity=p.Copy(),y.m_angularVelocity=d,y.SynchronizeTransform()}Report(u.m_velocityConstraints)},et.prototype.Report=function(e){if(this.m_listener==null)return;for(var t=0;t<this.m_contactCount;++t){var n=this.m_contacts[t],r=e[t];et.s_impulse.count=r.pointCount;for(var i=0;i<r.pointCount;++i)et.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,et.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,et.s_impulse)}},et.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},et.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},et.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new X,Box2D.Dynamics.b2Island.s_b2ContactSolverDef=new gt}),tt.b2Position=function(){this.c=new o,this.a=0},nt.b2Profile=function(){},nt.prototype.Reset=function(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0},rt.b2SolverData=function(){this.step=null,this.positions=null,this.velocities=null},it.b2TimeStep=function(){},it.prototype.Copy=function(){var e=new it;return e.Set(this),e},it.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.dtRatio=e.dtRatio,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},st.b2Velocity=function(){this.v=new o,this.w=0},ot.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new $,this.m_contactSolver=new mt,this.m_island=new et,this.m_gravity=new o},ot.prototype.b2World=function(e){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_allowSleep=!0,this.m_gravity.SetV(e),this.m_flags=ot.e_clearForces,this.m_inv_dt0=0,this.m_contactManager.m_allocator=this.m_blockAllocator},ot.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},ot.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},ot.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},ot.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},ot.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},ot.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},ot.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},ot.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},ot.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},ot.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;var t=new U(e,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},ot.prototype.DestroyBody=function(e){f.b2Assert(this.m_bodyCount>0);if(this.IsLocked()==1)return;var t=e.m_jointList;while(t){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint),e.m_jointList=t}e.m_jointList=null;var r=e.m_contactList;while(r){var i=r;r=r.next,this.m_contactManager.Destroy(i.contact)}e.m_contactList=null;var s=e.m_fixtureList;while(s){var o=s;s=s.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(o),o.DestroyProxies(this.m_contactManager.m_broadPhase),o.Destroy(this.m_blockAllocator),o=null,e.m_fixtureList=s,e.m_fixtureCount-=1}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount,e=null},ot.prototype.CreateJoint=function(e){if(this.IsLocked())return null;var t=_t.Create(e,null);t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}return t},ot.prototype.DestroyJoint=function(e){if(this.IsLocked())return;var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,_t.Destroy(e,null),--this.m_jointCount;if(t==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}},ot.prototype.SetWarmStarting=function(e){this.m_warmStarting=e},ot.prototype.GetWarmStarting=function(){return this.m_warmStarting},ot.prototype.SetContinuousPhysics=function(e){this.m_continuousPhysics=e},ot.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},ot.prototype.SetAutoClearForces=function(e){e?this.m_flags|=ot.e_clearForces:this.m_flags&=~ot.e_clearForces},ot.prototype.GetAutoClearForces=function(){return(this.m_flags&ot.e_clearForces)===ot.e_clearForces},ot.prototype.SetAllowSleeping=function(e){if(e==this.m_allowSleep)return;this.m_allowSleep=e;if(this.m_allowSleep==0)for(var t=this.m_bodyList;t;t=t.next)t.SetAwake(!0)},ot.prototype.GetBodyCount=function(){return this.m_bodyCount},ot.prototype.GetJointCount=function(){return this.m_jointCount},ot.prototype.GetContactManager=function(){return this.m_contactManager},ot.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},ot.prototype.SetGravity=function(e){this.m_gravity=e},ot.prototype.GetGravity=function(){return this.m_gravity},ot.prototype.GetGroundBody=function(){return this.m_groundBody},ot.prototype.Step=function(e,t,n){this.m_flags&ot.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~ot.e_newFixture),this.m_flags|=ot.e_locked;var r=ot.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,e>0?r.inv_dt=1/e:r.inv_dt=0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=this.m_warmStarting,this.m_contactManager.Collide(),this.m_stepComplete&&r.dt>0&&this.Solve(r),this.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&ot.e_clearForces&&this.ClearForces(),this.m_flags&=~ot.e_locked},ot.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},ot.prototype.DrawDebugData=function(){if(this.m_debugDraw==null)return;this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t=0,n,r,i,s,u,f=new o,l=new o,h=new o,p,d=new c,v=new c,m=[new o,new o,new o,new o],g=new a(0,0,0);if(e&J.e_shapeBit)for(n=this.m_bodyList;n;n=n.m_next){p=n.m_xf;for(r=n.GetFixtureList();r;r=r.m_next)i=r.GetShape(),n.IsActive()==0?(g.Set(.5,.5,.3),this.DrawShape(i,p,g)):n.GetType()==U.b2_staticBody?(g.Set(.5,.9,.5),this.DrawShape(i,p,g)):n.GetType()==U.b2_kinematicBody?(g.Set(.5,.5,.9),this.DrawShape(i,p,g)):n.IsAwake()==0?(g.Set(.6,.6,.6),this.DrawShape(i,p,g)):(g.Set(.9,.7,.7),this.DrawShape(i,p,g))}if(e&J.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(e&J.e_controllerBit)for(var y=this.m_controllerList;y;y=y.m_next)y.Draw(this.m_debugDraw);if(e&J.e_pairBit){g.Set(.3,.9,.9);for(var b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var w=b.GetFixtureA(),E=b.GetFixtureB(),S=w.GetAABB().GetCenter(),x=E.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(S,x,g)}}if(e&J.e_aabbBit){u=this.m_contactManager.m_broadPhase,m=[new o,new o,new o,new o];for(n=this.m_bodyList;n;n=n.GetNext()){if(n.IsActive()==0)continue;for(r=n.GetFixtureList();r;r=r.GetNext()){var T=u.GetFatAABB(r.m_proxy);m[0].Set(T.lowerBound.x,T.lowerBound.y),m[1].Set(T.upperBound.x,T.lowerBound.y),m[2].Set(T.upperBound.x,T.upperBound.y),m[3].Set(T.lowerBound.x,T.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,g)}}}if(e&J.e_centerOfMassBit)for(n=this.m_bodyList;n;n=n.m_next)p=ot.s_xf,p.q=n.m_xf.q,p.p=n.GetWorldCenter(),this.m_debugDraw.DrawTransform(p)},ut.b2WorldQueryWrapper=function(){},ut.prototype.QueryCallback=function(e){var t=this.broadPhase.GetUserData(e);return this.callback.ReportFixture(t.fixture
// )},ot.prototype.QueryAABB=function(e,t){var n=this,r=new ut;r.broadPhase=n.m_contactManager.m_broadPhase,r.callback=e,this.m_contactManager.m_broadPhase.Query(r,t)},ot.prototype.QueryShape=function(e,t,n){function o(r){var s=i.GetUserData(r)instanceof G?i.GetUserData(r):null;return R.TestOverlap(t,n,s.GetShape(),s.GetBody().GetTransform())?e(s):!0}var r=this;n===undefined&&(n=null),n==null&&(n=new s,n.SetIdentity());var i=r.m_contactManager.m_broadPhase,u=new c;t.ComputeAABB(u,n),i.Query(o,u)},ot.prototype.QueryPoint=function(e,t){function i(n){var i=r.GetUserData(n)instanceof G?r.GetUserData(n):null;return i.TestPoint(t)?e(i):!0}var n=this,r=n.m_contactManager.m_broadPhase,s=new c;s.lowerBound.Set(t.x-f.b2_linearSlop,t.y-f.b2_linearSlop),s.upperBound.Set(t.x+f.b2_linearSlop,t.y+f.b2_linearSlop),r.Query(i,s)},at.b2WorldRayCastWrapper=function(){},at.prototype.RayCastCallback=function(e,t){var n=broadPhase.GetUserData(t),i=n.fixture,s=n.childIndex,o=new N,u=i.RayCast(o,e,s);if(u){var a=o.fraction,f=r.AddVV(r.MulFV(1-a,e.p1),r.MulFV(a,e.p2));return callback.ReportFixture(i,f,o.normal,a)}return e.maxFraction},ot.prototype.RayCast=function(e,t,n){var r=new at;r.broadPhase=this.m_contactManager.m_broadPhase,r.callback=e;var i=new T;i.maxFraction=1,i.p1.SetV(t),i.p2.SetV(n),this.m_contactManager.m_broadPhase.RayCast(r,i)},ot.prototype.GetBodyList=function(){return this.m_bodyList},ot.prototype.GetJointList=function(){return this.m_jointList},ot.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},ot.prototype.IsLocked=function(){return(this.m_flags&ot.e_locked)==ot.e_locked},ot.prototype.Solve=function(e){var t,n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~U.e_islandFlag;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_flags&=~ht.e_islandFlag;for(var i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;var s=parseInt(this.m_bodyCount),o=this.s_stack;for(var u=0;u<s;++u)o[u]=null;for(var a=this.m_bodyList;a;a=a.m_next){if(a.m_flags&U.e_islandFlag)continue;if(a.IsAwake()==0||a.IsActive()==0)continue;if(a.GetType()==U.b2_staticBody)continue;n.Clear();var f=0;o[f++]=a,a.m_flags|=U.e_islandFlag;while(f>0){t=o[--f],n.AddBody(t),t.SetAwake(!0);if(t.GetType()==U.b2_staticBody)continue;var l;for(var c=t.m_contactList;c;c=c.next){if(c.contact.m_flags&ht.e_islandFlag)continue;if(c.contact.IsEnabled()==0||c.contact.IsTouching()==0)continue;var h=c.contact.m_fixtureA.IsSensor(),p=c.contact.m_fixtureB.IsSensor();if(h||p)continue;n.AddContact(c.contact),c.contact.m_flags|=ht.e_islandFlag,l=c.other;if(l.m_flags&U.e_islandFlag)continue;o[f++]=l,l.m_flags|=U.e_islandFlag}for(var d=t.m_jointList;d;d=d.next){if(d.joint.m_islandFlag==1)continue;l=d.other;if(l.IsActive()==0)continue;n.AddJoint(d.joint),d.joint.m_islandFlag=!0;if(l.m_flags&U.e_islandFlag)continue;o[f++]=l,l.m_flags|=U.e_islandFlag}}var v;n.Solve(v,e,this.m_gravity,this.m_allowSleep);for(var u=0;u<n.m_bodyCount;++u)t=n.m_bodies[u],t.GetType()==U.b2_staticBody&&(t.m_flags&=~U.e_islandFlag)}for(var u=0;u<o.length;++u){if(!o[u])break;o[u]=null}for(t=this.m_bodyList;t;t=t.m_next){if((t.m_flags&U.e_islandFlag)==0)continue;if(t.GetType()==U.b2_staticBody)continue;t.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()},ot.prototype.SolveTOI=function(e){var t=this.m_island;t.Initialize(2*f.b2_maxTOIContacts,f.b2_maxTOIContacts,0,this.m_stackAllocator,this.m_contactManager.m_contactListener,this.m_contactSolver);var n;if(this.m_stepComplete){for(n=this.m_bodyList;n;n=n.m_next)n.m_flags&=~U.e_islandFlag,n.m_sweep.alpha0=0;for(var i=this.m_contactManager.m_contactList;i;i=i.m_next)i.m_flags&=~(ht.e_toiFlag|ht.e_islandFlag),i.m_toiCount=0,i.m_toi=1}for(;;){var s=null,o=1;for(var i=this.m_contactManager.m_contactList;i;i=i.m_next){if(i.IsEnabled()==0)continue;if(i.m_toiCount>f.b2_maxSubSteps)continue;var u=1;if(i.m_flags&ht.e_toiFlag)u=i.m_toi;else{var a=i.GetFixtureA(),l=i.GetFixtureB();if(a.IsSensor()||l.IsSensor())continue;var c=a.GetBody(),p=l.GetBody(),d=c.m_type,v=p.m_type,m=c.IsAwake()&&d!=U.b2_staticBody,g=p.IsAwake()&&v!=U.b2_staticBody;if(m==0&&g==0)continue;var y=c.IsBullet()||d!=U.b2_dynamicBody,b=p.IsBullet()||v!=U.b2_dynamicBody;if(y==0&&b==0)continue;var w=c.m_sweep.alpha0;c.m_sweep.alpha0<p.m_sweep.alpha0?(w=p.m_sweep.alpha0,c.m_sweep.Advance(w)):p.m_sweep.alpha0<c.m_sweep.alpha0&&(w=c.m_sweep.alpha0,p.m_sweep.Advance(w));var E=i.GetChildIndexA(),S=i.GetChildIndexB(),x=new O;x.proxyA.Set(a.GetShape(),E),x.proxyB.Set(l.GetShape(),S),x.sweepA=c.m_sweep,x.sweepB=p.m_sweep,x.tMax=1;var T=new M;h.b2TimeOfImpact(T,x);var N=T.t;T.state==M.e_touching?u=r.Min(w+(1-w)*N,1):u=1,i.m_toi=u,i.m_flags|=ht.e_toiFlag}u<o&&(s=i,o=u)}if(s==null||1-10*f.b2_epsilon<o){this.m_stepComplete=!0;break}var a=s.GetFixtureA(),l=s.GetFixtureB(),c=a.GetBody(),p=l.GetBody();ot.s_backupA.Set(c.m_sweep),ot.s_backupB.Set(p.m_sweep),c.Advance(o),p.Advance(o),s.Update(this.m_contactManager.m_contactListener),s.m_flags&=~ht.e_toiFlag,++s.m_toiCount;if(s.IsEnabled()==0||s.IsTouching()==0){s.SetEnabled(!1),c.m_sweep.Set(ot.s_backupA),p.m_sweep.Set(ot.s_backupB),c.SynchronizeTransform(),p.SynchronizeTransform();continue}c.SetAwake(!0),p.SetAwake(!0),t.Clear(),t.AddBody(c),t.AddBody(p),t.AddContact(s),c.m_flags|=U.e_islandFlag,p.m_flags|=U.e_islandFlag,s.m_flags|=ht.e_islandFlag;var C=new Array(c,p);for(var k=0;k<2;++k){n=C[k];if(n.m_type==U.b2_dynamicBody)for(var L=n.m_contactList;L;L=L.next){if(t.m_bodyCount==t.m_bodyCapacity)break;if(t.m_contactCount==t.m_contactCapacity)break;var A=L.contact;if(A.m_flags&ht.e_islandFlag)continue;var _=L.other;if(_.m_type==U.b2_dynamicBody&&n.IsBullet()==0&&_.IsBullet()==0)continue;var D=A.m_fixtureA.m_isSensor,P=A.m_fixtureB.m_isSensor;if(D||P)continue;var H=_.m_sweep.Copy();(_.m_flags&U.e_islandFlag)==0&&_.Advance(o),A.Update(this.m_contactManager.m_contactListener);if(A.IsEnabled()==0){_.m_sweep=H.Copy(),_.SynchronizeTransform();continue}if(A.IsTouching()==0){_.m_sweep=H.Copy(),_.SynchronizeTransform();continue}A.m_flags|=ht.e_islandFlag,t.AddContact(A);if(_.m_flags&U.e_islandFlag)continue;_.m_flags|=U.e_islandFlag,_.m_type!=U.b2_staticBody&&_.SetAwake(!0),t.AddBody(_)}}var B=ot.s_timestep;B.dt=(1-o)*e.dt,B.inv_dt=1/B.dt,B.dtRatio=1,B.positionIterations=20,B.velocityIterations=e.velocityIterations,B.warmStarting=!1,t.SolveTOI(B,c.m_islandIndex,p.m_islandIndex);for(var k=0;k<t.m_bodyCount;++k){n=t.m_bodies[k],n.m_flags&=~U.e_islandFlag;if(n.m_type!=U.b2_dynamicBody)continue;n.SynchronizeFixtures();for(var L=n.m_contactList;L;L=L.next)L.contact.m_flags&=~(ht.e_toiFlag|ht.e_islandFlag)}this.m_contactManager.FindNewContacts();if(this.m_subStepping){this.m_stepComplete=!1;break}}},ot.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf,i=n.m_xf,s=r.p,o=i.p,u=e.GetAnchorA(),a=e.GetAnchorB(),f=ot.s_jointColor;switch(e.m_type){case _t.e_distanceJoint:this.m_debugDraw.DrawSegment(u,a,f);break;case _t.e_pulleyJoint:var l=e instanceof It?e:null,c=l.GetGroundAnchorA(),h=l.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,u,f),this.m_debugDraw.DrawSegment(h,a,f),this.m_debugDraw.DrawSegment(c,h,f);break;case _t.e_mouseJoint:this.m_debugDraw.DrawSegment(u,a,f);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,u,f),this.m_debugDraw.DrawSegment(u,a,f),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,a,f)}},ot.prototype.DrawShape=function(e,t,n){switch(e.m_type){case R.e_circle:var i=e instanceof B?e:null,s=r.MulXV(t,i.m_p),u=i.m_radius,a=new o(t.q.c,t.q.s);this.m_debugDraw.DrawSolidCircle(s,u,a,n);break;case R.e_polygon:var f=0,l=e instanceof q?e:null,c=parseInt(l.GetVertexCount()),h=l.m_vertices,p=new Vector(c);for(f=0;f<c;++f)p[f]=r.MulXV(t,h[f]);this.m_debugDraw.DrawSolidPolygon(p,c,n);break;case R.e_edge:var d=e instanceof j?e:null;this.m_debugDraw.DrawSegment(r.MulXV(t,d.GetVertex1()),r.MulXV(t,d.GetVertex2()),n);break;case R.e_chain:var v=e instanceof F?e:null,m=v.m_count,p=v.m_vertices,g=r.MulXV(t,p[0]);for(var f=0;f<m;++f)v2=r.MulXV(t,p[f]),this.m_debugDraw.DrawSegment(g,v2,n),this.m_debugDraw.DrawCircle(g,.05,n),g.SetV(v2)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new it,Box2D.Dynamics.b2World.s_xf=new s,Box2D.Dynamics.b2World.s_backupA=new i,Box2D.Dynamics.b2World.s_backupB=new i,Box2D.Dynamics.b2World.s_timestep=new it,Box2D.Dynamics.b2World.s_jointColor=new a(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2,Box2D.Dynamics.b2World.e_clearForces=4})}(),function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2ChainShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2ChainAndCircleContact,u=Box2D.Dynamics.Contacts.b2ChainAndPolygonContact,a=Box2D.Dynamics.Contacts.b2CircleContact,f=Box2D.Dynamics.Contacts.b2Contact,l=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactPositionConstraint,h=Box2D.Dynamics.Contacts.b2ContactRegister,p=Box2D.Dynamics.Contacts.b2ContactSolver,d=Box2D.Dynamics.Contacts.b2ContactSolverDef,v=Box2D.Dynamics.Contacts.b2ContactVelocityConstraint,m=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,g=Box2D.Dynamics.Contacts.b2PolygonAndCircleContact,y=Box2D.Dynamics.Contacts.b2EdgeAndPolygonContact,b=Box2D.Dynamics.Contacts.b2PolygonContact,w=Box2D.Dynamics.Contacts.b2PositionSolverManifold,E=Box2D.Dynamics.Contacts.b2VelocityConstraintPoint,S=Box2D.Dynamics.b2Body,x=Box2D.Dynamics.b2BodyDef,T=Box2D.Dynamics.b2ContactFilter,N=Box2D.Dynamics.b2ContactImpulse,C=Box2D.Dynamics.b2ContactListener,k=Box2D.Dynamics.b2ContactManager,L=Box2D.Dynamics.b2Draw,A=Box2D.Dynamics.b2DestructionListener,O=Box2D.Dynamics.b2Filter,M=Box2D.Dynamics.b2Fixture,_=Box2D.Dynamics.b2FixtureDef,D=Box2D.Dynamics.b2Island,P=Box2D.Dynamics.b2Position,H=Box2D.Dynamics.b2Profile,B=Box2D.Dynamics.b2SolverData,j=Box2D.Dynamics.b2TimeStep,F=Box2D.Dynamics.b2Velocity,I=Box2D.Dynamics.b2World,q=Box2D.Common.b2Color,R=Box2D.Common.b2Settings,U=Box2D.Common.Math.b2Mat22,z=Box2D.Common.Math.b2Mat33,W=Box2D.Common.Math.b2Rot,X=Box2D.Common.Math.b2Math,V=Box2D.Common.Math.b2Sweep,$=Box2D.Common.Math.b2Transform,J=Box2D.Common.Math.b2Vec2,K=Box2D.Common.Math.b2Vec3,Q=Box2D.Collision.b2AABB,G=Box2D.Collision.b2Collision,Y=Box2D.Collision.b2ContactID,Z=Box2D.Collision.b2Distance,et=Box2D.Collision.b2DistanceInput,tt=Box2D.Collision.b2DistanceOutput,nt=Box2D.Collision.b2DistanceProxy,rt=Box2D.Collision.b2DynamicTree,it=Box2D.Collision.b2BroadPhase,st=Box2D.Collision.b2TreeNode,ot=Box2D.Collision.b2Pair,ut=Box2D.Collision.b2Manifold,at=Box2D.Collision.b2ManifoldPoint,ft=Box2D.Collision.b2RayCastInput,lt=Box2D.Collision.b2RayCastOutput,ct=Box2D.Collision.b2SeparationFunction,ht=Box2D.Collision.b2Simplex,pt=Box2D.Collision.b2SimplexCache,dt=Box2D.Collision.b2SimplexVertex,vt=Box2D.Collision.b2TOIInput,mt=Box2D.Collision.b2TOIOutput,gt=Box2D.Collision.b2WorldManifold,yt=Box2D.Collision.b2ClipVertex,bt=Box2D.Collision.b2ContactFeature,wt=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact),o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,o.b2ChainAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},o.Create=function(e){return new o},o.Destroy=function(e,t){},o.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},o.prototype.Evaluate=function(r,i,s){var o=this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,u=new t;o.GetChildEdge(u,this.m_indexA),G.CollideEdgeAndCircle(r,u,i,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,s)},Box2D.inherit(u,Box2D.Dynamics.Contacts.b2Contact),u.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,u.b2ChainAndPolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(e){return new u},u.Destroy=function(e,t){},u.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r),R.b2Assert(this.m_fixtureA.GetType()===s.e_chain),R.b2Assert(this.m_fixtureB.GetType()===s.e_polygon)},u.prototype.Evaluate=function(e,r,s){var o=this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,u=new t;o.GetChildEdge(u,this.m_indexA),G.CollideEdgeAndPolygon(e,u,r,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,s)},Box2D.inherit(a,Box2D.Dynamics.Contacts.b2Contact),a.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,a.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},a.Create=function(e){return new a},a.Destroy=function(e,t){},a.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},a.prototype.Evaluate=function(t,n,r){G.CollideCircles(t,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,n,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r)},f.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new ut,this.m_oldManifold=new ut,this.m_fixtureA=null,this.m_fixtureB=null},f.InitializeRegisters=function(){f.s_registers=new Vector(s.e_typeCount);for(var e=0;e<s.e_typeCount;e++){f.s_registers[e]=new Vector(s.e_typeCount);for(var t=0;t<s.e_typeCount;t++)f.s_registers[e][t]=new h}f.AddType(a.Create,a.Destroy,s.e_circle,s.e_circle),f.AddType(g.Create,g.Destroy,s.e_polygon,s.e_circle),f.AddType(b.Create,b.Destroy,s.e_polygon,s.e_polygon),f.AddType(m.Create,m.Destroy,s.e_edge,s.e_circle),f.AddType(y.Create,y.Destroy,s.e_edge,s.e_polygon),f.AddType(o.Create,o.Destroy,s.e_chain,s.e_circle),f.AddType(u.Create,u.Destroy,s.e_chain,s.e_polygon)},f.AddType=function(e,t,n,r){R.b2Assert(0<=n&&n<s.e_typeCount),R.b2Assert(0<=r&&r<s.e_typeCount),f.s_registers[n][r].createFcn=e,f.s_registers[n][r].destroyFcn=t,f.s_registers[n][r].primary=!0,n!=r&&(f.s_registers[r][n].createFcn=e,f.s_registers[r][n].destroyFcn=t,f.s_registers[r][n].primary=!1)},f.Create=function(e,t,n,r,i){f.s_initialized==0&&(f.InitializeRegisters(),f.s_initialized=!0);var o=e.GetType(),u=n.GetType();R.b2Assert(0<=o&&o<s.e_typeCount),R.b2Assert(0<=u&&u<s.e_typeCount);var a=this.s_registers[o][u],l;if(a.pool)return l=a.pool,a.pool=l.m_next,a.poolCount--,l.Reset(e,t,n,r),l;var c=a.createFcn;return c?(a.primary?(l=c(i),l.Reset(e,t,n,r)):(l=c(i),l.Reset(n,r,e,t)),l):null},f.Destroy=function(e,t){R.b2Assert(f.s_initialized==1),e.m_manifold.pointCount>0&&(e.GetFixtureA().GetBody().SetAwake(!0),e.GetFixtureB().GetBody().SetAwake(!0));var n=e.GetFixtureA().GetType(),r=e.GetFixtureB().GetType();R.b2Assert(0<=n&&r<s.e_typeCount),R.b2Assert(0<=n&&r<s.e_typeCount);var i=this.s_registers[n][r];i.poolCount++,e.m_next=i.pool,i.pool=e;var o=i.destroyFcn;o(e,t)},f.prototype.b2Contact=function(){},f.prototype.Reset=function(e,t,n,r){this.m_flags=f.e_enabledFlag,this.m_fixtureA=e,this.m_fixtureB=n,this.m_indexA=t,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=R.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=R.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},f.prototype.GetFriction=function(){return this.m_friction},f.prototype.SetFriction=function(e){this.m_friction=e},f.prototype.ResetFriction=function(){this.m_friction=R.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},f.prototype.GetRestitution=function(){return this.m_restitution},f.prototype.SetRestitution=function(e){this.m_restitution=e},f.prototype.ResetRestitution=function(){this.m_restitution=R.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},f.prototype.GetManifold=function(){return this.m_manifold},f.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},f.prototype.IsTouching=function(){return(this.m_flags&f.e_touchingFlag)==f.e_touchingFlag},f.prototype.SetEnabled=function(e){e?this.m_flags|=f.e_enabledFlag:this.m_flags&=~f.e_enabledFlag},f.prototype.IsEnabled=function(){return(this.m_flags&f.e_enabledFlag)==f.e_enabledFlag},f.prototype.GetNext=function(){return this.m_next},f.prototype.GetFixtureA=function(){return this.m_fixtureA},f.prototype.GetFixtureB=function(){return this.m_fixtureB},f.prototype.FlagForFiltering=function(){this.m_flags|=f.e_filterFlag},f.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=f.e_enabledFlag;var n=!1,r=(this.m_flags&f.e_touchingFlag)==f.e_touchingFlag,i=this.m_fixtureA.IsSensor(),o=this.m_fixtureB.IsSensor(),u=i||o,a=this.m_fixtureA.m_body,l=this.m_fixtureB.m_body,c=a.GetTransform(),h=l.GetTransform();if(u){var p=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape();n=s.TestOverlap(p,this.m_indexA,d,this.m_indexB,c,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,c,h),n=this.m_manifold.pointCount>0;for(var v=0;v<this.m_manifold.pointCount;++v){var m=this.m_manifold.points[v];m.normalImpulse=0,m.tangentImpulse=0;var g=m.id;for(var y=0;y<this.m_oldManifold.pointCount;++y){var b=this.m_oldManifold.points[y];if(b.id.key==g.key){m.normalImpulse=b.normalImpulse,m.tangentImpulse=b.tangentImpulse;break}}}n!=r&&(a.SetAwake(!0),l.SetAwake(!0))}n?this.m_flags|=f.e_touchingFlag:this.m_flags&=~f.e_touchingFlag,r==0&&n==1&&e&&e.BeginContact(this),r==1&&n==0&&e&&e.EndContact(this),u==0&&n&&e&&e.PreSolve(this,this.m_oldManifold)},f.prototype.Evaluate=function(e,t,n){},f.prototype.GetChildIndexA=function(){return this.m_indexA},f.prototype.GetChildIndexB=function(){return this.m_indexB},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_bulletHitFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=32,Box2D.Dynamics.Contacts.b2Contact.s_initialized=!1,Box2D.Dynamics.Contacts.b2Contact.s_registers=null}),l.b2ContactEdge=function(){},c.b2ContactPositionConstraint=function(){this.localNormal=new J,this.localPoint=new J,this.localCenterA=new J,this.localCenterB=new J},c.prototype.b2ContactPositionConstraint=function(){this.localPoints=new Vector(R.b2_maxManifoldPoints);for(var e=0;e<R.b2_maxManifoldPoints;e++)this.localPoints[e]=new J},h.b2ContactRegister=function(){this.poolCount=0},p.b2ContactSolver=function(){this.m_step=new j,this.m_positionConstraints=new Vector,this.m_velocityConstraints=new Vector,this.m_contacts=null},p.prototype.b2ContactSolver=function(){},p.prototype.Initialize=function(e){this.m_step.Set(e.step),this.m_allocator=e.allocator,this.m_count=e.count;var t,n=0,r,i,s,o;while(this.m_positionConstraints.length<this.m_count)this.m_positionConstraints[this.m_positionConstraints.length]=new c;while(this.m_velocityConstraints.length<this.m_count)this.m_velocityConstraints[this.m_velocityConstraints.length]=new v;this.m_positions=e.positions,this.m_velocities=e.velocities,this.m_contacts=e.contacts;for(n=0;n<this.m_count;++n){t=this.m_contacts[n];var u=t.m_fixtureA,a=t.m_fixtureB,f=u.GetShape(),l=a.GetShape(),h=f.m_radius,p=l.m_radius,d=u.GetBody(),m=a.GetBody(),g=t.GetManifold(),y=g.pointCount;R.b2Assert(y>0),i=this.m_velocityConstraints[n],i.friction=t.m_friction,i.restitution=t.m_restitution,i.indexA=d.m_islandIndex,i.indexB=m.m_islandIndex,i.invMassA=d.m_invMass,i.invMassB=m.m_invMass,i.invIA=d.m_invI,i.invIB=m.m_invI,i.contactIndex=n,i.pointCount=y,i.K.SetZero(),i.normalMass.SetZero(),r=this.m_positionConstraints[n],r.indexA=d.m_islandIndex,r.indexB=m.m_islandIndex,r.invMassA=d.m_invMass,r.invMassB=m.m_invMass,r.localCenterA=d.m_sweep.localCenter.Copy(),r.localCenterB=m.m_sweep.localCenter.Copy(),r.invIA=d.m_invI,r.invIB=m.m_invI,r.localNormal=g.localNormal.Copy(),r.localPoint=g.localPoint.Copy(),r.pointCount=y,r.radiusA=h,r.radiusB=p,r.type=g.type;for(var b=0;b<y;++b)s=g.points[b],o=i.points[b],this.m_step.warmStarting?(o.normalImpulse=this.m_step.dtRatio*s.normalImpulse,o.tangentImpulse=this.m_step.dtRatio*s.tangentImpulse):(o.normalImpulse=0,o.tangentImpulse=0),o.rA.SetZero(),o.rB.SetZero(),o.normalMass=0,o.tangentMass=0,o.velocityBias=0,r.localPoints[b]=s.localPoint.Copy()}},p.prototype.InitializeVelocityConstraints=function(){var e=0,t=0,n,r,i;for(e=0;e<this.m_count;++e){n=this.m_velocityConstraints[e],i=this.m_positionConstraints[e];var s=i.radiusA,o=i.radiusB,u=this.m_contacts[n.contactIndex].GetManifold(),a=n.indexA,f=n.indexB,l=n.invMassA,c=n.invMassB,h=n.invIA,d=n.invIB,v=i.localCenterA,m=i.localCenterB,g=this.m_positions[a].c,y=this.m_positions[a].a,b=this.m_velocities[a].v,w=this.m_velocities[a].w,E=this.m_positions[f].c,S=this.m_positions[f].a,x=this.m_velocities[f].v,T=this.m_velocities[f].w;R.b2Assert(u.pointCount>0);var N=p.s_xfA,C=p.s_xfB;N.q.Set(y),C.q.Set(S),N.p.x=g.x-(N.q.c*v.x-N.q.s*v.y),N.p.y=g.y-(N.q.s*v.x+N.q.c*v.y),C.p.x=E.x-(C.q.c*m.x-C.q.s*m.y),C.p.y=E.y-(C.q.s*m.x+C.q.c*m.y);var k=p.s_b2WorldManifold;k.Initialize(u,N,s,C,o),n.normal.SetV(k.normal);var L=n.pointCount;for(t=0;t<L;++t){r=n.points[t];var A=r.rA,O=r.rB,M=n.normal;A.x=k.points[t].x-g.x,A.y=k.points[t].y-g.y,O.x=k.points[t].x-E.x,O.y=k.points[t].y-E.y;var _=A.x*M.y-A.y*M.x,D=O.x*M.y-O.y*M.x,P=l+c+h*_*_+d*D*D;r.normalMass=P>0?1/P:0;var H=X.CrossVF(M,1),B=A.x*H.y-A.y*H.x,j=O.x*H.y-O.y*H.x,F=l+c+h*B*B+d*j*j;r.tangentMass=F>0?1/F:0,r.velocityBias=0;var I=x.x+ -T*O.y,q=x.y+T*O.x;I-=b.x,q-=b.y,I-=-w*A.y,q-=w*A.x;var U=M.x*I+M.y*q;U<-R.b2_velocityThreshold&&(r.velocityBias=-n.restitution*U)}if(n.pointCount==2){var z=n.points[0],W=n.points[1],V=X.CrossVV(z.rA,n.normal),$=X.CrossVV(z.rB,n.normal),J=X.CrossVV(W.rA,n.normal),K=X.CrossVV(W.rB,n.normal),Q=l+c+h*V*V+d*$*$,G=l+c+h*J*J+d*K*K,Y=l+c+h*V*J+d*$*K,Z=1e3;Q*Q<Z*(Q*G-Y*Y)?(n.K.ex.Set(Q,Y),n.K.ey.Set(Y,G),n.normalMass=n.K.GetInverse()):n.pointCount=1}}},p.prototype.WarmStart=function(){var e,t,n;for(var r=0;r<this.m_count;++r){var i=this.m_velocityConstraints[r],s=i.indexA,o=i.indexB,u=i.invMassA,a=i.invIA,f=i.invMassB,l=i.invIB,c=i.pointCount,h=this.m_velocities[s].v,p=this.m_velocities[s].w,d=this.m_velocities[o].v,v=this.m_velocities[o].w,m=i.normal.x,g=i.normal.y,y=g,b=-m;for(var w=0;w<c;++w)e=i.points[w],t=e.normalImpulse*m+e.tangentImpulse*y,n=e.normalImpulse*g+e.tangentImpulse*b,p-=a*(e.rA.x*n-e.rA.y*t),h.x-=u*t,h.y-=u*n,v+=l*(e.rB.x*n-e.rB.y*t),d.x+=f*t,d.y+=f*n;this.m_velocities[s].w=p,this.m_velocities[o].w=v}},p.prototype.SolveVelocityConstraints=function(){var e=0,t=0,n,r=0,i=0,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;for(e=0;e<this.m_count;++e){var w=this.m_velocityConstraints[e],E=w.indexA,S=w.indexB,x=w.invMassA,T=w.invIA,N=w.invMassB,C=w.invIB,k=w.pointCount,L=this.m_velocities[E].v,A=this.m_velocities[E].w,O=this.m_velocities[S].v,M=this.m_velocities[S].w,_=w.normal.x,D=w.normal.y,P=D,H=-_,B=w.friction;for(t=0;t<k;++t)n=w.points[t],r=O.x-M*n.rB.y-L.x+A*n.rA.y,i=O.y+M*n.rB.x-L.y-A*n.rA.x,s=r*P+i*H,u=n.tangentMass*-s,a=B*n.normalImpulse,f=X.Clamp(n.tangentImpulse+u,-a,a),u=f-n.tangentImpulse,n.tangentImpulse=f,l=u*P,c=u*H,L.x-=x*l,L.y-=x*c,A-=T*(n.rA.x*c-n.rA.y*l),O.x+=N*l,O.y+=N*c,M+=C*(n.rB.x*c-n.rB.y*l);if(w.pointCount==1)n=w.points[0],r=O.x+ -M*n.rB.y-L.x- -A*n.rA.y,i=O.y+M*n.rB.x-L.y-A*n.rA.x,o=r*_+i*D,u=-n.normalMass*(o-n.velocityBias),f=X.Max(n.normalImpulse+u,0),u=f-n.normalImpulse,n.normalImpulse=f,l=u*_,c=u*D,L.x-=x*l,L.y-=x*c,A-=T*(n.rA.x*c-n.rA.y*l),O.x+=N*l,O.y+=N*c,M+=C*(n.rB.x*c-n.rB.y*l);else{var j=w.points[0],F=w.points[1],I=j.normalImpulse,q=F.normalImpulse,R=O.x-M*j.rB.y-L.x+A*j.rA.y,U=O.y+M*j.rB.x-L.y-A*j.rA.x,z=O.x-M*F.rB.y-L.x+A*F.rA.y,W=O.y+M*F.rB.x-L.y-A*F.rA.x,V=R*_+U*D,$=z*_+W*D,J=V-j.velocityBias,K=$-F.velocityBias;y=w.K,J-=y.ex.x*I+y.ey.x*q,K-=y.ex.y*I+y.ey.y*q;for(;;){y=w.normalMass;var Q=-(y.ex.x*J+y.ey.x*K),G=-(y.ex.y*J+y.ey.y*K);if(Q>=0&&G>=0){h=Q-I,p=G-q,d=h*_,v=h*D,m=p*_,g=p*D,L.x-=x*(d+m),L.y-=x*(v+g),A-=T*(j.rA.x*v-j.rA.y*d+F.rA.x*g-F.rA.y*m),O.x+=N*(d+m),O.y+=N*(v+g),M+=C*(j.rB.x*v-j.rB.y*d+(F.rB.x*g-F.rB.y*m)),j.normalImpulse=Q,F.normalImpulse=G;break}Q=-j.normalMass*J,G=0,V=0,$=w.K.ex.y*Q+K;if(Q>=0&&$>=0){h=Q-I,p=G-q,d=h*_,v=h*D,m=p*_,g=p*D,L.x-=x*(d+m),L.y-=x*(v+g),A-=T*(j.rA.x*v-j.rA.y*d+F.rA.x*g-F.rA.y*m),O.x+=N*(d+m),O.y+=N*(v+g),M+=C*(j.rB.x*v-j.rB.y*d+F.rB.x*g-F.rB.y*m),j.normalImpulse=Q,F.normalImpulse=G;break}Q=0,G=-F.normalMass*K,V=w.K.ey.x*G+J,$=0;if(G>=0&&V>=0){h=Q-I,p=G-q,d=h*_,v=h*D,m=p*_,g=p*D,L.x-=x*(d+m),L.y-=x*(v+g),A-=T*(j.rA.x*v-j.rA.y*d+F.rA.x*g-F.rA.y*m),O.x+=N*(d+m),O.y+=N*(v+g),M+=C*(j.rB.x*v-j.rB.y*d+F.rB.x*g-F.rB.y*m),j.normalImpulse=Q,F.normalImpulse=G;break}Q=0,G=0,V=J,$=K;if(V>=0&&$>=0){h=Q-I,p=G-q,d=h*_,v=h*D,m=p*_,g=p*D,L.x-=x*(d+m),L.y-=x*(v+g),A-=T*(j.rA.x*v-j.rA.y*d+F.rA.x*g-F.rA.y*m),O.x+=N*(d+m),O.y+=N*(v+g),M+=C*(j.rB.x*v-j.rB.y*d+F.rB.x*g-F.rB.y*m),j.normalImpulse=Q,F.normalImpulse=G;break}break}}this.m_velocities[E].w=A,this.m_velocities[S].w=M}},p.prototype.FinalizeVelocityConstraints=function(){var e=0,t=0,n,r;for(e=0;e<this.m_constraintCount;++e){var i=this.m_constraints[e],s=i.manifold;for(t=0;t<i.pointCount;++t)n=s.m_points[t],r=i.points[t],n.normalImpulse=r.normalImpulse,n.tangentImpulse=r.tangentImpulse}},p.prototype.SolvePositionConstraints=function(){var e=0,t=0,n=0,r=p.s_xfA,i=p.s_xfB;for(t=0;t<this.m_count;++t){var s=this.m_positionConstraints[t],o=s.indexA,u=s.indexB,a=s.localCenterA,f=s.invMassA,l=s.invIA,c=s.localCenterB,h=s.invMassB,d=s.invIB,v=s.pointCount,m=this.m_positions[o].c,g=this.m_positions[o].a,y=this.m_positions[u].c,b=this.m_positions[u].a,w=p.s_psm;for(n=0;n<v;++n){r.q.Set(g),i.q.Set(b),r.p.x=m.x-(r.q.c*a.x-r.q.s*a.y),r.p.y=m.y-(r.q.s*a.x+r.q.c*a.y),i.p.x=y.x-(i.q.c*c.x-i.q.s*c.y),i.p.y=y.y-(i.q.s*c.x+i.q.c*c.y),w.Initialize(s,r,i,n);var E=w.normal,S=w.point,x=w.separation,T=S.x-m.x,N=S.y-m.y,C=S.x-y.x,k=S.y-y.y;e=X.Min(e,x);var L=X.Clamp(R.b2_baumgarte*(x+R.b2_linearSlop),-R.b2_maxLinearCorrection,0),A=T*E.y-N*E.x,O=C*E.y-k*E.x,M=f+h+l*A*A+d*O*O,_=M>0?-L/M:0,D=_*E.x,P=_*E.y;m.x-=f*D,m.y-=f*P,g-=l*(T*P-N*D),y.x+=h*D,y.y+=h*P,b+=d*(C*P-k*D)}this.m_positions[o].a=g,this.m_positions[u].a=b}return e>=-3*R.b2_linearSlop},p.prototype.StoreImpulses=function(){var e=0,t=0;for(e=0;e<this.m_count;++e){var n=this.m_velocityConstraints[e],r=this.m_contacts[n.contactIndex].GetManifold();for(t=0;t<n.pointCount;++t)r.points[t].normalImpulse=n.points[t].normalImpulse,r.points[t].tangentImpulse=n.points[t].tangentImpulse}},p.prototype.SolveTOIPositionConstraints=function(e,t){var n=0,r=0,i=0;for(r=0;r<this.m_count;++r){var s=this.m_positionConstraints[r],o=s.indexA,u=s.indexB,a=s.localCenterA,f=s.localCenterB,l=s.pointCount,c=0,h=0;if(o==e||o==t)c=s.invMassA,h=s.invIA;var d=s.invMassB,v=s.invIB;if(u==e||u==t)d=s.invMassB,v=s.invIB;var m=this.m_positions[o].c,g=this.m_positions[o].a,y=this.m_positions[u].c,b=this.m_positions[u].a;for(i=0;i<l;++i){var w=new $,E=new $;w.q.Set(g),E.q.Set(b),w.p=X.SubtractVV(m,X.MulRV(w.q,a)),E.p=X.SubtractVV(y,X.MulRV(E.q,f));var S=p.s_psm;S.Initialize(s,w,E,i);var x=S.normal.Copy(),T=S.point.Copy(),N=S.separation,C=X.SubtractVV(T,m),k=X.SubtractVV(T,y);n=X.Min(n,N);var L=X.Clamp(R.b2_toiBaugarte*(N+R.b2_linearSlop),-b2_maxLinearCorrection,0),A=X.CrossVV(C,x),O=X.CrossVV(k,x),M=c+d+h*A*A+v*O*O,_=M>0?-L/M:0,D=X.MulFV(_,x);m.Subtract(X.MulFV(c,D)),g-=h*X.CrossVV(C,D),y.Add(X.MulFV(d,D)),b+=v*X.CrossVV(k,D)}this.m_positions[o].a=g,this.m_positions[u].a=b}return n>=-1.5*R.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_xfA=new $,Box2D.Dynamics.Contacts.b2ContactSolver.s_xfB=new $,Box2D.Dynamics.Contacts.b2ContactSolver.s_b2WorldManifold=new gt,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new w}),d.b2ContactSolverDef=function(){},d.prototype.b2ContactSolverDef=function(){this.contacts=null,this.count=0,this.positions=null,this.step=null,this.velocities=null,this.allocator=null},v.b2ContactVelocityConstraint=function(){this.normal=new J,this.normalMass=new U,this.K=new U},v.prototype.b2ContactVelocityConstraint=function(){this.points=new Vector(R.b2_maxManifoldPoints);for(var e=0;e<R.b2_maxManifoldPoints;e++)this.points[e]=new E},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(e){return new m},m.Destroy=function(e,t){},m.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},m.prototype.Evaluate=function(n,r,i){G.CollideEdgeAndCircle(n,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,r,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,i)},Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2PolygonAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(e){return new g},g.Destroy=function(e,t){},g.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},g.prototype.Evaluate=function(t,n,r){G.CollidePolygonAndCircle(t,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,n,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r)},Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact),y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,y.b2EdgeAndPolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(e){return new y},y.Destroy=function(e,t){},y.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},y.prototype.Evaluate=function(e,n,r){G.CollideEdgeAndPolygon(e,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,n,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,r)},Box2D.inherit(b,Box2D.Dynamics.Contacts.b2Contact),b.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b.Create=function(e){return new b},b.Destroy=function(e,t){},b.prototype.Reset=function(e,t,n,r){this.__super.Reset.call(this,e,t,n,r)},b.prototype.Evaluate=function(e,t,n){var r=this.m_fixtureA.GetShape();r instanceof i||(r=null);var s=this.m_fixtureB.GetShape();s instanceof i||(s=null),G.CollidePolygons(e,r,t,s,n)},w.b2PositionSolverManifold=function(){},w.prototype.b2PositionSolverManifold=function(){this.normal=new J,this.separation=0,this.point=new J},w.prototype.Initialize=function(e,t,n,r){R.b2Assert(e.pointCount>0);var i,s;switch(e.type){case ut.e_circles:i=t.q,s=e.localPoint;var o=i.c*s.x-i.s*s.y+t.p.x,u=i.s*s.x+i.c*s.y+t.p.y;i=n.q,s=e.localPoints[0];var a=i.c*s.x-i.s*s.y+n.p.x,f=i.s*s.x+i.c*s.y+n.p.y;this.normal.Set(a-o,f-u),this.normal.Normalize(),this.point.Set(.5*(o+a),.5*(u+f)),this.separation=(a-o)*this.normal.x+(f-u)*this.normal.y-e.radiusA-e.radiusB;break;case ut.e_faceA:i=t.q,s=e.localNormal,this.normal.x=i.c*s.x-i.s*s.y,this.normal.y=i.s*s.x+i.c*s.y,s=e.localPoint;var l=i.c*s.x-i.s*s.y+t.p.x,c=i.s*s.x+i.c*s.y+t.p.y;i=n.q,s=e.localPoints[r];var h=i.c*s.x-i.s*s.y+n.p.x,p=i.s*s.x+i.c*s.y+n.p.y;this.separation=(h-l)*this.normal.x+(p-c)*this.normal.y-e.radiusA-e.radiusB,this.point.Set(h,p);break;case ut.e_faceB:i=n.q,s=e.localNormal,this.normal.x=i.c*s.x-i.s*s.y,this.normal.y=i.s*s.x+i.c*s.y,s=e.localPoint;var l=i.c*s.x-i.s*s.y+n.p.x,c=i.s*s.x+i.c*s.y+n.p.y;i=t.q,s=e.localPoints[r];var h=i.c*s.x-i.s*s.y+t.p.x,p=i.s*s.x+i.c*s.y+t.p.y;this.separation=(h-l)*this.normal.x+(p-c)*this.normal.y-e.radiusA-e.radiusB,this.point.Set(h,p),this.normal=this.normal.GetNegative()}},E.b2VelocityConstraintPoint=function(){this.rA=new J,this.rB=new J}}(),function(){var e=Box2D.Dynamics.b2Body,t=Box2D.Dynamics.b2BodyDef,n=Box2D.Dynamics.b2ContactFilter,r=Box2D.Dynamics.b2ContactImpulse,i=Box2D.Dynamics.b2ContactListener,s=Box2D.Dynamics.b2ContactManager,o=Box2D.Dynamics.b2Draw,u=Box2D.Dynamics.b2DestructionListener,a=Box2D.Dynamics.b2Filter,f=Box2D.Dynamics.b2Fixture,l=Box2D.Dynamics.b2FixtureDef,c=Box2D.Dynamics.b2Island,h=Box2D.Dynamics.b2Position,p=Box2D.Dynamics.b2Profile,d=Box2D.Dynamics.b2SolverData,v=
// Box2D.Dynamics.b2TimeStep,m=Box2D.Dynamics.b2Velocity,g=Box2D.Dynamics.b2World,y=Box2D.Common.Math.b2Mat22,b=Box2D.Common.Math.b2Mat33,w=Box2D.Common.Math.b2Rot,E=Box2D.Common.Math.b2Math,S=Box2D.Common.Math.b2Sweep,x=Box2D.Common.Math.b2Transform,T=Box2D.Common.Math.b2Vec2,N=Box2D.Common.Math.b2Vec3,C=Box2D.Common.b2Color,k=Box2D.Common.b2Settings,L=Box2D.Collision.Shapes.b2CircleShape,A=Box2D.Collision.Shapes.b2EdgeShape,O=Box2D.Collision.Shapes.b2ChainShape,M=Box2D.Collision.Shapes.b2MassData,_=Box2D.Collision.Shapes.b2PolygonShape,D=Box2D.Collision.Shapes.b2Shape}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,i=Box2D.Common.Math.b2Rot,s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,f=Box2D.Common.Math.b2Vec3,l=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,h=Box2D.Dynamics.Joints.b2FrictionJoint,p=Box2D.Dynamics.Joints.b2FrictionJointDef,d=Box2D.Dynamics.Joints.b2GearJoint,v=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,g=Box2D.Dynamics.Joints.b2Joint,y=Box2D.Dynamics.Joints.b2JointDef,b=Box2D.Dynamics.Joints.b2JointEdge,w=Box2D.Dynamics.Joints.b2MouseJoint,E=Box2D.Dynamics.Joints.b2MouseJointDef,S=Box2D.Dynamics.Joints.b2PrismaticJoint,x=Box2D.Dynamics.Joints.b2PrismaticJointDef,T=Box2D.Dynamics.Joints.b2PulleyJoint,N=Box2D.Dynamics.Joints.b2PulleyJointDef,C=Box2D.Dynamics.Joints.b2RevoluteJoint,k=Box2D.Dynamics.Joints.b2RevoluteJointDef,L=Box2D.Dynamics.Joints.b2RopeJoint,A=Box2D.Dynamics.Joints.b2RopeJointDef,O=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,_=Box2D.Dynamics.Joints.b2WheelJoint,D=Box2D.Dynamics.Joints.b2WheelJointDef,P=Box2D.Dynamics.b2Body,H=Box2D.Dynamics.b2BodyDef,B=Box2D.Dynamics.b2ContactFilter,j=Box2D.Dynamics.b2ContactImpulse,F=Box2D.Dynamics.b2ContactListener,I=Box2D.Dynamics.b2ContactManager,q=Box2D.Dynamics.b2Draw,R=Box2D.Dynamics.b2DestructionListener,U=Box2D.Dynamics.b2Filter,z=Box2D.Dynamics.b2Fixture,W=Box2D.Dynamics.b2FixtureDef,X=Box2D.Dynamics.b2Island,V=Box2D.Dynamics.b2Position,$=Box2D.Dynamics.b2Profile,J=Box2D.Dynamics.b2SolverData,K=Box2D.Dynamics.b2TimeStep,Q=Box2D.Dynamics.b2Velocity,G=Box2D.Dynamics.b2World;Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_u=new a,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a},l.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},l.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(e){return new a(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},l.prototype.GetReactionTorque=function(e){return 0},l.prototype.GetLength=function(){return this.m_length},l.prototype.SetLength=function(e){this.m_length=e},l.prototype.GetFrequency=function(){return this.m_frequencyHz},l.prototype.SetFrequency=function(e){this.m_frequencyHz=e},l.prototype.GetDampingRatio=function(){return this.m_dampingRatio},l.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},l.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},l.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter.Copy(),this.m_localCenterB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c.Copy(),f=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v.Copy(),c=e.velocities[this.m_indexB].w,h=new i(r),p=new i(f);this.m_rA=s.MulRV(h,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(p,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),this.m_u=s.AddVV(a,this.m_rB),this.m_u.Subtract(n),this.m_u.Subtract(this.m_rA);var d=this.m_u.Length();d>t.b2_linearSlop?this.m_u.Multiply(1/d):this.m_u.Set(0,0);var v=s.CrossVV(this.m_rA,this.m_u),m=s.CrossVV(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*v*v+this.m_invMassB+this.m_invIB*m*m;this.m_mass=g!=0?1/g:0;if(this.m_frequencyHz>0){var y=d-this.m_length,b=2*t.b2_pi*this.m_frequencyHz,w=2*this.m_mass*this.m_dampingRatio*b,E=this.m_mass*b*b,S=e.step.dt;this.m_gamma=S*(w+S*E),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=y*S*E*this.m_gamma,g+=this.m_gamma,this.m_mass=g!=0?1/g:0}else this.m_gamma=0,this.m_bias=0;if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var x=s.MulFV(this.m_impulse,this.m_u);o.Subtract(s.MulFV(this.m_invMassA,x)),u-=this.m_invIA*s.CrossVV(this.m_rA,x),l.Add(s.MulFV(this.m_invMassB,x)),c+=this.m_invIB*s.CrossVV(this.m_rB,x)}else this.m_impulse=0;e.velocities[this.m_indexA].v=o.Copy(),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v=l.Copy(),e.velocities[this.m_indexB].w=c},l.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=s.AddVV(t,s.CrossFV(n,this.m_rA)),u=s.AddVV(r,s.CrossFV(i,this.m_rB)),a=s.DotVV(this.m_u,s.SubtractVV(u,o)),f=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;var l=s.MulFV(f,this.m_u);t.Subtract(s.MulFV(this.m_invMassA,l)),n-=this.m_invIA*s.CrossVV(this.m_rA,l),r.Add(s.MulFV(this.m_invMassB,l)),i+=this.m_invIB*s.CrossVV(this.m_rB,l),e.velocities[this.m_indexA].v=t.Copy(),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v=r.Copy(),e.velocities[this.m_indexB].w=i},l.prototype.SolvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.positions[this.m_indexB].c.Copy(),u=e.positions[this.m_indexB].a,a=new i(r),f=new i(u),l=s.MulRV(a,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),c=s.MulRV(f,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),h=s.AddVV(o,c);h.Subtract(n),h.Subtract(l);var p=h.Normalize(),d=p-this.m_length;d=s.Clamp(d,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var v=-this.m_mass*d,m=s.MulFV(v,h);return n.Subtract(s.MulFV(this.m_invMassA,m)),r-=this.m_invIA*s.CrossVV(l,m),o.Add(s.MulFV(this.m_invMassB,m)),u+=this.m_invIB*s.CrossVV(c,m),e.positions[this.m_indexA].c=n.Copy(),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].c=o.Copy(),e.positions[this.m_indexB].a=u,s.Abs(d)<t.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},c.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var i=r.x-n.x,s=r.y-n.y;this.length=Math.sqrt(i*i+s*s)},Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint),h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,h.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_linearMass=new n,this.m_linearImpulse=new a,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a},h.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},h.prototype.GetReactionForce=function(e){return new a(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},h.prototype.GetReactionTorque=function(e){return e*this.m_angularImpulse},h.prototype.SetMaxForce=function(e){this.m_maxForce=e},h.prototype.GetMaxForce=function(){return this.m_maxForce},h.prototype.SetMaxTorque=function(e){this.m_maxTorque=e},h.prototype.GetMaxTorque=function(){return this.m_maxTorque},h.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},h.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter.Copy(),this.m_localCenterB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v.Copy(),o=e.velocities[this.m_indexA].w,u=e.positions[this.m_indexB].a,f=e.velocities[this.m_indexB].v.Copy(),l=e.velocities[this.m_indexB].w,c=new i(t),h=new i(u);this.m_rA=s.MulRV(c,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(h,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB));var p=this.m_invMassA,d=this.m_invMassB,v=this.m_invIA,m=this.m_invIB,g=new n;g.ex.x=p+d+v*this.m_rA.y*this.m_rA.y+m*this.m_rB.y*this.m_rB.y,g.ex.y=-v*this.m_rA.x*this.m_rA.y-m*this.m_rB.x*this.m_rB.y,g.ey.x=g.ex.y,g.ey.y=p+d+v*this.m_rA.x*this.m_rA.x+m*this.m_rB.x*this.m_rB.x,this.m_linearMass=g.GetInverse(),this.m_angularMass=v+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass);if(e.step.warmStarting){this.m_linearImpulse.Multiply(e.step.dtRatio),this.m_angularImpulse*=e.step.dtRatio;var y=new a(this.m_linearImpulse.x,this.m_linearImpulse.y);r.Subtract(s.MulFV(p,y)),o-=v*(s.CrossVV(this.m_rA,y)+this.m_angularImpulse),f.Add(s.MulFV(d,y)),l+=m*(s.CrossVV(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;e.velocities[this.m_indexA].v=r.Copy(),e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].v=f.Copy(),e.velocities[this.m_indexB].w=l},h.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=this.m_invMassA,u=this.m_invMassB,a=this.m_invIA,f=this.m_invIB,l=e.step.dt,c=i-n,h=-this.m_angularMass*c,p=this.m_angularImpulse,d=l*this.m_maxTorque;this.m_angularImpulse=s.Clamp(this.m_angularImpulse+h,-d,d),h=this.m_angularImpulse-p,n-=a*h,i+=f*h;var c=s.AddVV(r,s.CrossSV(i,this.m_rB));c.Subtract(s.AddVV(t,s.CrossSV(n,this.m_rA)));var h=s.MulMV(this.m_linearMass,c).GetNegative(),p=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(h);var d=l*this.m_maxForce;this.m_linearImpulse.LengthSquared()>d*d&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(d)),h=s.SubtractVV(this.m_linearImpulse,p),t.Subtract(s.MulFV(o,h)),n-=a*s.CrossVV(this.m_rA,h),r.Add(s.MulFV(u,h)),i+=f*s.CrossVV(this.m_rB,h),e.velocities[this.m_indexA].v=t.Copy(),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v=r.Copy(),e.velocities[this.m_indexB].w=i},h.prototype.SolvePositionConstraints=function(e){return!0},Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef),p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,p.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},p.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_frictionJoint,this.maxForce=0,this.maxTorque=0},p.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint),d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,d.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_localAnchorC=new a,this.m_localAnchorD=new a,this.m_localAxisC=new a,this.m_localAxisD=new a,this.m_lcA=new a,this.m_lcB=new a,this.m_lcC=new a,this.m_lcD=new a,this.m_JvAC=new a,this.m_JvBD=new a},d.prototype.GetJoint1=function(){return this.m_joint1},d.prototype.GetJoint2=function(){return this.m_joint2},d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},d.prototype.GetReactionForce=function(e){return new a(e*this.m_impulse*this.m_JvAC.x,e*this.m_impulse*this.m_JvAC.y)},d.prototype.GetReactionTorque=function(e){return e*this.m_impulse*this.m_JwA},d.prototype.GetRatio=function(){return this.m_ratio},d.prototype.SetRatio=function(e){this.m_ratio=e},d.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e),this.m_typeA=parseInt(e.joint1.m_type),this.m_typeB=parseInt(e.joint2.m_type),this.m_joint1=e.joint1,this.m_joint2=e.joint2,t.b2Assert(this.m_typeA==g.e_revoluteJoint||this.m_typeA==g.e_prismaticJoint),t.b2Assert(this.m_typeB==g.e_revoluteJoint||this.m_typeB==g.e_prismaticJoint);var n=0,r=0;this.m_bodyC=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB();var i=this.m_bodyA.m_xf.Copy(),o=this.m_bodyA.m_sweep.a,u=this.m_bodyC.m_xf.Copy(),a=this.m_bodyC.m_sweep.a;if(this.m_typeA==g.e_revoluteJoint){var f=e.joint1;this.m_localAnchorC.SetV(f.m_localAnchorA),this.m_localAnchorA.SetV(f.m_localAnchorB),this.m_referenceAngleA=f.m_referenceAngle,this.m_localAxisC.SetZero(),n=o-a-this.m_referenceAngleA}else{var l=e.joint1;this.m_localAnchorC.SetV(l.m_localAnchorA),this.m_localAnchorA.SetV(l.m_localAnchorB),this.m_referenceAngleA=l.m_referenceAngle,this.m_localAxisC=l.m_localXAxisA.Copy();var c=this.m_localAnchorC.Copy(),h=s.MulTRV(u.q,s.AddVV(s.MulRV(i.q,this.m_localAnchorA),s.SubtractVV(i.p,u.p)));n=s.DotVV(s.SubtractVV(h,c),this.m_localAxisC)}this.m_bodyD=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB();var p=this.m_bodyB.m_xf.Copy(),d=this.m_bodyB.m_sweep.a,v=this.m_bodyD.m_xf.Copy(),m=this.m_bodyD.m_sweep.a;if(this.m_typeB==g.e_revoluteJoint)this.m_localAnchorD.SetV(this.m_joint2.m_localAnchorA),this.m_localAnchorB.SetV(this.m_joint2.m_localAnchorB),this.m_referenceAngleB=this.m_joint2.m_referenceAngle,this.m_localAxisD.SetZero(),r=d-m-this.m_referenceAngleB;else{this.m_localAnchorD.SetV(this.m_joint2.m_localAnchorA),this.m_localAnchorB.SetV(this.m_joint2.m_localAnchorB),this.m_referenceAngleB=this.m_joint2.m_referenceAngle,this.m_localAxisD=this.m_joint2.m_localXAxisA.Copy();var y=this.m_localAnchorD.Copy(),b=s.MulTRV(v.q,s.AddVV(s.MulRV(p.q,this.m_localAnchorB),s.SubtractVV(p.p,v.p)));r=s.DotVV(s.SubtractVV(b,y),this.m_localAxisD)}this.m_ratio=e.ratio,this.m_constant=n+this.m_ratio*r,this.m_impulse=0},d.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA=this.m_bodyA.m_sweep.localCenter.Copy(),this.m_lcB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_lcC=this.m_bodyC.m_sweep.localCenter.Copy(),this.m_lcD=this.m_bodyD.m_sweep.localCenter.Copy(),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var t=e.positions[this.m_indexA].c.Copy(),n=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v.Copy(),o=e.velocities[this.m_indexA].w,u=e.positions[this.m_indexB].c.Copy(),a=e.positions[this.m_indexB].a,f=e.velocities[this.m_indexB].v.Copy(),l=e.velocities[this.m_indexB].w,c=e.positions[this.m_indexC].c.Copy(),h=e.positions[this.m_indexC].a,p=e.velocities[this.m_indexC].v.Copy(),d=e.velocities[this.m_indexC].w,v=e.positions[this.m_indexD].c.Copy(),m=e.positions[this.m_indexD].a,y=e.velocities[this.m_indexD].v.Copy(),b=e.velocities[this.m_indexD].w,w=new i(n),E=new i(a),S=new i(h),x=new i(m);this.m_mass=0;if(this.m_typeA==g.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var T=s.MulRV(S,this.m_localAxisC),N=s.MulRV(S,s.SubtractVV(this.m_localAnchorC,this.m_lcC)),C=s.MulRV(w,s.SubtractVV(this.m_localAnchorA,this.m_lcA));this.m_JvAC=T.Copy(),this.m_JwC=s.CrossVV(N,T),this.m_JwA=s.CrossVV(C,T),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==g.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var T=s.MulRV(x,this.m_localAxisD),k=s.MulRV(x,s.SubtractVV(this.m_localAnchorD,this.m_lcD)),L=s.MulRV(E,s.SubtractVV(this.m_localAnchorB,this.m_lcB));this.m_JvBD=s.MulFV(this.m_ratio,T),this.m_JwD=this.m_ratio*s.CrossVV(k,T),this.m_JwB=this.m_ratio*s.CrossVV(L,T),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(r.Add(s.MulFV(this.m_mA*this.m_impulse,this.m_JvAC)),o+=this.m_iA*this.m_impulse*this.m_JwA,f.Add(s.MulFV(this.m_mB*this.m_impulse,this.m_JvBD)),l+=this.m_iB*this.m_impulse*this.m_JwB,p.Subtract(s.MulFV(this.m_mC*this.m_impulse,this.m_JvAC)),d-=this.m_iC*this.m_impulse*this.m_JwC,y.Subtract(s.MulFV(this.m_mD*this.m_impulse,this.m_JvBD)),b-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].v=r.Copy(),e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].v=f.Copy(),e.velocities[this.m_indexB].w=l,e.velocities[this.m_indexC].v=p.Copy(),e.velocities[this.m_indexC].w=d,e.velocities[this.m_indexD].v=y.Copy(),e.velocities[this.m_indexD].w=b},d.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=e.velocities[this.m_indexC].v.Copy(),u=e.velocities[this.m_indexC].w,a=e.velocities[this.m_indexD].v.Copy(),f=e.velocities[this.m_indexD].w,l=s.DotVV(this.m_JvAC,s.SubtractVV(t,o))+s.DotVV(this.m_JvBD,s.SubtractVV(r,a));l+=this.m_JwA*n-this.m_JwC*u+(this.m_JwB*i-this.m_JwD*f);var c=-this.m_mass*l;this.m_impulse+=c,t.Add(s.MulFV(this.m_mA*c,this.m_JvAC)),n+=this.m_iA*c*this.m_JwA,r.Add(s.MulFV(this.m_mB*c,this.m_JvBD)),i+=this.m_iB*c*this.m_JwB,o.Subtract(s.MulFV(this.m_mC*c,this.m_JvAC)),u-=this.m_iC*c*this.m_JwC,a.Subtract(s.MulFV(this.m_mD*c,this.m_JvBD)),f-=this.m_iD*c*this.m_JwD,e.velocities[this.m_indexA].v=t.Copy(),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v=r.Copy(),e.velocities[this.m_indexB].w=i,e.velocities[this.m_indexC].v=o.Copy(),e.velocities[this.m_indexC].w=u,e.velocities[this.m_indexD].v=a.Copy(),e.velocities[this.m_indexD].w=f},d.prototype.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.positions[this.m_indexB].c.Copy(),u=e.positions[this.m_indexB].a,f=e.positions[this.m_indexC].c.Copy(),l=e.positions[this.m_indexC].a,c=e.positions[this.m_indexD].c.Copy(),h=e.positions[this.m_indexD].a,p=new i(r),d=new i(u),v=new i(l),m=new i(h),y=0,b,w,E=new a,S=new a,x,T,N,C,k=0;if(this.m_typeA==g.e_revoluteJoint)E.SetZero(),x=1,N=1,k+=this.m_iA+this.m_iC,b=r-l-this.m_referenceAngleA;else{var L=s.MulRV(v,this.m_localAxisC),A=s.MulRV(v,s.SubtractVV(this.m_localAnchorC,this.m_lcC)),O=s.MulRV(p,s.SubtractVV(this.m_localAnchorA,this.m_lcA));E=L.Copy(),N=s.CrossVV(A,L),x=s.CrossVV(O,L),k+=this.m_mC+this.m_mA+this.m_iC*N*N+this.m_iA*x*x;var M=s.SubtractVV(this.m_localAnchorC,this.m_lcC),_=s.MulTRV(v,s.AddVV(O,s.SubtractVV(n,f)));b=s.DotVV(s.SubtractVV(_,M),this.m_localAxisC)}if(this.m_typeB==g.e_revoluteJoint)S.SetZero(),T=this.m_ratio,C=this.m_ratio,k+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),w=u-h-this.m_referenceAngleB;else{var L=s.MulRV(m,this.m_localAxisD),D=s.MulRV(m,s.SubtractVV(this.m_localAnchorD,this.m_lcD)),P=s.MulRV(d,s.SubtractVV(this.m_localAnchorB,this.m_lcB));S=s.MulFV(this.m_ratio,L),C=this.m_ratio*s.CrossVV(D,L),T=this.m_ratio*s.CrossVV(P,L),k+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*C*C+this.m_iB*T*T;var H=s.SubtractVV(this.m_localAnchorD,this.m_lcD),B=s.MulTRV(m,s.AddVV(P,s.SubtractVV(o,c)));w=s.DotVV(s.SubtractVV(B,H),this.m_localAxisD)}var j=b+this.m_ratio*w-this.m_constant,F=0;return k>0&&(F=-j/k),n.Add(s.MulFV(this.m_mA*F,E)),r+=this.m_iA*F*x,o.Add(s.MulFV(this.m_mB*F,S)),u+=this.m_iB*F*T,f.Subtract(s.MulFV(this.m_mC*F,E)),l-=this.m_iC*F*N,c.Subtract(s.MulFV(this.m_mD*F,S)),h-=this.m_iD*F*C,e.positions[this.m_indexA].c=n.Copy(),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].c=o.Copy(),e.positions[this.m_indexB].a=u,e.positions[this.m_indexC].c=f.Copy(),e.positions[this.m_indexC].a=l,e.positions[this.m_indexD].c=c.Copy(),e.positions[this.m_indexD].a=h,y<t.b2_linearSlop},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},v.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},m.b2Jacobian=function(){this.linear=new a,this.angularA=0,this.angularB=0},g.b2Joint=function(){this.m_edgeA=new b,this.m_edgeB=new b},g.prototype.GetType=function(){return this.m_type},g.prototype.GetAnchorA=function(){return null},g.prototype.GetAnchorB=function(){return null},g.prototype.GetReactionForce=function(e){return null},g.prototype.GetReactionTorque=function(e){return 0},g.prototype.GetBodyA=function(){return this.m_bodyA},g.prototype.GetBodyB=function(){return this.m_bodyB},g.prototype.GetNext=function(){return this.m_next},g.prototype.GetUserData=function(){return this.m_userData},g.prototype.SetUserData=function(e){this.m_userData=e},g.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},g.prototype.GetCollideConnected=function(){return this.m_collideConnected},g.Create=function(e,n){var r=null;switch(e.type){case g.e_distanceJoint:r=new l(e instanceof c?e:null);break;case g.e_mouseJoint:r=new w(e instanceof E?e:null);break;case g.e_prismaticJoint:r=new S(e instanceof x?e:null);break;case g.e_revoluteJoint:r=new C(e instanceof k?e:null);break;case g.e_pulleyJoint:r=new T(e instanceof N?e:null);break;case g.e_gearJoint:r=new d(e instanceof v?e:null);break;case g.e_weldJoint:r=new O(e instanceof M?e:null);break;case g.e_wheelJoint:r=new _(e instanceof D?e:null);break;case g.e_frictionJoint:r=new h(e instanceof p?e:null);break;case g.e_ropeJoint:r=new L(e instanceof A?e:null);break;default:t.b2Assert(0)}return r},g.Destroy=function(e,t){},g.prototype.b2Joint=function(e){t.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_index=0,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData,this.m_edgeA.joint=null,this.m_edgeA.other=null,this.m_edgeA.prev=null,this.m_edgeA.next=null,this.m_edgeB.joint=null,this.m_edgeB.other=null,this.m_edgeB.prev=null,this.m_edgeB.next=null},g.prototype.InitVelocityConstraints=function(e){},g.prototype.SolveVelocityConstraints=function(e){},g.prototype.SolvePositionConstraints=function(e){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_wheelJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_ropeJoint=10,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),y.b2JointDef=function(){},y.prototype.b2JointDef=function(){this.type=g.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},b.b2JointEdge=function(){this.other=null,this.next=null,this.prev=null,this.joint=null},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorB=new a,this.m_targetA=new a,this.m_impulse=new a,this.m_rB=new a,this.m_localCenterB=new a,this.m_mass=new n,this.m_C=new a},w.prototype.GetAnchorA=function(){return this.m_targetA},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},w.prototype.GetReactionForce=function(e){return new a(e*this.m_impulse.x,e*this.m_impulse.y)},w.prototype.GetReactionTorque=function(e){return 0},w.prototype.GetTarget=function(){return this.m_targetA},w.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_targetA=e},w.prototype.GetMaxForce=function(){return this.m_maxForce},w.prototype.SetMaxForce=function(e){this.m_maxForce=e},w.prototype.GetFrequency=function(){return this.m_frequencyHz},w.prototype.SetFrequency=function(e){this.m_frequencyHz=e},w.prototype.GetDampingRatio=function(){return this.m_dampingRatio},w.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},w.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_targetA.SetV(e.target),this.m_localAnchorB=s.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA),this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0},w.prototype.InitVelocityConstraints=function(e){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var r=e.positions[this.m_indexB].c.Copy(),o=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v.Copy(),a=e.velocities[this.m_indexB].w,f=new i(o),l=this.m_bodyB.GetMass(),c=2*t.b2_pi*this.m_frequencyHz,h=2*l*this.m_dampingRatio*c,p=l*c*c,d=e.step.dt;t.b2Assert(h+d*p>t.b2_epsilon),this.m_gamma=d*(h+d*p),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=d*p*this.m_gamma,this.m_rB=s.MulRV(f,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB));var v=new n;v.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,v.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=v.GetInverse(),this.m_C=s.AddVV(r,s.SubtractVV(this.m_rB,this.m_targetA)),this.m_C.Multiply(this.m_beta),a*=.98,e.step.warmStarting?(this.m_impulse.Multiply(e.step.dtRatio),u.Add(s.MulFV(this.m_invMassB,this.m_impulse)),a+=this.m_invIB*s.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),e.velocities[this.m_indexB].v=u.Copy(),e.velocities[this.m_indexB].w=a},w.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexB].v.Copy(),n=e.velocities[this.m_indexB].w,r=s.AddVV(t,s.CrossFV(n,this.m_rB)),i=s.AddVV(r,this.m_C);i.Add(s.MulFV(this.m_gamma,this.m_impulse));var o=s.MulMV(this.m_mass,i.GetNegative()),u=this.m_impulse.Copy();this.m_impulse.Add(o);var a=e.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&(this.m_impulse*=a/this.m_impulse.Length()),o=this.m_impulse-u,t.Add(s.MulFV(this.m_invMassB,o)),n+=this.m_invIB*s.CrossVV(this.m_rB,o),e.velocities[this.m_indexB].v=t.Copy(),e.velocities[this.m_indexB].w=n},w.prototype.SolvePositionConstraints=function(e){return!0},Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef),E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,E.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new a},E.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_localXAxisA=new a,this.m_localYAxisA=new a,this.m_impulse=new f,this.m_localCenterA=new a,this.m_localCenterB=new a,this.m_axis=new a,this.m_perp=new a,this.m_K=new r},S.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},S.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},S.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},S.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},S.prototype.GetReactionForce=function(e){return new a(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},S.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},S.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchorA),r=t.GetWorldPoint(this.m_localAnchorB),i=r.x-n.x,s=r.y-n.y,o=e.GetWorldVector(this.m_localXAxisA),u=o.x*i+o.y*s;return u},S.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.q;var r=this.m_localAnchorA.x-e.m_sweep.localCenter.x,i=this.m_localAnchorA.y-e.m_sweep.localCenter.y,s=n.c*r-n.s*i;i=n.s*r+n.c*i,r=s,n=t.m_xf.q;var o=this.m_localAnchorB.x-t.m_sweep.localCenter.x,u=this.m_localAnchorB.y-t.m_sweep.localCenter.y;s=n.c*o-n.s*u,u=n.s*o+n.c*u,o=s;var a=e.m_sweep.c.x+r,f=e.m_sweep.c.y+i,l=t.m_sweep.c.x+o,c=t.m_sweep.c.y+u,h=l-a,p=c-f,d=e.GetWorldVector(this.m_localXAxisA),v=e.m_linearVelocity,m=t.m_linearVelocity,g=e.m_angularVelocity,y=t.m_angularVelocity,b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b},S.prototype.IsLimitEnabled=function(){return this.m_enableLimit},S.prototype.EnableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},S.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},S.prototype.GetUpperLimit=function(){return this.m_upperTranslation},S.prototype.SetLimits=function(e,t){if(e!=this.m_lowerTranslation||t!=this.m_upperTranslation)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t,this.m_impulse.z=0},S.prototype.IsMotorEnabled=function(){return this.m_enableMotor},S.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},S.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},S.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},S.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},S.prototype.GetMotorForce=function(e){return e*this.m_motorImpulse},S.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},S.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_localXAxisA.SetV(e.localAxisA),this.m_localXAxisA.Normalize(),this.m_localYAxisA.x=-this.m_localXAxisA.y,this.m_localYAxisA.y=this.m_localXAxisA.x,this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=
// e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=g.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},S.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter.Copy(),this.m_localCenterB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c.Copy(),f=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v.Copy(),c=e.velocities[this.m_indexB].w,h=new i(r),p=new i(f),d=s.MulRV(h,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),v=s.MulRV(p,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),m=s.AddVV(s.SubtractVV(a,n),s.SubtractVV(v,d)),y=this.m_invMassA,b=this.m_invMassB,w=this.m_invIA,E=this.m_invIB;this.m_axis=s.MulRV(h,this.m_localXAxisA),this.m_a1=s.CrossVV(s.AddVV(m,d),this.m_axis),this.m_a2=s.CrossVV(v,this.m_axis),this.m_motorMass=y+b+w*this.m_a1*this.m_a1+E*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=s.MulRV(h,this.m_localYAxisA),this.m_s1=s.CrossVV(s.AddVV(m,d),this.m_perp),this.m_s2=s.CrossVV(v,this.m_perp);var S=y+b+w*this.m_s1*this.m_s1+E*this.m_s2*this.m_s2,x=w*this.m_s1+E*this.m_s2,T=w*this.m_s1*this.m_a1+E*this.m_s2*this.m_a2,N=w+E;N==0&&(N=1);var C=w*this.m_a1+E*this.m_a2,k=y+b+w*this.m_a1*this.m_a1+E*this.m_a2*this.m_a2;this.m_K.ex.Set(S,x,T),this.m_K.ey.Set(x,N,C),this.m_K.ez.Set(T,C,k);if(this.m_enableLimit){var L=s.DotVV(this.m_axis,m);s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=g.e_equalLimits:L<=this.m_lowerTranslation?this.m_limitState!=g.e_atLowerLimit&&(this.m_limitState=g.e_atLowerLimit,this.m_impulse.z=0):L>=this.m_upperTranslation?this.m_limitState!=g.e_atUpperLimit&&(this.m_limitState=g.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=g.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.e_inactiveLimit,this.m_impulse.z=0;this.m_enableMotor==0&&(this.m_motorImpulse=0);if(e.step.warmStarting){this.m_impulse.Multiply(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var A=s.AddVV(s.MulFV(this.m_impulse.x,this.m_perp),s.MulFV(this.m_motorImpulse+this.m_impulse.z,this.m_axis)),O=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,M=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.Subtract(s.MulFV(y,A)),u-=w*O,l.Add(s.MulFV(b,A)),c+=E*M}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].v.SetV(o),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v.SetV(l),e.velocities[this.m_indexB].w=c},S.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=this.m_invMassA,u=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var h=s.DotVV(this.m_axis,s.SubtractVV(r,t))+this.m_a2*i-this.m_a1*n,p=this.m_motorMass*(this.m_motorSpeed-h),d=this.m_motorImpulse,v=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+p,-v,v),p=this.m_motorImpulse-d;var m=s.MulFV(p,this.m_axis),y=p*this.m_a1,b=p*this.m_a2;t.Subtract(s.MulFV(o,m)),n-=l*y,r.Add(s.MulFV(u,m)),i+=c*b}var w=new a;w.x=s.DotVV(this.m_perp,s.SubtractVV(r,t))+this.m_s2*i-this.m_s1*n,w.y=i-n;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var E;E=s.DotVV(this.m_axis,s.SubtractVV(r,t))+this.m_a2*i-this.m_a1*n;var h=new f(w.x,w.y,E),S=this.m_impulse.Copy(),x=this.m_K.Solve33(h.GetNegative());this.m_impulse.Add(x),this.m_limitState==g.e_atLowerLimit?this.m_impulse.z=s.Max(this.m_impulse.z,0):this.m_limitState==g.e_atUpperLimit&&(this.m_impulse.z=s.Min(this.m_impulse.z,0));var T=new a(this.m_K.ez.x,this.m_K.ez.y);T.Multiply(-(this.m_impulse.z-S.z)),T.Subtract(w);var N=new a(S.x,S.y);N.Add(this.m_K.Solve22(T)),this.m_impulse.x=N.x,this.m_impulse.y=N.y,x=s.SubtractVV3(this.m_impulse,S);var m=s.AddVV(s.MulFV(x.x,this.m_perp),s.MulFV(x.z,this.m_axis)),y=x.x*this.m_s1+x.y+x.z*this.m_a1,b=x.x*this.m_s2+x.y+x.z*this.m_a2;t.Subtract(s.MulFV(o,m)),n-=l*y,r.Add(s.MulFV(u,m)),i+=c*b}else{var x=this.m_K.Solve22(w.GetNegative());this.m_impulse.x+=x.x,this.m_impulse.y+=x.y;var m=s.MulFV(x.x,this.m_perp),y=x.x*this.m_s1+x.y,b=x.x*this.m_s2+x.y;t.Subtract(s.MulFV(o,m)),n-=l*y,r.Add(s.MulFV(u,m)),i+=c*b;var C=w.Copy();w.x=s.DotVV(this.m_perp,s.SubtractVV(r,t))+this.m_s2*i-this.m_s1*n,w.y=i-n;if(s.Abs(w.x)>.01||s.Abs(w.y)>.01){var k=s.MulMV(this.m_K,x);w.x+=0}}e.velocities[this.m_indexA].v.SetV(t),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v.SetV(r),e.velocities[this.m_indexB].w=i},S.prototype.SolvePositionConstraints=function(e){var o=e.positions[this.m_indexA].c.Copy(),u=e.positions[this.m_indexA].a,l=e.positions[this.m_indexB].c.Copy(),c=e.positions[this.m_indexB].a,h=new i(u),p=new i(c),d=this.m_invMassA,v=this.m_invMassB,m=this.m_invIA,g=this.m_invIB,y=s.MulRV(h,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),b=s.MulRV(p,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),w=s.SubtractVV(s.AddVV(l,b),s.AddVV(o,y)),E=s.MulRV(h,this.m_localXAxisA),S=s.CrossVV(s.AddVV(w,y),E),x=s.CrossVV(b,E),T=s.MulRV(h,this.m_localYAxisA),N=s.CrossVV(s.AddVV(w,y),T),C=s.CrossVV(b,T),k=new f,L=new a;L.x=s.DotVV(T,w),L.y=c-u-this.m_referenceAngle;var A=s.Abs(L.x),O=s.Abs(L.y),M=!1,_=0;if(this.m_enableLimit){var D=s.DotVV(E,w);s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(_=s.Clamp(D,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),A=s.Max(A,s.Abs(D)),M=!0):D<=this.m_lowerTranslation?(_=s.Clamp(D-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),A=s.Max(A,this.m_lowerTranslation-D),M=!0):D>=this.m_upperTranslation&&(_=s.Clamp(D-this.m_upperTranslation-t.b2_linearSlop,0,t.b2_maxLinearCorrection),A=s.Max(A,D-this.m_upperTranslation),M=!0)}if(M){var P=d+v+m*N*N+g*C*C,H=m*N+g*C,B=m*N*S+g*C*x,j=m+g;j==0&&(j=1);var F=m*S+g*x,I=d+v+m*S*S+g*x*x,q=new r;q.ex.Set(P,H,B),q.ey.Set(H,j,F),q.ez.Set(B,F,I);var R=new f;R.x=L.x,R.y=L.y,R.z=_,k=q.Solve33(R.GetNegative())}else{var P=d+v+m*N*N+g*C*C,H=m*N+g*C,j=m+g;j==0&&(j=1);var q=new n;q.ex.Set(P,H),q.ey.Set(H,j);var U=q.Solve(L.GetNegative());k.x=U.x,k.y=U.y,k.z=0}var z=s.AddVV(s.MulFV(k.x,T),s.MulFV(k.z,E)),W=k.x*N+k.y+k.z*S,X=k.x*C+k.y+k.z*x;return o.Subtract(s.MulFV(d,z)),u-=m*W,l.Add(s.MulFV(v,z)),c+=g*X,e.positions[this.m_indexA].c.SetV(o),e.positions[this.m_indexA].a=u,e.positions[this.m_indexB].c.SetV(l),e.positions[this.m_indexB].a=c,A<=t.b2_linearSlop&&O<=t.b2_angularSlop},Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a,this.localAxisA=new a},x.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},x.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint),T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,T.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchorA=new a,this.m_groundAnchorB=new a,this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_uA=new a,this.m_uB=new a,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a},T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},T.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse*this.m_uB.x,e*this.m_impulse*this.m_uB.y)},T.prototype.GetReactionTorque=function(e){return 0},T.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA},T.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB},T.prototype.GetLengthA=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchorA);return e.Subtract(this.m_groundAnchorA),e.Length()},T.prototype.GetLengthB=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB);return e.Subtract(this.m_groundAnchorB),e.Length()},T.prototype.GetRatio=function(){return this.m_ratio},T.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e),this.m_groundAnchorA.SetV(e.groundAnchorA),this.m_groundAnchorB.SetV(e.groundAnchorB),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_lengthA=e.lengthA,this.m_lengthB=e.lengthB,t.b2Assert(e.ratio!=0),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_impulse=0},T.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.SetV(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.SetV(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c.Copy(),f=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v.Copy(),c=e.velocities[this.m_indexB].w,h=new i(r),p=new i(f);this.m_rA=s.MulRV(h,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(p,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=s.SubtractVV(s.AddVV(n,this.m_rA),this.m_groundAnchorA),this.m_uB=s.SubtractVV(s.AddVV(a,this.m_rB),this.m_groundAnchorB);var d=this.m_uA.Length(),v=this.m_uB.Length();d>10*t.b2_linearSlop?this.m_uA.Multiply(1/d):this.m_uA.SetZero(),v>10*t.b2_linearSlop?this.m_uB.Multiply(1/v):this.m_uB.SetZero();var m=s.CrossVV(this.m_rA,this.m_uA),g=s.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*m*m,b=this.m_invMassB+this.m_invIB*g*g;this.m_mass=y+this.m_ratio*this.m_ratio*b,this.m_mass>0&&(this.m_mass=1/this.m_mass);if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var w=s.MulFV(-this.m_impulse,this.m_uA),E=s.MulFV(-this.m_ratio*this.m_impulse,this.m_uB);o.Add(s.MulFV(this.m_invMassA,w)),u+=this.m_invIA*s.CrossVV(this.m_rA,w),l.Add(s.MulFV(this.m_invMassB,E)),c+=this.m_invIB*s.CrossVV(this.m_rB,E)}else this.m_impulse=0;e.velocities[this.m_indexA].v.SetV(o),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v.SetV(l),e.velocities[this.m_indexB].w=c},T.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=s.AddVV(t,s.CrossFV(n,this.m_rA)),u=s.AddVV(r,s.CrossFV(i,this.m_rB)),a=-s.DotVV(this.m_uA,o)-this.m_ratio*s.DotVV(this.m_uB,u),f=-this.m_mass*a;this.m_impulse+=f;var l=s.MulFV(-f,this.m_uA),c=s.MulFV(-this.m_ratio*f,this.m_uB);t.Add(s.MulFV(this.m_invMassA,l)),n+=this.m_invIA*s.CrossVV(this.m_rA,l),r.Add(s.MulFV(this.m_invMassB,c)),i+=this.m_invIB*s.CrossVV(this.m_rB,c),e.velocities[this.m_indexA].v.SetV(t),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v.SetV(r),e.velocities[this.m_indexB].w=i},T.prototype.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.positions[this.m_indexB].c.Copy(),u=e.positions[this.m_indexB].a,a=new i(r),f=new i(u),l=s.MulRV(a,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),c=s.MulRV(f,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),h=s.SubtractVV(s.AddVV(n,l),this.m_groundAnchorA),p=s.SubtractVV(s.AddVV(o,c),this.m_groundAnchorB),d=h.Length(),v=p.Length();d>10*t.b2_linearSlop?h.Multiply(1/d):h.SetZero(),v>10*t.b2_linearSlop?p.Multiply(1/v):p.SetZero();var m=s.CrossVV(l,h),g=s.CrossVV(c,p),y=this.m_invMassA+this.m_invIA*m*m,b=this.m_invMassB+this.m_invIB*g*g,w=y+this.m_ratio*this.m_ratio*b;w>0&&(w=1/w);var E=this.m_constant-d-this.m_ratio*v,S=s.Abs(E),x=-w*E,T=s.MulFV(-x,h),N=s.MulFV(-this.m_ratio*x,p);return n.Add(s.MulFV(this.m_invMassA,T)),r+=this.m_invIA*s.CrossVV(l,T),o.Add(s.MulFV(this.m_invMassB,N)),u+=this.m_invIB*s.CrossVV(c,N),e.positions[this.m_indexA].c.SetV(n),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].c.SetV(o),e.positions[this.m_indexB].a=u,S<t.b2_linearSlop},Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef),N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,N.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new a,this.groundAnchorB=new a,this.localAnchorA=new a,this.localAnchorB=new a},N.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0},N.prototype.Initialize=function(e,t,n,r,i,s,o){this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s);var u=i.x-n.x,a=i.y-n.y;this.lengthA=Math.sqrt(u*u+a*a);var f=s.x-r.x,l=s.y-r.y;this.lengthB=Math.sqrt(f*f+l*l),this.ratio=o},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_impulse=new f,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a,this.m_mass=new r},C.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},C.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},C.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse.x,e*this.m_impulse.y)},C.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},C.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},C.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},C.prototype.IsLimitEnabled=function(){return this.m_enableLimit},C.prototype.EnableLimit=function(e){this.m_enableLimit=e},C.prototype.GetLowerLimit=function(){return this.m_lowerAngle},C.prototype.GetUpperLimit=function(){return this.m_upperAngle},C.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},C.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},C.prototype.EnableMotor=function(e){this.m_enableMotor=e},C.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},C.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},C.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},C.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},C.prototype.GetMotorTorque=function(e){return e*this.m_motorImpulse},C.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=g.e_inactiveLimit},C.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter.Copy(),this.m_localCenterB=this.m_bodyB.m_sweep.localCenter.Copy(),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,f=e.positions[this.m_indexB].c.Copy(),l=e.positions[this.m_indexB].a,c=e.velocities[this.m_indexB].v.Copy(),h=e.velocities[this.m_indexB].w,p=new i(r),d=new i(l);this.m_rA=s.MulRV(p,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(d,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB));var v=this.m_invMassA,m=this.m_invMassB,y=this.m_invIA,b=this.m_invIB,w=y+b==0;this.m_mass.ex.x=v+m+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*b,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*b,this.m_mass.ez.x=-this.m_rA.y*y-this.m_rB.y*b,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=v+m+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*b,this.m_mass.ez.y=this.m_rA.x*y+this.m_rB.x*b,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=y+b,this.m_motorMass=y+b,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);if(this.m_enableMotor==0||w)this.m_motorImpulse=0;if(g.m_enableLimit&&w==0){var E=l-r-this.m_referenceAngle;s.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=g.e_equalLimits:E<=this.m_lowerAngle?(this.m_limitState!=g.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=g.e_atLowerLimit):E>=this.m_upperAngle?(this.m_limitState!=g.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=g.e_atUpperLimit):(this.m_limitState=g.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.Multiply(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var S=new a(this.m_impulse.x,this.m_impulse.y);o.Subtract(s.MulFV(v,S)),u-=y*(s.CrossVV(this.m_rA,S)+this.m_motorImpulse+this.m_impulse.z),c.Add(s.MulFV(m,S)),h+=b*(s.CrossVV(this.m_rB,S)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].v=o.Copy(),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v=c.Copy(),e.velocities[this.m_indexB].w=h},C.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=this.m_invMassA,u=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,h=l+c==0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits&&h==0){var p=i-n-this.m_motorSpeed,d=-this.m_motorMass*p,v=this.m_motorImpulse,m=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+d,-m,m),d=this.m_motorImpulse-v,n-=l*d,i+=c*d}if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit&&h==0){var y=r.Copy();y.Add(s.CrossFV(i,this.m_rB)),y.Subtract(t),y.Subtract(s.CrossFV(n,this.m_rA));var b=i-n,p=new f(y.x,y.y,b),d=this.m_mass.Solve33(p).GetNegative();if(this.m_limitState==g.e_equalLimits)this.m_impulse.Add(d);else if(this.m_limitState==g.e_atLowerLimit){var w=this.m_impulse.z+d.z;if(w<0){var E=y.GetNegative();E.Add(s.MulFV(this.m_impulse.z,new a(this.m_mass.ez.x,this.m_mass.ez.y)));var S=this.m_mass.Solve22(E);d.x=S.x,d.y=S.y,d.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.Add(d)}else if(this.m_limitState==g.e_atUpperLimit){var w=this.m_impulse.z+d.z;if(w>0){var E=y.GetNegative();E.Add(s.MulFV(this.m_impulse.z,new a(this.m_mass.ez.x,this.m_mass.ez.y)));var S=this.m_mass.Solve22(E);d.x=S.x,d.y=S.y,d.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.Add(d)}var x=new a(d.x,d.y);t.Subtract(s.MulFV(o,x)),n-=l*(s.CrossVV(this.m_rA,x)+d.z),r.Add(s.MulFV(u,x)),i+=c*(s.CrossVV(this.m_rB,x)+d.z)}else{var p=r.Copy();p.Add(s.CrossFV(i,this.m_rB)),p.Subtract(t),p.Subtract(s.CrossFV(n,this.m_rA));var d=this.m_mass.Solve22(p.GetNegative());this.m_impulse.x+=d.x,this.m_impulse.y+=d.y,t.Subtract(s.MulFV(o,d)),n-=l*s.CrossVV(this.m_rA,d),r.Add(s.MulFV(u,d)),i+=c*s.CrossVV(this.m_rB,d)}e.velocities[this.m_indexA].v=t.Copy(),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v=r.Copy(),e.velocities[this.m_indexB].w=i},C.prototype.SolvePositionConstraints=function(e){var r=e.positions[this.m_indexA].c.Copy(),o=e.positions[this.m_indexA].a,u=e.positions[this.m_indexB].c.Copy(),a=e.positions[this.m_indexB].a,f=new i(o),l=new i(a),c=0,h=0,p=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit&&p==0){var d=a-o-this.m_referenceAngle,v=0;if(this.m_limitState==g.e_equalLimits){var m=s.Clamp(d-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection);v=-this.m_motorMass*m,c=s.Abs(m)}else if(this.m_limitState==g.e_atLowerLimit){var m=d-this.m_lowerAngle;c=-m,m=s.Clamp(m+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),v=-this.m_motorMass*m}else if(this.m_limitState==g.e_atUpperLimit){var m=d-this.m_upperAngle;c=m,m=s.Clamp(m-t.b2_angularSlop,0,t.b2_maxAngularCorrection),v=-this.m_motorMass*m}o-=this.m_invIA*v,a+=this.m_invIB*v}f.Set(o),l.Set(a);var y=s.MulRV(f,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),b=s.MulRV(l,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),m=u.Copy();m.Add(b),m.Subtract(r),m.Subtract(y),h=m.Length();var w=this.m_invMassA,E=this.m_invMassB,S=this.m_invIA,x=this.m_invIB,T=new n;T.ex.x=w+E+S*y.y*y.y+x*b.y*b.y,T.ex.y=-S*y.x*y.y-x*b.x*b.y,T.ey.x=T.ex.y,T.ey.y=w+E+S*y.x*y.x+x*b.x*b.x;var N=T.Solve(m).GetNegative();return r.Subtract(s.MulFV(w,N)),o-=S*s.CrossVV(y,N),u.Add(s.MulFV(E,N)),a+=x*s.CrossVV(b,N),e.positions[this.m_indexA].c=r.Copy(),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].c=u.Copy(),e.positions[this.m_indexB].a=a,h<=t.b2_linearSlop&&c<=t.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new a}),Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef),k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,k.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},k.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},k.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(L,Box2D.Dynamics.Joints.b2Joint),L.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,L.b2RopeJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_u=new a,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a},L.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},L.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},L.prototype.GetMaxLength=function(){return this.m_maxLength},L.prototype.SetMaxLength=function(e){this.m_maxLength=e},L.prototype.GetLimitState=function(e){return this.m_state},L.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},L.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},L.prototype.GetReactionForce=function(e){return new a(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},L.prototype.GetReactionTorque=function(e){return 0},L.prototype.b2RopeJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_maxLength=e.maxLength,this.m_mass=0,this.m_impulse=0,this.m_state=g.e_inactiveLimit,this.m_length=0},L.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.SetV(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.SetV(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c.Copy(),f=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v.Copy(),c=e.velocities[this.m_indexB].w,h=new i(r),p=new i(f);this.m_rA=s.MulRV(h,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(p,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),this.m_u=s.AddVV(a,s.SubtractVV(s.SubtractVV(this.m_rB,n),this.m_rA)),this.m_length=this.m_u.Length();var d=this.m_length-this.m_maxLength;d>0?this.m_state=g.e_atUpperLimit:this.m_state=g.e_inactiveLimit;if(!(this.m_length>t.b2_linearSlop)){this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0;return}this.m_u.Multiply(1/this.m_length);var v=s.CrossVV(this.m_rA,this.m_u),m=s.CrossVV(this.m_rB,this.m_u),y=this.m_invMassA+this.m_invIA*v*v+this.m_invMassB+this.m_invIB*m*m;this.m_mass=y!=0?1/y:0;if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var b=this.m_u.Copy();b.Multiply(this.m_impulse);var w=b.Copy();w.Multiply(this.m_invMassA),o.Subtract(w),u-=this.m_invIA*s.CrossVV(this.m_rA,b),w.SetV(b),w.Multiply(this.m_invMassB),l.Add(w),c+=this.m_invIB*s.CrossVV(this.m_rB,b)}else this.m_impulse=0;e.velocities[this.m_indexA].v.SetV(o),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v.SetV(l),e.velocities[this.m_indexB].w=c},L.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=s.AddVV(t,s.CrossFV(n,this.m_rA)),u=s.AddVV(r,s.CrossFV(i,this.m_rB)),a=this.m_length-this.m_maxLength,f=s.DotVV(this.m_u,s.SubtractVV(u,o));a<0&&(f+=e.step.inv_dt*a);var l=-this.m_mass*f,c=this.m_impulse;this.m_impulse=s.Min(0,this.m_impulse+l),l=this.m_impulse-c;var h=this.m_u.Copy();h.Multiply(l);var p=h.Copy();p.Multiply(this.m_invMassA),t.Subtract(p),n-=this.m_invIA*s.CrossVV(this.m_rA,h),p.SetV(h),p.Multiply(this.m_invMassB),r.Add(p),i+=this.m_invIB*s.CrossVV(this.m_rB,h),e.velocities[this.m_indexA].v.SetV(t),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v.SetV(r),e.velocities[this.m_indexB].w=i},L.prototype.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.positions[this.m_indexB].c.Copy(),u=e.positions[this.m_indexB].a,a=new i(r),f=new i(u),l=s.MulRV(a,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),c=s.MulRV(f,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),h=s.SubtractVV(s.SubtractVV(s.AddVV(o,c),n),l),p=h.Normalize(),d=p-this.m_maxLength;d=s.Clamp(d,0,t.b2_maxLinearCorrection);var v=-this.m_mass*d,m=h.Copy();m.Multiply(v);var g=m.Copy();return g.Multiply(this.m_invMassA),n.Subtract(g),r-=this.m_invIA*s.CrossVV(l,m),g.SetV(m),g.Multiply(this.m_invMassB),o.Add(g),u+=this.m_invIB*s.CrossVV(c,m),e.positions[this.m_indexA].c=n.Copy(),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].c=o.Copy(),e.positions[this.m_indexB].a=u,p-this.m_maxLength<t.b2_linearSlop},Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef),A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,A.b2RopeJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},A.prototype.b2RopeJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_ropeJoint,this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLength=0},Box2D.inherit(O,Box2D.Dynamics.Joints.b2Joint),O.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,O.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_impulse=new f,this.m_rA=new a,this.m_rB=new a,this.m_localCenterA=new a,this.m_localCenterB=new a,this.m_mass=new r},O.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},O.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},O.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},O.prototype.GetFrequency=function(){return this.m_frequencyHz},O.prototype.SetFrequency=function(e){this.m_frequencyHz=e},O.prototype.GetDampingRatio=function(){return this.m_dampingRatio},O.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},O.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},O.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},O.prototype.GetReactionForce=function(e){return new a(e*this.m_impulse.x,e*this.m_impulse.y)},O.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},O.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_impulse.SetZero()},O.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.SetV(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.SetV(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c.Copy(),o=e.positions[this.m_indexA].a,u=e.velocities[this.m_indexA].v.Copy(),f=e.velocities[this.m_indexA].w,l=e.positions[this.m_indexB].c.Copy(),c=e.positions[this.m_indexB].a,h=e.velocities[this.m_indexB].v.Copy(),p=e.velocities[this.m_indexB].w,d=new i(o),v=new i(c);this.m_rA=s.MulRV(d,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=s.MulRV(v,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB));var m=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,b=this.m_invIB,w=new r;w.ex.x=m+g+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*b,w.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*b,w.ez.x=-this.m_rA.y*y-this.m_rB.y*b,w.ex.y=w.ey.x,w.ey.y=m+g+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*b,w.ez.y=this.m_rA.x*y+this.m_rB.x*b,w.ex.z=w.ez.x,w.ey.z=w.ez.y,w.ez.z=y+b;if(this.m_frequencyHz>0){w.GetInverse22(this.m_mass);var E=y+b,S=E>0?1/E:0,x=c-o-this.m_referenceAngle,T=2*t.b2_pi*this.m_frequencyHz,N=2*S*this.m_dampingRatio*T,C=S*T*T,k=e.step.dt;this.m_gamma=k*(N+k*C),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=x*k*C*this.m_gamma,E+=this.m_gamma,this.m_mass.ez.z=E!=0?1/E:0}else w.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(e.step.warmStarting){this.m_impulse.Multiply(e.step.dtRatio);var L=new a(this.m_impulse.x,this.m_impulse.y);u.Subtract(s.MulFV(m,L)),f-=y*(s.CrossVV(this.m_rA,L)+this.m_impulse.z),h.Add(s.MulFV(g,L)),p+=b*(s.CrossVV(this.m_rB,L)+this.m_impulse.z)}else this.m_impulse.SetZero();e.velocities[this.m_indexA].v.SetV(u),e.velocities[this.m_indexA].w=f,e.velocities[this.m_indexB].v.SetV(h),e.velocities[this.m_indexB].w=p},O.prototype.SolveVelocityConstraints=function(e){var t=e.velocities[this.m_indexA].v.Copy(),n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v.Copy(),i=e.velocities[this.m_indexB].w,o=this.m_invMassA,u=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;if(this.m_frequencyHz>0){var h=i-n,p=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=
// p,n-=l*p,i+=c*p;var d=s.AddVV(r,s.CrossFV(i,this.m_rB));d.Subtract(t),d.Subtract(s.CrossFV(n,this.m_rA));var v=s.MulMV(this.m_mass,d).GetNegative();this.m_impulse.x+=v.x,this.m_impulse.y+=v.y;var m=v.Copy();t.Subtract(s.MulFV(o,m)),n-=l*s.CrossVV(this.m_rA,m),r.Add(s.MulFV(u,m)),i+=c*s.CrossVV(this.m_rB,m)}else{var d=s.AddVV(r,s.CrossFV(i,this.m_rB));d.Subtract(t),d.Subtract(s.CrossFV(n,this.m_rA));var h=i-n,g=new f(d.x,d.y,h),y=s.MulMV3(this.m_mass,g).GetNegative();this.m_impulse.Add(y);var m=new a(y.x,y.y);t.Subtract(s.MulFV(o,m)),n-=l*(s.CrossVV(this.m_rA,m)+y.z),r.Add(s.MulFV(u,m)),i+=c*(s.CrossVV(this.m_rB,m)+y.z)}e.velocities[this.m_indexA].v.SetV(t),e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].v.SetV(r),e.velocities[this.m_indexB].w=i},O.prototype.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c.Copy(),o=e.positions[this.m_indexA].a,u=e.positions[this.m_indexB].c.Copy(),l=e.positions[this.m_indexB].a,c=new i(o),h=new i(l),p=this.m_invMassA,d=this.m_invMassB,v=this.m_invIA,m=this.m_invIB,g=s.MulRV(c,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),y=s.MulRV(h,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),b,w,E=new r;E.ex.x=p+d+g.y*g.y*v+y.y*y.y*m,E.ey.x=-g.y*g.x*v-y.y*y.x*m,E.ez.x=-g.y*v-y.y*m,E.ex.y=E.ey.x,E.ey.y=p+d+g.x*g.x*v+y.x*y.x*m,E.ez.y=g.x*v+y.x*m,E.ex.z=E.ez.x,E.ey.z=E.ez.y,E.ez.z=v+m;if(this.m_frequencyHz>0){var S=s.AddVV(u+y);S.Subtract(n),S.Subtract(g),b=S.Length(),w=0;var x=E.Solve22(S).GetNegative();n.Subtract(s.MulFV(p,x)),o-=v*s.CrossVV(g,x),u.Add(s.MulFV(d,x)),l+=m*s.CrossVV(y,x)}else{var S=s.AddVV(u,y);S.Subtract(n),S.Subtract(g);var T=l-o-this.m_referenceAngle;b=S.Length(),w=s.Abs(T);var N=new f(S.x,S.y,T),C=E.Solve33(N).GetNegative(),x=new a(C.x,C.y);n.Subtract(s.MulFV(p,x)),o-=v*(s.CrossVV(g,x)+C.z),u.Add(s.MulFV(d,x)),l+=m*(s.CrossVV(y,x)+C.z)}return e.positions[this.m_indexA].c.SetV(n),e.positions[this.m_indexA].a=o,e.positions[this.m_indexB].c.SetV(u),e.positions[this.m_indexB].a=l,b<=t.b2_linearSlop&&w<=t.b2_angularSlop},Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef),M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_weldJoint,this.localAnchorA=new a,this.localAnchorB=new a,this.referenceAngle=0},M.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(_,Box2D.Dynamics.Joints.b2Joint),_.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,_.b2WheelJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_localXAxisA=new a,this.m_localYAxisA=new a,this.m_localCenterA=new a,this.m_localCenterB=new a,this.m_ax=new a,this.m_ay=new a},_.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.GetLocalAxisA=function(){return this.m_localXAxisA},_.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},_.prototype.SetSpringFrequencyHz=function(e){this.m_frequencyHz=e},_.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},_.prototype.SetSpringDampingRatio=function(e){this.m_dampingRatio=e},_.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},_.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},_.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},_.prototype.SetMaxMotorTorque=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=e},_.prototype.GetMotorTorque=function(e){return e*this.m_motorImpulse},_.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchorA),r=t.GetWorldPoint(this.m_localAnchorB),i=s.SubtractVV(r,n),o=e.GetWorldVector(this.m_localXAxisA),u=s.DotVV(i,o);return u},_.prototype.GetJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,t=this.m_bodyB.m_angularVelocity;return t-e},_.prototype.IsMotorEnabled=function(){return this.m_enableMotor},_.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},_.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},_.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},_.prototype.GetReactionForce=function(e){var t=this.m_ay.Copy();t.Multiply(this.m_impulse);var n=this.m_ax.Copy();n.Multiply(this.m_springImpulse);var r=s.AddVV(t,n);return r.Multiply(e),r},_.prototype.GetReactionTorque=function(e){return e*this.m_motorImpulse},_.prototype.b2WheelJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_localXAxisA.SetV(e.localAxisA),this.m_localYAxisA=s.CrossFV(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableMotor=e.enableMotor,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_ax.SetZero(),this.m_ay.SetZero()},_.prototype.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.SetV(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.SetV(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=this.m_invMassA,r=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,a=e.positions[this.m_indexA].c.Copy(),f=e.positions[this.m_indexA].a,l=e.velocities[this.m_indexA].v.Copy(),c=e.velocities[this.m_indexA].w,h=e.positions[this.m_indexB].c.Copy(),p=e.positions[this.m_indexB].a,d=e.velocities[this.m_indexB].v.Copy(),v=e.velocities[this.m_indexB].w,m=new i(f),g=new i(p),y=s.MulRV(m,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),b=s.MulRV(g,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),w=s.AddVV(h,b);w.Subtract(a),w.Subtract(y),this.m_ay=s.MulRV(m,this.m_localYAxisA),this.m_sAy=s.CrossVV(s.AddVV(w,y),this.m_ay),this.m_sBy=s.CrossVV(b,this.m_ay),this.m_mass=n+r+o*this.m_sAy*this.m_sAy+u*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0;if(this.m_frequencyHz>0){this.m_ax=s.MulRV(m,this.m_localXAxisA),this.m_sAx=s.CrossVV(s.AddVV(w,y),this.m_ax),this.m_sBx=s.CrossVV(b,this.m_ax);var E=n+r+o*this.m_sAx*this.m_sAx+u*this.m_sBx*this.m_sBx;if(E>0){this.m_springMass=1/E;var S=s.DotVV(w,this.m_ax),x=2*t.b2_pi*this.m_frequencyHz,w=2*this.m_springMass*this.m_dampingRatio*x,T=this.m_springMass*x*x,N=e.step.dt;this.m_gamma=N*(w+N*T),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*N*T*this.m_gamma,this.m_springMass=E+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;this.m_enableMotor?(this.m_motorMass=o+u,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0);if(e.step.warmStarting){this.m_impulse*=e.step.dtRatio,this.m_springImpulse*=e.step.dtRatio,this.m_motorImpulse*=e.step.dtRatio;var C=s.AddVV(s.MulFV(this.m_impulse,this.m_ay),s.MulFV(this.m_springImpulse,this.m_ax)),k=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,L=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.Subtract(s.MulFV(this.m_invMassA,C)),c-=this.m_invIA*k,d.Add(s.MulFV(this.m_invMassB,C)),v+=this.m_invIB*L}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;e.velocities[this.m_indexA].v.SetV(l),e.velocities[this.m_indexA].w=c,e.velocities[this.m_indexB].v.SetV(d),e.velocities[this.m_indexB].w=v},_.prototype.SolveVelocityConstraints=function(e){var t=this.m_invMassA,n=this.m_invMassB,r=this.m_invIA,i=this.m_invIB,o=e.velocities[this.m_indexA].v.Copy(),u=e.velocities[this.m_indexA].w,a=e.velocities[this.m_indexB].v.Copy(),f=e.velocities[this.m_indexB].w,l=s.DotVV(this.m_ax,s.SubtractVV(a,o))+this.m_sBx*f-this.m_sAx*u,c=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var h=s.MulFV(c,this.m_ax),p=c*this.m_sAx,d=c*this.m_sBx;o.Subtract(s.MulFV(t,h)),u-=r*p,a.Add(s.MulFV(n,h)),f+=i*d;var l=f-u-this.m_motorSpeed,c=-this.m_motorMass*l,v=this.m_motorImpulse,m=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+c,-m,m),c=this.m_motorImpulse-v,u-=r*c,f+=i*c;var l=s.DotVV(this.m_ay,s.SubtractVV(a,o))+this.m_sBy*f-this.m_sAy*u,c=-this.m_mass*l;this.m_impulse+=c;var h=s.MulFV(c,this.m_ay),p=c*this.m_sAy,d=c*this.m_sBy;o.Subtract(s.MulFV(t,h)),u-=r*p,a.Add(s.MulFV(n,h)),f+=i*d,e.velocities[this.m_indexA].v.SetV(o),e.velocities[this.m_indexA].w=u,e.velocities[this.m_indexB].v.SetV(a),e.velocities[this.m_indexB].w=f},_.prototype.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c.Copy(),r=e.positions[this.m_indexA].a,o=e.positions[this.m_indexB].c.Copy(),u=e.positions[this.m_indexB].a,a=new i(r),f=new i(u),l=s.MulRV(a,s.SubtractVV(this.m_localAnchorA,this.m_localCenterA)),c=s.MulRV(f,s.SubtractVV(this.m_localAnchorB,this.m_localCenterB)),h=s.SubtractVV(o,n);h.Add(c),h.Subtract(l);var p=s.MulRV(a,this.m_localYAxisA),d=s.CrossVV(s.AddVV(h,l),p),v=s.CrossVV(c,p),m=s.DotVV(h,p),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,y;g!=0?y=-m/g:y=0;var b=s.MulFV(y,p),w=y*d,E=y*v;return n.Subtract(s.MulFV(this.m_invMassA,b)),r-=this.m_invIA*w,o.Add(s.MulFV(this.m_invMassB,b)),u+=this.m_invIB*E,e.positions[this.m_indexA].c.SetV(n),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].c.SetV(o),e.positions[this.m_indexB].a=u,s.Abs(m)<=t.b2_linearSlop},Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef),D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,D.b2WheelJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a,this.localAxisA=new a},D.prototype.b2WheelJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_wheelJoint,this.localAxisA.Set(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7},D.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.localAxisA.SetV(this.bodyA.GetLocalVector(r))}}(),function(){var e=Box2D.Dynamics.b2Draw;e.b2Draw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},e.prototype.b2Draw=function(){this.m_drawFlags=0},e.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},e.prototype.GetFlags=function(){return this.m_drawFlags},e.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},e.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},e.prototype.SetSprite=function(e){this.m_ctx=e},e.prototype.GetSprite=function(){return this.m_ctx},e.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},e.prototype.GetDrawScale=function(){return this.m_drawScale},e.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},e.prototype.GetLineThickness=function(){return this.m_lineThickness},e.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},e.prototype.GetAlpha=function(){return this.m_alpha},e.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},e.prototype.GetFillAlpha=function(){return this.m_fillAlpha},e.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},e.prototype.GetXFormScale=function(){return this.m_xformScale},e.prototype.DrawPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()},e.prototype.DrawSolidPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()},e.prototype.DrawCircle=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()},e.prototype.DrawSolidCircle=function(e,t,n,r){if(!t)return;var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.p.x*n,e.p.y*n),t.lineTo((e.p.x+this.m_xformScale*e.q.c)*n,(e.p.y+this.m_xformScale*e.q.s)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.p.x*n,e.p.y*n),t.lineTo((e.p.x-this.m_xformScale*e.q.s)*n,(e.p.y+this.m_xformScale*e.q.c)*n),t.closePath(),t.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;
// return Box2D;
// });
